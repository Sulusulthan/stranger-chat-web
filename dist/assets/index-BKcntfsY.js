(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var rm={exports:{}},Oa={},sm={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var js=Symbol.for("react.element"),tk=Symbol.for("react.portal"),nk=Symbol.for("react.fragment"),ik=Symbol.for("react.strict_mode"),rk=Symbol.for("react.profiler"),sk=Symbol.for("react.provider"),ok=Symbol.for("react.context"),ak=Symbol.for("react.forward_ref"),ck=Symbol.for("react.suspense"),lk=Symbol.for("react.memo"),uk=Symbol.for("react.lazy"),bf=Symbol.iterator;function dk(t){return t===null||typeof t!="object"?null:(t=bf&&t[bf]||t["@@iterator"],typeof t=="function"?t:null)}var om={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},am=Object.assign,cm={};function xr(t,e,n){this.props=t,this.context=e,this.refs=cm,this.updater=n||om}xr.prototype.isReactComponent={};xr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};xr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lm(){}lm.prototype=xr.prototype;function ju(t,e,n){this.props=t,this.context=e,this.refs=cm,this.updater=n||om}var Bu=ju.prototype=new lm;Bu.constructor=ju;am(Bu,xr.prototype);Bu.isPureReactComponent=!0;var Sf=Array.isArray,um=Object.prototype.hasOwnProperty,Vu={current:null},dm={key:!0,ref:!0,__self:!0,__source:!0};function fm(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)um.call(e,i)&&!dm.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:js,type:t,key:s,ref:o,props:r,_owner:Vu.current}}function fk(t,e){return{$$typeof:js,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function zu(t){return typeof t=="object"&&t!==null&&t.$$typeof===js}function hk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Cf=/\/+/g;function ac(t,e){return typeof t=="object"&&t!==null&&t.key!=null?hk(""+t.key):e.toString(36)}function vo(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case js:case tk:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+ac(o,0):i,Sf(r)?(n="",t!=null&&(n=t.replace(Cf,"$&/")+"/"),vo(r,e,n,"",function(l){return l})):r!=null&&(zu(r)&&(r=fk(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Cf,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Sf(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+ac(s,a);o+=vo(s,e,n,c,r)}else if(c=dk(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+ac(s,a++),o+=vo(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Gs(t,e,n){if(t==null)return t;var i=[],r=0;return vo(t,i,"","",function(s){return e.call(n,s,r++)}),i}function pk(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ge={current:null},yo={transition:null},mk={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:yo,ReactCurrentOwner:Vu};function hm(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:Gs,forEach:function(t,e,n){Gs(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Gs(t,function(){e++}),e},toArray:function(t){return Gs(t,function(e){return e})||[]},only:function(t){if(!zu(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=xr;G.Fragment=nk;G.Profiler=rk;G.PureComponent=ju;G.StrictMode=ik;G.Suspense=ck;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;G.act=hm;G.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=am({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Vu.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)um.call(e,c)&&!dm.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:js,type:t.type,key:r,ref:s,props:i,_owner:o}};G.createContext=function(t){return t={$$typeof:ok,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:sk,_context:t},t.Consumer=t};G.createElement=fm;G.createFactory=function(t){var e=fm.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:ak,render:t}};G.isValidElement=zu;G.lazy=function(t){return{$$typeof:uk,_payload:{_status:-1,_result:t},_init:pk}};G.memo=function(t,e){return{$$typeof:lk,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=yo.transition;yo.transition={};try{t()}finally{yo.transition=e}};G.unstable_act=hm;G.useCallback=function(t,e){return Ge.current.useCallback(t,e)};G.useContext=function(t){return Ge.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return Ge.current.useDeferredValue(t)};G.useEffect=function(t,e){return Ge.current.useEffect(t,e)};G.useId=function(){return Ge.current.useId()};G.useImperativeHandle=function(t,e,n){return Ge.current.useImperativeHandle(t,e,n)};G.useInsertionEffect=function(t,e){return Ge.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return Ge.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return Ge.current.useMemo(t,e)};G.useReducer=function(t,e,n){return Ge.current.useReducer(t,e,n)};G.useRef=function(t){return Ge.current.useRef(t)};G.useState=function(t){return Ge.current.useState(t)};G.useSyncExternalStore=function(t,e,n){return Ge.current.useSyncExternalStore(t,e,n)};G.useTransition=function(){return Ge.current.useTransition()};G.version="18.3.1";sm.exports=G;var g=sm.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gk=g,vk=Symbol.for("react.element"),yk=Symbol.for("react.fragment"),kk=Object.prototype.hasOwnProperty,bk=gk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Sk={key:!0,ref:!0,__self:!0,__source:!0};function pm(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)kk.call(e,i)&&!Sk.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:vk,type:t,key:s,ref:o,props:r,_owner:bk.current}}Oa.Fragment=yk;Oa.jsx=pm;Oa.jsxs=pm;rm.exports=Oa;var q=rm.exports,mm={exports:{}},gt={},gm={exports:{}},vm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,z){var $=U.length;U.push(z);e:for(;0<$;){var ne=$-1>>>1,re=U[ne];if(0<r(re,z))U[ne]=z,U[$]=re,$=ne;else break e}}function n(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var z=U[0],$=U.pop();if($!==z){U[0]=$;e:for(var ne=0,re=U.length,Et=re>>>1;ne<Et;){var Pt=2*(ne+1)-1,Mn=U[Pt],We=Pt+1,de=U[We];if(0>r(Mn,$))We<re&&0>r(de,Mn)?(U[ne]=de,U[We]=$,ne=We):(U[ne]=Mn,U[Pt]=$,ne=Pt);else if(We<re&&0>r(de,$))U[ne]=de,U[We]=$,ne=We;else break e}}return z}function r(U,z){var $=U.sortIndex-z.sortIndex;return $!==0?$:U.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,f=3,p=!1,y=!1,m=!1,T=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(U){for(var z=n(l);z!==null;){if(z.callback===null)i(l);else if(z.startTime<=U)i(l),z.sortIndex=z.expirationTime,e(c,z);else break;z=n(l)}}function b(U){if(m=!1,k(U),!y)if(n(c)!==null)y=!0,te(S);else{var z=n(l);z!==null&&De(b,z.startTime-U)}}function S(U,z){y=!1,m&&(m=!1,h(x),x=-1),p=!0;var $=f;try{for(k(z),d=n(c);d!==null&&(!(d.expirationTime>z)||U&&!N());){var ne=d.callback;if(typeof ne=="function"){d.callback=null,f=d.priorityLevel;var re=ne(d.expirationTime<=z);z=t.unstable_now(),typeof re=="function"?d.callback=re:d===n(c)&&i(c),k(z)}else i(c);d=n(c)}if(d!==null)var Et=!0;else{var Pt=n(l);Pt!==null&&De(b,Pt.startTime-z),Et=!1}return Et}finally{d=null,f=$,p=!1}}var w=!1,P=null,x=-1,O=5,I=-1;function N(){return!(t.unstable_now()-I<O)}function j(){if(P!==null){var U=t.unstable_now();I=U;var z=!0;try{z=P(!0,U)}finally{z?V():(w=!1,P=null)}}else w=!1}var V;if(typeof v=="function")V=function(){v(j)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,qe=Z.port2;Z.port1.onmessage=j,V=function(){qe.postMessage(null)}}else V=function(){T(j,0)};function te(U){P=U,w||(w=!0,V())}function De(U,z){x=T(function(){U(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){y||p||(y=!0,te(S))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(f){case 1:case 2:case 3:var z=3;break;default:z=f}var $=f;f=z;try{return U()}finally{f=$}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,z){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var $=f;f=U;try{return z()}finally{f=$}},t.unstable_scheduleCallback=function(U,z,$){var ne=t.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ne+$:ne):$=ne,U){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=$+re,U={id:u++,callback:z,priorityLevel:U,startTime:$,expirationTime:re,sortIndex:-1},$>ne?(U.sortIndex=$,e(l,U),n(c)===null&&U===n(l)&&(m?(h(x),x=-1):m=!0,De(b,$-ne))):(U.sortIndex=re,e(c,U),y||p||(y=!0,te(S))),U},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(U){var z=f;return function(){var $=f;f=z;try{return U.apply(this,arguments)}finally{f=$}}}})(vm);gm.exports=vm;var Ck=gm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tk=g,mt=Ck;function A(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ym=new Set,ps={};function Di(t,e){gr(t,e),gr(t+"Capture",e)}function gr(t,e){for(ps[t]=e,t=0;t<e.length;t++)ym.add(e[t])}var Sn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),il=Object.prototype.hasOwnProperty,wk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tf={},wf={};function Ek(t){return il.call(wf,t)?!0:il.call(Tf,t)?!1:wk.test(t)?wf[t]=!0:(Tf[t]=!0,!1)}function Pk(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Rk(t,e,n,i){if(e===null||typeof e>"u"||Pk(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ue={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ue[t]=new Qe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ue[e]=new Qe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ue[t]=new Qe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ue[t]=new Qe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ue[t]=new Qe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ue[t]=new Qe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ue[t]=new Qe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ue[t]=new Qe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ue[t]=new Qe(t,5,!1,t.toLowerCase(),null,!1,!1)});var $u=/[\-:]([a-z])/g;function qu(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace($u,qu);Ue[e]=new Qe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace($u,qu);Ue[e]=new Qe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace($u,qu);Ue[e]=new Qe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ue[t]=new Qe(t,1,!1,t.toLowerCase(),null,!1,!1)});Ue.xlinkHref=new Qe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ue[t]=new Qe(t,1,!1,t.toLowerCase(),null,!0,!0)});function Wu(t,e,n,i){var r=Ue.hasOwnProperty(e)?Ue[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Rk(e,n,r,i)&&(n=null),i||r===null?Ek(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var _n=Tk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Qs=Symbol.for("react.element"),$i=Symbol.for("react.portal"),qi=Symbol.for("react.fragment"),Hu=Symbol.for("react.strict_mode"),rl=Symbol.for("react.profiler"),km=Symbol.for("react.provider"),bm=Symbol.for("react.context"),Ku=Symbol.for("react.forward_ref"),sl=Symbol.for("react.suspense"),ol=Symbol.for("react.suspense_list"),Gu=Symbol.for("react.memo"),Fn=Symbol.for("react.lazy"),Sm=Symbol.for("react.offscreen"),Ef=Symbol.iterator;function Ar(t){return t===null||typeof t!="object"?null:(t=Ef&&t[Ef]||t["@@iterator"],typeof t=="function"?t:null)}var ge=Object.assign,cc;function Jr(t){if(cc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);cc=e&&e[1]||""}return`
`+cc+t}var lc=!1;function uc(t,e){if(!t||lc)return"";lc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{lc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Jr(t):""}function _k(t){switch(t.tag){case 5:return Jr(t.type);case 16:return Jr("Lazy");case 13:return Jr("Suspense");case 19:return Jr("SuspenseList");case 0:case 2:case 15:return t=uc(t.type,!1),t;case 11:return t=uc(t.type.render,!1),t;case 1:return t=uc(t.type,!0),t;default:return""}}function al(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case qi:return"Fragment";case $i:return"Portal";case rl:return"Profiler";case Hu:return"StrictMode";case sl:return"Suspense";case ol:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case bm:return(t.displayName||"Context")+".Consumer";case km:return(t._context.displayName||"Context")+".Provider";case Ku:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Gu:return e=t.displayName||null,e!==null?e:al(t.type)||"Memo";case Fn:e=t._payload,t=t._init;try{return al(t(e))}catch{}}return null}function xk(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return al(e);case 8:return e===Hu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ii(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Cm(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ik(t){var e=Cm(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Js(t){t._valueTracker||(t._valueTracker=Ik(t))}function Tm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Cm(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function qo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function cl(t,e){var n=e.checked;return ge({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Pf(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ii(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wm(t,e){e=e.checked,e!=null&&Wu(t,"checked",e,!1)}function ll(t,e){wm(t,e);var n=ii(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ul(t,e.type,n):e.hasOwnProperty("defaultValue")&&ul(t,e.type,ii(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Rf(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ul(t,e,n){(e!=="number"||qo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Yr=Array.isArray;function ir(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ii(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function dl(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(A(91));return ge({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _f(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(A(92));if(Yr(n)){if(1<n.length)throw Error(A(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ii(n)}}function Em(t,e){var n=ii(e.value),i=ii(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function xf(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Pm(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fl(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Pm(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ys,Rm=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ys=Ys||document.createElement("div"),Ys.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ys.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ms(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ok=["Webkit","ms","Moz","O"];Object.keys(ns).forEach(function(t){Ok.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ns[e]=ns[t]})});function _m(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ns.hasOwnProperty(t)&&ns[t]?(""+e).trim():e+"px"}function xm(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=_m(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Mk=ge({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hl(t,e){if(e){if(Mk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(A(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(A(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(A(61))}if(e.style!=null&&typeof e.style!="object")throw Error(A(62))}}function pl(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ml=null;function Qu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gl=null,rr=null,sr=null;function If(t){if(t=zs(t)){if(typeof gl!="function")throw Error(A(280));var e=t.stateNode;e&&(e=La(e),gl(t.stateNode,t.type,e))}}function Im(t){rr?sr?sr.push(t):sr=[t]:rr=t}function Om(){if(rr){var t=rr,e=sr;if(sr=rr=null,If(t),e)for(t=0;t<e.length;t++)If(e[t])}}function Mm(t,e){return t(e)}function Dm(){}var dc=!1;function Nm(t,e,n){if(dc)return t(e,n);dc=!0;try{return Mm(t,e,n)}finally{dc=!1,(rr!==null||sr!==null)&&(Dm(),Om())}}function gs(t,e){var n=t.stateNode;if(n===null)return null;var i=La(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(A(231,e,typeof n));return n}var vl=!1;if(Sn)try{var Lr={};Object.defineProperty(Lr,"passive",{get:function(){vl=!0}}),window.addEventListener("test",Lr,Lr),window.removeEventListener("test",Lr,Lr)}catch{vl=!1}function Dk(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var is=!1,Wo=null,Ho=!1,yl=null,Nk={onError:function(t){is=!0,Wo=t}};function Ak(t,e,n,i,r,s,o,a,c){is=!1,Wo=null,Dk.apply(Nk,arguments)}function Lk(t,e,n,i,r,s,o,a,c){if(Ak.apply(this,arguments),is){if(is){var l=Wo;is=!1,Wo=null}else throw Error(A(198));Ho||(Ho=!0,yl=l)}}function Ni(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Am(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Of(t){if(Ni(t)!==t)throw Error(A(188))}function Uk(t){var e=t.alternate;if(!e){if(e=Ni(t),e===null)throw Error(A(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Of(r),t;if(s===i)return Of(r),e;s=s.sibling}throw Error(A(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(A(189))}}if(n.alternate!==i)throw Error(A(190))}if(n.tag!==3)throw Error(A(188));return n.stateNode.current===n?t:e}function Lm(t){return t=Uk(t),t!==null?Um(t):null}function Um(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Um(t);if(e!==null)return e;t=t.sibling}return null}var Fm=mt.unstable_scheduleCallback,Mf=mt.unstable_cancelCallback,Fk=mt.unstable_shouldYield,jk=mt.unstable_requestPaint,Se=mt.unstable_now,Bk=mt.unstable_getCurrentPriorityLevel,Ju=mt.unstable_ImmediatePriority,jm=mt.unstable_UserBlockingPriority,Ko=mt.unstable_NormalPriority,Vk=mt.unstable_LowPriority,Bm=mt.unstable_IdlePriority,Ma=null,Zt=null;function zk(t){if(Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(Ma,t,void 0,(t.current.flags&128)===128)}catch{}}var jt=Math.clz32?Math.clz32:Wk,$k=Math.log,qk=Math.LN2;function Wk(t){return t>>>=0,t===0?32:31-($k(t)/qk|0)|0}var Xs=64,Zs=4194304;function Xr(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Go(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Xr(a):(s&=o,s!==0&&(i=Xr(s)))}else o=n&~r,o!==0?i=Xr(o):s!==0&&(i=Xr(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-jt(e),r=1<<n,i|=t[n],e&=~r;return i}function Hk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kk(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-jt(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=Hk(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function kl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Vm(){var t=Xs;return Xs<<=1,!(Xs&4194240)&&(Xs=64),t}function fc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Bs(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-jt(e),t[e]=n}function Gk(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-jt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Yu(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-jt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ee=0;function zm(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $m,Xu,qm,Wm,Hm,bl=!1,eo=[],Hn=null,Kn=null,Gn=null,vs=new Map,ys=new Map,Bn=[],Qk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Df(t,e){switch(t){case"focusin":case"focusout":Hn=null;break;case"dragenter":case"dragleave":Kn=null;break;case"mouseover":case"mouseout":Gn=null;break;case"pointerover":case"pointerout":vs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ys.delete(e.pointerId)}}function Ur(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=zs(e),e!==null&&Xu(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Jk(t,e,n,i,r){switch(e){case"focusin":return Hn=Ur(Hn,t,e,n,i,r),!0;case"dragenter":return Kn=Ur(Kn,t,e,n,i,r),!0;case"mouseover":return Gn=Ur(Gn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return vs.set(s,Ur(vs.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ys.set(s,Ur(ys.get(s)||null,t,e,n,i,r)),!0}return!1}function Km(t){var e=mi(t.target);if(e!==null){var n=Ni(e);if(n!==null){if(e=n.tag,e===13){if(e=Am(n),e!==null){t.blockedOn=e,Hm(t.priority,function(){qm(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ko(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Sl(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);ml=i,n.target.dispatchEvent(i),ml=null}else return e=zs(n),e!==null&&Xu(e),t.blockedOn=n,!1;e.shift()}return!0}function Nf(t,e,n){ko(t)&&n.delete(e)}function Yk(){bl=!1,Hn!==null&&ko(Hn)&&(Hn=null),Kn!==null&&ko(Kn)&&(Kn=null),Gn!==null&&ko(Gn)&&(Gn=null),vs.forEach(Nf),ys.forEach(Nf)}function Fr(t,e){t.blockedOn===e&&(t.blockedOn=null,bl||(bl=!0,mt.unstable_scheduleCallback(mt.unstable_NormalPriority,Yk)))}function ks(t){function e(r){return Fr(r,t)}if(0<eo.length){Fr(eo[0],t);for(var n=1;n<eo.length;n++){var i=eo[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Hn!==null&&Fr(Hn,t),Kn!==null&&Fr(Kn,t),Gn!==null&&Fr(Gn,t),vs.forEach(e),ys.forEach(e),n=0;n<Bn.length;n++)i=Bn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Bn.length&&(n=Bn[0],n.blockedOn===null);)Km(n),n.blockedOn===null&&Bn.shift()}var or=_n.ReactCurrentBatchConfig,Qo=!0;function Xk(t,e,n,i){var r=ee,s=or.transition;or.transition=null;try{ee=1,Zu(t,e,n,i)}finally{ee=r,or.transition=s}}function Zk(t,e,n,i){var r=ee,s=or.transition;or.transition=null;try{ee=4,Zu(t,e,n,i)}finally{ee=r,or.transition=s}}function Zu(t,e,n,i){if(Qo){var r=Sl(t,e,n,i);if(r===null)Cc(t,e,i,Jo,n),Df(t,i);else if(Jk(r,t,e,n,i))i.stopPropagation();else if(Df(t,i),e&4&&-1<Qk.indexOf(t)){for(;r!==null;){var s=zs(r);if(s!==null&&$m(s),s=Sl(t,e,n,i),s===null&&Cc(t,e,i,Jo,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Cc(t,e,i,null,n)}}var Jo=null;function Sl(t,e,n,i){if(Jo=null,t=Qu(i),t=mi(t),t!==null)if(e=Ni(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Am(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Jo=t,null}function Gm(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bk()){case Ju:return 1;case jm:return 4;case Ko:case Vk:return 16;case Bm:return 536870912;default:return 16}default:return 16}}var $n=null,ed=null,bo=null;function Qm(){if(bo)return bo;var t,e=ed,n=e.length,i,r="value"in $n?$n.value:$n.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return bo=r.slice(t,1<i?1-i:void 0)}function So(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function to(){return!0}function Af(){return!1}function vt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?to:Af,this.isPropagationStopped=Af,this}return ge(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=to)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=to)},persist:function(){},isPersistent:to}),e}var Ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=vt(Ir),Vs=ge({},Ir,{view:0,detail:0}),eb=vt(Vs),hc,pc,jr,Da=ge({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==jr&&(jr&&t.type==="mousemove"?(hc=t.screenX-jr.screenX,pc=t.screenY-jr.screenY):pc=hc=0,jr=t),hc)},movementY:function(t){return"movementY"in t?t.movementY:pc}}),Lf=vt(Da),tb=ge({},Da,{dataTransfer:0}),nb=vt(tb),ib=ge({},Vs,{relatedTarget:0}),mc=vt(ib),rb=ge({},Ir,{animationName:0,elapsedTime:0,pseudoElement:0}),sb=vt(rb),ob=ge({},Ir,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ab=vt(ob),cb=ge({},Ir,{data:0}),Uf=vt(cb),lb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ub={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},db={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=db[t])?!!e[t]:!1}function nd(){return fb}var hb=ge({},Vs,{key:function(t){if(t.key){var e=lb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=So(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ub[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nd,charCode:function(t){return t.type==="keypress"?So(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?So(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),pb=vt(hb),mb=ge({},Da,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ff=vt(mb),gb=ge({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nd}),vb=vt(gb),yb=ge({},Ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),kb=vt(yb),bb=ge({},Da,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Sb=vt(bb),Cb=[9,13,27,32],id=Sn&&"CompositionEvent"in window,rs=null;Sn&&"documentMode"in document&&(rs=document.documentMode);var Tb=Sn&&"TextEvent"in window&&!rs,Jm=Sn&&(!id||rs&&8<rs&&11>=rs),jf=" ",Bf=!1;function Ym(t,e){switch(t){case"keyup":return Cb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xm(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wi=!1;function wb(t,e){switch(t){case"compositionend":return Xm(e);case"keypress":return e.which!==32?null:(Bf=!0,jf);case"textInput":return t=e.data,t===jf&&Bf?null:t;default:return null}}function Eb(t,e){if(Wi)return t==="compositionend"||!id&&Ym(t,e)?(t=Qm(),bo=ed=$n=null,Wi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Jm&&e.locale!=="ko"?null:e.data;default:return null}}var Pb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Pb[t.type]:e==="textarea"}function Zm(t,e,n,i){Im(i),e=Yo(e,"onChange"),0<e.length&&(n=new td("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var ss=null,bs=null;function Rb(t){ug(t,0)}function Na(t){var e=Gi(t);if(Tm(e))return t}function _b(t,e){if(t==="change")return e}var eg=!1;if(Sn){var gc;if(Sn){var vc="oninput"in document;if(!vc){var zf=document.createElement("div");zf.setAttribute("oninput","return;"),vc=typeof zf.oninput=="function"}gc=vc}else gc=!1;eg=gc&&(!document.documentMode||9<document.documentMode)}function $f(){ss&&(ss.detachEvent("onpropertychange",tg),bs=ss=null)}function tg(t){if(t.propertyName==="value"&&Na(bs)){var e=[];Zm(e,bs,t,Qu(t)),Nm(Rb,e)}}function xb(t,e,n){t==="focusin"?($f(),ss=e,bs=n,ss.attachEvent("onpropertychange",tg)):t==="focusout"&&$f()}function Ib(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Na(bs)}function Ob(t,e){if(t==="click")return Na(e)}function Mb(t,e){if(t==="input"||t==="change")return Na(e)}function Db(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vt=typeof Object.is=="function"?Object.is:Db;function Ss(t,e){if(Vt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!il.call(e,r)||!Vt(t[r],e[r]))return!1}return!0}function qf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Wf(t,e){var n=qf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=qf(n)}}function ng(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ng(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ig(){for(var t=window,e=qo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=qo(t.document)}return e}function rd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Nb(t){var e=ig(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ng(n.ownerDocument.documentElement,n)){if(i!==null&&rd(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Wf(n,s);var o=Wf(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Ab=Sn&&"documentMode"in document&&11>=document.documentMode,Hi=null,Cl=null,os=null,Tl=!1;function Hf(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Tl||Hi==null||Hi!==qo(i)||(i=Hi,"selectionStart"in i&&rd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),os&&Ss(os,i)||(os=i,i=Yo(Cl,"onSelect"),0<i.length&&(e=new td("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Hi)))}function no(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ki={animationend:no("Animation","AnimationEnd"),animationiteration:no("Animation","AnimationIteration"),animationstart:no("Animation","AnimationStart"),transitionend:no("Transition","TransitionEnd")},yc={},rg={};Sn&&(rg=document.createElement("div").style,"AnimationEvent"in window||(delete Ki.animationend.animation,delete Ki.animationiteration.animation,delete Ki.animationstart.animation),"TransitionEvent"in window||delete Ki.transitionend.transition);function Aa(t){if(yc[t])return yc[t];if(!Ki[t])return t;var e=Ki[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in rg)return yc[t]=e[n];return t}var sg=Aa("animationend"),og=Aa("animationiteration"),ag=Aa("animationstart"),cg=Aa("transitionend"),lg=new Map,Kf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ai(t,e){lg.set(t,e),Di(e,[t])}for(var kc=0;kc<Kf.length;kc++){var bc=Kf[kc],Lb=bc.toLowerCase(),Ub=bc[0].toUpperCase()+bc.slice(1);ai(Lb,"on"+Ub)}ai(sg,"onAnimationEnd");ai(og,"onAnimationIteration");ai(ag,"onAnimationStart");ai("dblclick","onDoubleClick");ai("focusin","onFocus");ai("focusout","onBlur");ai(cg,"onTransitionEnd");gr("onMouseEnter",["mouseout","mouseover"]);gr("onMouseLeave",["mouseout","mouseover"]);gr("onPointerEnter",["pointerout","pointerover"]);gr("onPointerLeave",["pointerout","pointerover"]);Di("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Di("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Di("onBeforeInput",["compositionend","keypress","textInput","paste"]);Di("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Di("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Di("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fb=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zr));function Gf(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,Lk(i,e,void 0,t),t.currentTarget=null}function ug(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Gf(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Gf(r,a,l),s=c}}}if(Ho)throw t=yl,Ho=!1,yl=null,t}function ce(t,e){var n=e[_l];n===void 0&&(n=e[_l]=new Set);var i=t+"__bubble";n.has(i)||(dg(e,t,2,!1),n.add(i))}function Sc(t,e,n){var i=0;e&&(i|=4),dg(n,t,i,e)}var io="_reactListening"+Math.random().toString(36).slice(2);function Cs(t){if(!t[io]){t[io]=!0,ym.forEach(function(n){n!=="selectionchange"&&(Fb.has(n)||Sc(n,!1,t),Sc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[io]||(e[io]=!0,Sc("selectionchange",!1,e))}}function dg(t,e,n,i){switch(Gm(e)){case 1:var r=Xk;break;case 4:r=Zk;break;default:r=Zu}n=r.bind(null,e,n,t),r=void 0,!vl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Cc(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=mi(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Nm(function(){var l=s,u=Qu(n),d=[];e:{var f=lg.get(t);if(f!==void 0){var p=td,y=t;switch(t){case"keypress":if(So(n)===0)break e;case"keydown":case"keyup":p=pb;break;case"focusin":y="focus",p=mc;break;case"focusout":y="blur",p=mc;break;case"beforeblur":case"afterblur":p=mc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Lf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=nb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=vb;break;case sg:case og:case ag:p=sb;break;case cg:p=kb;break;case"scroll":p=eb;break;case"wheel":p=Sb;break;case"copy":case"cut":case"paste":p=ab;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Ff}var m=(e&4)!==0,T=!m&&t==="scroll",h=m?f!==null?f+"Capture":null:f;m=[];for(var v=l,k;v!==null;){k=v;var b=k.stateNode;if(k.tag===5&&b!==null&&(k=b,h!==null&&(b=gs(v,h),b!=null&&m.push(Ts(v,b,k)))),T)break;v=v.return}0<m.length&&(f=new p(f,y,null,n,u),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==ml&&(y=n.relatedTarget||n.fromElement)&&(mi(y)||y[Cn]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(y=n.relatedTarget||n.toElement,p=l,y=y?mi(y):null,y!==null&&(T=Ni(y),y!==T||y.tag!==5&&y.tag!==6)&&(y=null)):(p=null,y=l),p!==y)){if(m=Lf,b="onMouseLeave",h="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(m=Ff,b="onPointerLeave",h="onPointerEnter",v="pointer"),T=p==null?f:Gi(p),k=y==null?f:Gi(y),f=new m(b,v+"leave",p,n,u),f.target=T,f.relatedTarget=k,b=null,mi(u)===l&&(m=new m(h,v+"enter",y,n,u),m.target=k,m.relatedTarget=T,b=m),T=b,p&&y)t:{for(m=p,h=y,v=0,k=m;k;k=ji(k))v++;for(k=0,b=h;b;b=ji(b))k++;for(;0<v-k;)m=ji(m),v--;for(;0<k-v;)h=ji(h),k--;for(;v--;){if(m===h||h!==null&&m===h.alternate)break t;m=ji(m),h=ji(h)}m=null}else m=null;p!==null&&Qf(d,f,p,m,!1),y!==null&&T!==null&&Qf(d,T,y,m,!0)}}e:{if(f=l?Gi(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var S=_b;else if(Vf(f))if(eg)S=Mb;else{S=Ib;var w=xb}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=Ob);if(S&&(S=S(t,l))){Zm(d,S,n,u);break e}w&&w(t,f,l),t==="focusout"&&(w=f._wrapperState)&&w.controlled&&f.type==="number"&&ul(f,"number",f.value)}switch(w=l?Gi(l):window,t){case"focusin":(Vf(w)||w.contentEditable==="true")&&(Hi=w,Cl=l,os=null);break;case"focusout":os=Cl=Hi=null;break;case"mousedown":Tl=!0;break;case"contextmenu":case"mouseup":case"dragend":Tl=!1,Hf(d,n,u);break;case"selectionchange":if(Ab)break;case"keydown":case"keyup":Hf(d,n,u)}var P;if(id)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Wi?Ym(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(Jm&&n.locale!=="ko"&&(Wi||x!=="onCompositionStart"?x==="onCompositionEnd"&&Wi&&(P=Qm()):($n=u,ed="value"in $n?$n.value:$n.textContent,Wi=!0)),w=Yo(l,x),0<w.length&&(x=new Uf(x,t,null,n,u),d.push({event:x,listeners:w}),P?x.data=P:(P=Xm(n),P!==null&&(x.data=P)))),(P=Tb?wb(t,n):Eb(t,n))&&(l=Yo(l,"onBeforeInput"),0<l.length&&(u=new Uf("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=P))}ug(d,e)})}function Ts(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Yo(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=gs(t,n),s!=null&&i.unshift(Ts(t,s,r)),s=gs(t,e),s!=null&&i.push(Ts(t,s,r))),t=t.return}return i}function ji(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Qf(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=gs(n,s),c!=null&&o.unshift(Ts(n,c,a))):r||(c=gs(n,s),c!=null&&o.push(Ts(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var jb=/\r\n?/g,Bb=/\u0000|\uFFFD/g;function Jf(t){return(typeof t=="string"?t:""+t).replace(jb,`
`).replace(Bb,"")}function ro(t,e,n){if(e=Jf(e),Jf(t)!==e&&n)throw Error(A(425))}function Xo(){}var wl=null,El=null;function Pl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Rl=typeof setTimeout=="function"?setTimeout:void 0,Vb=typeof clearTimeout=="function"?clearTimeout:void 0,Yf=typeof Promise=="function"?Promise:void 0,zb=typeof queueMicrotask=="function"?queueMicrotask:typeof Yf<"u"?function(t){return Yf.resolve(null).then(t).catch($b)}:Rl;function $b(t){setTimeout(function(){throw t})}function Tc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),ks(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);ks(e)}function Qn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Xf(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Or=Math.random().toString(36).slice(2),Jt="__reactFiber$"+Or,ws="__reactProps$"+Or,Cn="__reactContainer$"+Or,_l="__reactEvents$"+Or,qb="__reactListeners$"+Or,Wb="__reactHandles$"+Or;function mi(t){var e=t[Jt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Cn]||n[Jt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Xf(t);t!==null;){if(n=t[Jt])return n;t=Xf(t)}return e}t=n,n=t.parentNode}return null}function zs(t){return t=t[Jt]||t[Cn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Gi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(A(33))}function La(t){return t[ws]||null}var xl=[],Qi=-1;function ci(t){return{current:t}}function ue(t){0>Qi||(t.current=xl[Qi],xl[Qi]=null,Qi--)}function oe(t,e){Qi++,xl[Qi]=t.current,t.current=e}var ri={},$e=ci(ri),tt=ci(!1),Ti=ri;function vr(t,e){var n=t.type.contextTypes;if(!n)return ri;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function nt(t){return t=t.childContextTypes,t!=null}function Zo(){ue(tt),ue($e)}function Zf(t,e,n){if($e.current!==ri)throw Error(A(168));oe($e,e),oe(tt,n)}function fg(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(A(108,xk(t)||"Unknown",r));return ge({},n,i)}function ea(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ri,Ti=$e.current,oe($e,t),oe(tt,tt.current),!0}function eh(t,e,n){var i=t.stateNode;if(!i)throw Error(A(169));n?(t=fg(t,e,Ti),i.__reactInternalMemoizedMergedChildContext=t,ue(tt),ue($e),oe($e,t)):ue(tt),oe(tt,n)}var fn=null,Ua=!1,wc=!1;function hg(t){fn===null?fn=[t]:fn.push(t)}function Hb(t){Ua=!0,hg(t)}function li(){if(!wc&&fn!==null){wc=!0;var t=0,e=ee;try{var n=fn;for(ee=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}fn=null,Ua=!1}catch(r){throw fn!==null&&(fn=fn.slice(t+1)),Fm(Ju,li),r}finally{ee=e,wc=!1}}return null}var Ji=[],Yi=0,ta=null,na=0,yt=[],kt=0,wi=null,yn=1,kn="";function fi(t,e){Ji[Yi++]=na,Ji[Yi++]=ta,ta=t,na=e}function pg(t,e,n){yt[kt++]=yn,yt[kt++]=kn,yt[kt++]=wi,wi=t;var i=yn;t=kn;var r=32-jt(i)-1;i&=~(1<<r),n+=1;var s=32-jt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,yn=1<<32-jt(e)+r|n<<r|i,kn=s+t}else yn=1<<s|n<<r|i,kn=t}function sd(t){t.return!==null&&(fi(t,1),pg(t,1,0))}function od(t){for(;t===ta;)ta=Ji[--Yi],Ji[Yi]=null,na=Ji[--Yi],Ji[Yi]=null;for(;t===wi;)wi=yt[--kt],yt[kt]=null,kn=yt[--kt],yt[kt]=null,yn=yt[--kt],yt[kt]=null}var ft=null,ut=null,fe=!1,Dt=null;function mg(t,e){var n=bt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function th(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,ut=Qn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,ut=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=wi!==null?{id:yn,overflow:kn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=bt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ft=t,ut=null,!0):!1;default:return!1}}function Il(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ol(t){if(fe){var e=ut;if(e){var n=e;if(!th(t,e)){if(Il(t))throw Error(A(418));e=Qn(n.nextSibling);var i=ft;e&&th(t,e)?mg(i,n):(t.flags=t.flags&-4097|2,fe=!1,ft=t)}}else{if(Il(t))throw Error(A(418));t.flags=t.flags&-4097|2,fe=!1,ft=t}}}function nh(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function so(t){if(t!==ft)return!1;if(!fe)return nh(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Pl(t.type,t.memoizedProps)),e&&(e=ut)){if(Il(t))throw gg(),Error(A(418));for(;e;)mg(t,e),e=Qn(e.nextSibling)}if(nh(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(A(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ut=Qn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ut=null}}else ut=ft?Qn(t.stateNode.nextSibling):null;return!0}function gg(){for(var t=ut;t;)t=Qn(t.nextSibling)}function yr(){ut=ft=null,fe=!1}function ad(t){Dt===null?Dt=[t]:Dt.push(t)}var Kb=_n.ReactCurrentBatchConfig;function Br(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(A(309));var i=n.stateNode}if(!i)throw Error(A(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(A(284));if(!n._owner)throw Error(A(290,t))}return t}function oo(t,e){throw t=Object.prototype.toString.call(e),Error(A(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ih(t){var e=t._init;return e(t._payload)}function vg(t){function e(h,v){if(t){var k=h.deletions;k===null?(h.deletions=[v],h.flags|=16):k.push(v)}}function n(h,v){if(!t)return null;for(;v!==null;)e(h,v),v=v.sibling;return null}function i(h,v){for(h=new Map;v!==null;)v.key!==null?h.set(v.key,v):h.set(v.index,v),v=v.sibling;return h}function r(h,v){return h=Zn(h,v),h.index=0,h.sibling=null,h}function s(h,v,k){return h.index=k,t?(k=h.alternate,k!==null?(k=k.index,k<v?(h.flags|=2,v):k):(h.flags|=2,v)):(h.flags|=1048576,v)}function o(h){return t&&h.alternate===null&&(h.flags|=2),h}function a(h,v,k,b){return v===null||v.tag!==6?(v=Oc(k,h.mode,b),v.return=h,v):(v=r(v,k),v.return=h,v)}function c(h,v,k,b){var S=k.type;return S===qi?u(h,v,k.props.children,b,k.key):v!==null&&(v.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Fn&&ih(S)===v.type)?(b=r(v,k.props),b.ref=Br(h,v,k),b.return=h,b):(b=_o(k.type,k.key,k.props,null,h.mode,b),b.ref=Br(h,v,k),b.return=h,b)}function l(h,v,k,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==k.containerInfo||v.stateNode.implementation!==k.implementation?(v=Mc(k,h.mode,b),v.return=h,v):(v=r(v,k.children||[]),v.return=h,v)}function u(h,v,k,b,S){return v===null||v.tag!==7?(v=ki(k,h.mode,b,S),v.return=h,v):(v=r(v,k),v.return=h,v)}function d(h,v,k){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Oc(""+v,h.mode,k),v.return=h,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Qs:return k=_o(v.type,v.key,v.props,null,h.mode,k),k.ref=Br(h,null,v),k.return=h,k;case $i:return v=Mc(v,h.mode,k),v.return=h,v;case Fn:var b=v._init;return d(h,b(v._payload),k)}if(Yr(v)||Ar(v))return v=ki(v,h.mode,k,null),v.return=h,v;oo(h,v)}return null}function f(h,v,k,b){var S=v!==null?v.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return S!==null?null:a(h,v,""+k,b);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Qs:return k.key===S?c(h,v,k,b):null;case $i:return k.key===S?l(h,v,k,b):null;case Fn:return S=k._init,f(h,v,S(k._payload),b)}if(Yr(k)||Ar(k))return S!==null?null:u(h,v,k,b,null);oo(h,k)}return null}function p(h,v,k,b,S){if(typeof b=="string"&&b!==""||typeof b=="number")return h=h.get(k)||null,a(v,h,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Qs:return h=h.get(b.key===null?k:b.key)||null,c(v,h,b,S);case $i:return h=h.get(b.key===null?k:b.key)||null,l(v,h,b,S);case Fn:var w=b._init;return p(h,v,k,w(b._payload),S)}if(Yr(b)||Ar(b))return h=h.get(k)||null,u(v,h,b,S,null);oo(v,b)}return null}function y(h,v,k,b){for(var S=null,w=null,P=v,x=v=0,O=null;P!==null&&x<k.length;x++){P.index>x?(O=P,P=null):O=P.sibling;var I=f(h,P,k[x],b);if(I===null){P===null&&(P=O);break}t&&P&&I.alternate===null&&e(h,P),v=s(I,v,x),w===null?S=I:w.sibling=I,w=I,P=O}if(x===k.length)return n(h,P),fe&&fi(h,x),S;if(P===null){for(;x<k.length;x++)P=d(h,k[x],b),P!==null&&(v=s(P,v,x),w===null?S=P:w.sibling=P,w=P);return fe&&fi(h,x),S}for(P=i(h,P);x<k.length;x++)O=p(P,h,x,k[x],b),O!==null&&(t&&O.alternate!==null&&P.delete(O.key===null?x:O.key),v=s(O,v,x),w===null?S=O:w.sibling=O,w=O);return t&&P.forEach(function(N){return e(h,N)}),fe&&fi(h,x),S}function m(h,v,k,b){var S=Ar(k);if(typeof S!="function")throw Error(A(150));if(k=S.call(k),k==null)throw Error(A(151));for(var w=S=null,P=v,x=v=0,O=null,I=k.next();P!==null&&!I.done;x++,I=k.next()){P.index>x?(O=P,P=null):O=P.sibling;var N=f(h,P,I.value,b);if(N===null){P===null&&(P=O);break}t&&P&&N.alternate===null&&e(h,P),v=s(N,v,x),w===null?S=N:w.sibling=N,w=N,P=O}if(I.done)return n(h,P),fe&&fi(h,x),S;if(P===null){for(;!I.done;x++,I=k.next())I=d(h,I.value,b),I!==null&&(v=s(I,v,x),w===null?S=I:w.sibling=I,w=I);return fe&&fi(h,x),S}for(P=i(h,P);!I.done;x++,I=k.next())I=p(P,h,x,I.value,b),I!==null&&(t&&I.alternate!==null&&P.delete(I.key===null?x:I.key),v=s(I,v,x),w===null?S=I:w.sibling=I,w=I);return t&&P.forEach(function(j){return e(h,j)}),fe&&fi(h,x),S}function T(h,v,k,b){if(typeof k=="object"&&k!==null&&k.type===qi&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Qs:e:{for(var S=k.key,w=v;w!==null;){if(w.key===S){if(S=k.type,S===qi){if(w.tag===7){n(h,w.sibling),v=r(w,k.props.children),v.return=h,h=v;break e}}else if(w.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Fn&&ih(S)===w.type){n(h,w.sibling),v=r(w,k.props),v.ref=Br(h,w,k),v.return=h,h=v;break e}n(h,w);break}else e(h,w);w=w.sibling}k.type===qi?(v=ki(k.props.children,h.mode,b,k.key),v.return=h,h=v):(b=_o(k.type,k.key,k.props,null,h.mode,b),b.ref=Br(h,v,k),b.return=h,h=b)}return o(h);case $i:e:{for(w=k.key;v!==null;){if(v.key===w)if(v.tag===4&&v.stateNode.containerInfo===k.containerInfo&&v.stateNode.implementation===k.implementation){n(h,v.sibling),v=r(v,k.children||[]),v.return=h,h=v;break e}else{n(h,v);break}else e(h,v);v=v.sibling}v=Mc(k,h.mode,b),v.return=h,h=v}return o(h);case Fn:return w=k._init,T(h,v,w(k._payload),b)}if(Yr(k))return y(h,v,k,b);if(Ar(k))return m(h,v,k,b);oo(h,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,v!==null&&v.tag===6?(n(h,v.sibling),v=r(v,k),v.return=h,h=v):(n(h,v),v=Oc(k,h.mode,b),v.return=h,h=v),o(h)):n(h,v)}return T}var kr=vg(!0),yg=vg(!1),ia=ci(null),ra=null,Xi=null,cd=null;function ld(){cd=Xi=ra=null}function ud(t){var e=ia.current;ue(ia),t._currentValue=e}function Ml(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function ar(t,e){ra=t,cd=Xi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ze=!0),t.firstContext=null)}function Ct(t){var e=t._currentValue;if(cd!==t)if(t={context:t,memoizedValue:e,next:null},Xi===null){if(ra===null)throw Error(A(308));Xi=t,ra.dependencies={lanes:0,firstContext:t}}else Xi=Xi.next=t;return e}var gi=null;function dd(t){gi===null?gi=[t]:gi.push(t)}function kg(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,dd(e)):(n.next=r.next,r.next=n),e.interleaved=n,Tn(t,i)}function Tn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var jn=!1;function fd(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bg(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Jn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,J&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Tn(t,n)}return r=i.interleaved,r===null?(e.next=e,dd(i)):(e.next=r.next,r.next=e),i.interleaved=e,Tn(t,n)}function Co(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Yu(t,n)}}function rh(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function sa(t,e,n,i){var r=t.updateQueue;jn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var f=a.lane,p=a.eventTime;if((i&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,m=a;switch(f=e,p=n,m.tag){case 1:if(y=m.payload,typeof y=="function"){d=y.call(p,d,f);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=m.payload,f=typeof y=="function"?y.call(p,d,f):y,f==null)break e;d=ge({},d,f);break e;case 2:jn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Pi|=o,t.lanes=o,t.memoizedState=d}}function sh(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(A(191,r));r.call(i)}}}var $s={},en=ci($s),Es=ci($s),Ps=ci($s);function vi(t){if(t===$s)throw Error(A(174));return t}function hd(t,e){switch(oe(Ps,e),oe(Es,t),oe(en,$s),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:fl(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=fl(e,t)}ue(en),oe(en,e)}function br(){ue(en),ue(Es),ue(Ps)}function Sg(t){vi(Ps.current);var e=vi(en.current),n=fl(e,t.type);e!==n&&(oe(Es,t),oe(en,n))}function pd(t){Es.current===t&&(ue(en),ue(Es))}var pe=ci(0);function oa(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ec=[];function md(){for(var t=0;t<Ec.length;t++)Ec[t]._workInProgressVersionPrimary=null;Ec.length=0}var To=_n.ReactCurrentDispatcher,Pc=_n.ReactCurrentBatchConfig,Ei=0,me=null,Pe=null,_e=null,aa=!1,as=!1,Rs=0,Gb=0;function je(){throw Error(A(321))}function gd(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Vt(t[n],e[n]))return!1;return!0}function vd(t,e,n,i,r,s){if(Ei=s,me=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,To.current=t===null||t.memoizedState===null?Xb:Zb,t=n(i,r),as){s=0;do{if(as=!1,Rs=0,25<=s)throw Error(A(301));s+=1,_e=Pe=null,e.updateQueue=null,To.current=eS,t=n(i,r)}while(as)}if(To.current=ca,e=Pe!==null&&Pe.next!==null,Ei=0,_e=Pe=me=null,aa=!1,e)throw Error(A(300));return t}function yd(){var t=Rs!==0;return Rs=0,t}function Gt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _e===null?me.memoizedState=_e=t:_e=_e.next=t,_e}function Tt(){if(Pe===null){var t=me.alternate;t=t!==null?t.memoizedState:null}else t=Pe.next;var e=_e===null?me.memoizedState:_e.next;if(e!==null)_e=e,Pe=t;else{if(t===null)throw Error(A(310));Pe=t,t={memoizedState:Pe.memoizedState,baseState:Pe.baseState,baseQueue:Pe.baseQueue,queue:Pe.queue,next:null},_e===null?me.memoizedState=_e=t:_e=_e.next=t}return _e}function _s(t,e){return typeof e=="function"?e(t):e}function Rc(t){var e=Tt(),n=e.queue;if(n===null)throw Error(A(311));n.lastRenderedReducer=t;var i=Pe,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((Ei&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,me.lanes|=u,Pi|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,Vt(i,e.memoizedState)||(Ze=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,me.lanes|=s,Pi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function _c(t){var e=Tt(),n=e.queue;if(n===null)throw Error(A(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Vt(s,e.memoizedState)||(Ze=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Cg(){}function Tg(t,e){var n=me,i=Tt(),r=e(),s=!Vt(i.memoizedState,r);if(s&&(i.memoizedState=r,Ze=!0),i=i.queue,kd(Pg.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||_e!==null&&_e.memoizedState.tag&1){if(n.flags|=2048,xs(9,Eg.bind(null,n,i,r,e),void 0,null),Oe===null)throw Error(A(349));Ei&30||wg(n,e,r)}return r}function wg(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Eg(t,e,n,i){e.value=n,e.getSnapshot=i,Rg(e)&&_g(t)}function Pg(t,e,n){return n(function(){Rg(e)&&_g(t)})}function Rg(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vt(t,n)}catch{return!0}}function _g(t){var e=Tn(t,1);e!==null&&Bt(e,t,1,-1)}function oh(t){var e=Gt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:t},e.queue=t,t=t.dispatch=Yb.bind(null,me,t),[e.memoizedState,t]}function xs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=me.updateQueue,e===null?(e={lastEffect:null,stores:null},me.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function xg(){return Tt().memoizedState}function wo(t,e,n,i){var r=Gt();me.flags|=t,r.memoizedState=xs(1|e,n,void 0,i===void 0?null:i)}function Fa(t,e,n,i){var r=Tt();i=i===void 0?null:i;var s=void 0;if(Pe!==null){var o=Pe.memoizedState;if(s=o.destroy,i!==null&&gd(i,o.deps)){r.memoizedState=xs(e,n,s,i);return}}me.flags|=t,r.memoizedState=xs(1|e,n,s,i)}function ah(t,e){return wo(8390656,8,t,e)}function kd(t,e){return Fa(2048,8,t,e)}function Ig(t,e){return Fa(4,2,t,e)}function Og(t,e){return Fa(4,4,t,e)}function Mg(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Dg(t,e,n){return n=n!=null?n.concat([t]):null,Fa(4,4,Mg.bind(null,e,t),n)}function bd(){}function Ng(t,e){var n=Tt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&gd(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Ag(t,e){var n=Tt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&gd(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Lg(t,e,n){return Ei&21?(Vt(n,e)||(n=Vm(),me.lanes|=n,Pi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ze=!0),t.memoizedState=n)}function Qb(t,e){var n=ee;ee=n!==0&&4>n?n:4,t(!0);var i=Pc.transition;Pc.transition={};try{t(!1),e()}finally{ee=n,Pc.transition=i}}function Ug(){return Tt().memoizedState}function Jb(t,e,n){var i=Xn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Fg(t))jg(e,n);else if(n=kg(t,e,n,i),n!==null){var r=Ke();Bt(n,t,i,r),Bg(n,e,i)}}function Yb(t,e,n){var i=Xn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Fg(t))jg(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Vt(a,o)){var c=e.interleaved;c===null?(r.next=r,dd(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=kg(t,e,r,i),n!==null&&(r=Ke(),Bt(n,t,i,r),Bg(n,e,i))}}function Fg(t){var e=t.alternate;return t===me||e!==null&&e===me}function jg(t,e){as=aa=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Bg(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Yu(t,n)}}var ca={readContext:Ct,useCallback:je,useContext:je,useEffect:je,useImperativeHandle:je,useInsertionEffect:je,useLayoutEffect:je,useMemo:je,useReducer:je,useRef:je,useState:je,useDebugValue:je,useDeferredValue:je,useTransition:je,useMutableSource:je,useSyncExternalStore:je,useId:je,unstable_isNewReconciler:!1},Xb={readContext:Ct,useCallback:function(t,e){return Gt().memoizedState=[t,e===void 0?null:e],t},useContext:Ct,useEffect:ah,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,wo(4194308,4,Mg.bind(null,e,t),n)},useLayoutEffect:function(t,e){return wo(4194308,4,t,e)},useInsertionEffect:function(t,e){return wo(4,2,t,e)},useMemo:function(t,e){var n=Gt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Gt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Jb.bind(null,me,t),[i.memoizedState,t]},useRef:function(t){var e=Gt();return t={current:t},e.memoizedState=t},useState:oh,useDebugValue:bd,useDeferredValue:function(t){return Gt().memoizedState=t},useTransition:function(){var t=oh(!1),e=t[0];return t=Qb.bind(null,t[1]),Gt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=me,r=Gt();if(fe){if(n===void 0)throw Error(A(407));n=n()}else{if(n=e(),Oe===null)throw Error(A(349));Ei&30||wg(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,ah(Pg.bind(null,i,s,t),[t]),i.flags|=2048,xs(9,Eg.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Gt(),e=Oe.identifierPrefix;if(fe){var n=kn,i=yn;n=(i&~(1<<32-jt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Rs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Gb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Zb={readContext:Ct,useCallback:Ng,useContext:Ct,useEffect:kd,useImperativeHandle:Dg,useInsertionEffect:Ig,useLayoutEffect:Og,useMemo:Ag,useReducer:Rc,useRef:xg,useState:function(){return Rc(_s)},useDebugValue:bd,useDeferredValue:function(t){var e=Tt();return Lg(e,Pe.memoizedState,t)},useTransition:function(){var t=Rc(_s)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:Cg,useSyncExternalStore:Tg,useId:Ug,unstable_isNewReconciler:!1},eS={readContext:Ct,useCallback:Ng,useContext:Ct,useEffect:kd,useImperativeHandle:Dg,useInsertionEffect:Ig,useLayoutEffect:Og,useMemo:Ag,useReducer:_c,useRef:xg,useState:function(){return _c(_s)},useDebugValue:bd,useDeferredValue:function(t){var e=Tt();return Pe===null?e.memoizedState=t:Lg(e,Pe.memoizedState,t)},useTransition:function(){var t=_c(_s)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:Cg,useSyncExternalStore:Tg,useId:Ug,unstable_isNewReconciler:!1};function It(t,e){if(t&&t.defaultProps){e=ge({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Dl(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ge({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ja={isMounted:function(t){return(t=t._reactInternals)?Ni(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ke(),r=Xn(t),s=bn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Jn(t,s,r),e!==null&&(Bt(e,t,r,i),Co(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ke(),r=Xn(t),s=bn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Jn(t,s,r),e!==null&&(Bt(e,t,r,i),Co(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ke(),i=Xn(t),r=bn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Jn(t,r,i),e!==null&&(Bt(e,t,i,n),Co(e,t,i))}};function ch(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ss(n,i)||!Ss(r,s):!0}function Vg(t,e,n){var i=!1,r=ri,s=e.contextType;return typeof s=="object"&&s!==null?s=Ct(s):(r=nt(e)?Ti:$e.current,i=e.contextTypes,s=(i=i!=null)?vr(t,r):ri),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ja,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function lh(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ja.enqueueReplaceState(e,e.state,null)}function Nl(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},fd(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ct(s):(s=nt(e)?Ti:$e.current,r.context=vr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Dl(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ja.enqueueReplaceState(r,r.state,null),sa(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Sr(t,e){try{var n="",i=e;do n+=_k(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function xc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Al(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var tS=typeof WeakMap=="function"?WeakMap:Map;function zg(t,e,n){n=bn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){ua||(ua=!0,Wl=i),Al(t,e)},n}function $g(t,e,n){n=bn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Al(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Al(t,e),typeof i!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function uh(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new tS;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=mS.bind(null,t,e,n),e.then(t,t))}function dh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function fh(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=bn(-1,1),e.tag=2,Jn(n,e,1))),n.lanes|=1),t)}var nS=_n.ReactCurrentOwner,Ze=!1;function He(t,e,n,i){e.child=t===null?yg(e,null,n,i):kr(e,t.child,n,i)}function hh(t,e,n,i,r){n=n.render;var s=e.ref;return ar(e,r),i=vd(t,e,n,i,s,r),n=yd(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wn(t,e,r)):(fe&&n&&sd(e),e.flags|=1,He(t,e,i,r),e.child)}function ph(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!_d(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,qg(t,e,s,i,r)):(t=_o(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ss,n(o,i)&&t.ref===e.ref)return wn(t,e,r)}return e.flags|=1,t=Zn(s,i),t.ref=e.ref,t.return=e,e.child=t}function qg(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ss(s,i)&&t.ref===e.ref)if(Ze=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Ze=!0);else return e.lanes=t.lanes,wn(t,e,r)}return Ll(t,e,n,i,r)}function Wg(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},oe(er,ct),ct|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,oe(er,ct),ct|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,oe(er,ct),ct|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,oe(er,ct),ct|=i;return He(t,e,r,n),e.child}function Hg(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ll(t,e,n,i,r){var s=nt(n)?Ti:$e.current;return s=vr(e,s),ar(e,r),n=vd(t,e,n,i,s,r),i=yd(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wn(t,e,r)):(fe&&i&&sd(e),e.flags|=1,He(t,e,n,r),e.child)}function mh(t,e,n,i,r){if(nt(n)){var s=!0;ea(e)}else s=!1;if(ar(e,r),e.stateNode===null)Eo(t,e),Vg(e,n,i),Nl(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Ct(l):(l=nt(n)?Ti:$e.current,l=vr(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&lh(e,o,i,l),jn=!1;var f=e.memoizedState;o.state=f,sa(e,i,o,r),c=e.memoizedState,a!==i||f!==c||tt.current||jn?(typeof u=="function"&&(Dl(e,n,u,i),c=e.memoizedState),(a=jn||ch(e,n,a,i,f,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,bg(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:It(e.type,a),o.props=l,d=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ct(c):(c=nt(n)?Ti:$e.current,c=vr(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==c)&&lh(e,o,i,c),jn=!1,f=e.memoizedState,o.state=f,sa(e,i,o,r);var y=e.memoizedState;a!==d||f!==y||tt.current||jn?(typeof p=="function"&&(Dl(e,n,p,i),y=e.memoizedState),(l=jn||ch(e,n,l,i,f,y,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return Ul(t,e,n,i,s,r)}function Ul(t,e,n,i,r,s){Hg(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&eh(e,n,!1),wn(t,e,s);i=e.stateNode,nS.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=kr(e,t.child,null,s),e.child=kr(e,null,a,s)):He(t,e,a,s),e.memoizedState=i.state,r&&eh(e,n,!0),e.child}function Kg(t){var e=t.stateNode;e.pendingContext?Zf(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Zf(t,e.context,!1),hd(t,e.containerInfo)}function gh(t,e,n,i,r){return yr(),ad(r),e.flags|=256,He(t,e,n,i),e.child}var Fl={dehydrated:null,treeContext:null,retryLane:0};function jl(t){return{baseLanes:t,cachePool:null,transitions:null}}function Gg(t,e,n){var i=e.pendingProps,r=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),oe(pe,r&1),t===null)return Ol(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=za(o,i,0,null),t=ki(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=jl(n),e.memoizedState=Fl,t):Sd(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return iS(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=Zn(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Zn(a,s):(s=ki(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?jl(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Fl,i}return s=t.child,t=s.sibling,i=Zn(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Sd(t,e){return e=za({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ao(t,e,n,i){return i!==null&&ad(i),kr(e,t.child,null,n),t=Sd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function iS(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=xc(Error(A(422))),ao(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=za({mode:"visible",children:i.children},r,0,null),s=ki(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&kr(e,t.child,null,o),e.child.memoizedState=jl(o),e.memoizedState=Fl,s);if(!(e.mode&1))return ao(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(A(419)),i=xc(s,i,void 0),ao(t,e,o,i)}if(a=(o&t.childLanes)!==0,Ze||a){if(i=Oe,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Tn(t,r),Bt(i,t,r,-1))}return Rd(),i=xc(Error(A(421))),ao(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=gS.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ut=Qn(r.nextSibling),ft=e,fe=!0,Dt=null,t!==null&&(yt[kt++]=yn,yt[kt++]=kn,yt[kt++]=wi,yn=t.id,kn=t.overflow,wi=e),e=Sd(e,i.children),e.flags|=4096,e)}function vh(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ml(t.return,e,n)}function Ic(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Qg(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(He(t,e,i.children,n),i=pe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&vh(t,n,e);else if(t.tag===19)vh(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(oe(pe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&oa(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Ic(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&oa(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Ic(e,!0,n,null,s);break;case"together":Ic(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Eo(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(A(153));if(e.child!==null){for(t=e.child,n=Zn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Zn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function rS(t,e,n){switch(e.tag){case 3:Kg(e),yr();break;case 5:Sg(e);break;case 1:nt(e.type)&&ea(e);break;case 4:hd(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;oe(ia,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(oe(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?Gg(t,e,n):(oe(pe,pe.current&1),t=wn(t,e,n),t!==null?t.sibling:null);oe(pe,pe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Qg(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),oe(pe,pe.current),i)break;return null;case 22:case 23:return e.lanes=0,Wg(t,e,n)}return wn(t,e,n)}var Jg,Bl,Yg,Xg;Jg=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Bl=function(){};Yg=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,vi(en.current);var s=null;switch(n){case"input":r=cl(t,r),i=cl(t,i),s=[];break;case"select":r=ge({},r,{value:void 0}),i=ge({},i,{value:void 0}),s=[];break;case"textarea":r=dl(t,r),i=dl(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Xo)}hl(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ps.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(ps.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ce("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Xg=function(t,e,n,i){n!==i&&(e.flags|=4)};function Vr(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Be(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function sS(t,e,n){var i=e.pendingProps;switch(od(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Be(e),null;case 1:return nt(e.type)&&Zo(),Be(e),null;case 3:return i=e.stateNode,br(),ue(tt),ue($e),md(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(so(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dt!==null&&(Gl(Dt),Dt=null))),Bl(t,e),Be(e),null;case 5:pd(e);var r=vi(Ps.current);if(n=e.type,t!==null&&e.stateNode!=null)Yg(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(A(166));return Be(e),null}if(t=vi(en.current),so(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Jt]=e,i[ws]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",i),ce("close",i);break;case"iframe":case"object":case"embed":ce("load",i);break;case"video":case"audio":for(r=0;r<Zr.length;r++)ce(Zr[r],i);break;case"source":ce("error",i);break;case"img":case"image":case"link":ce("error",i),ce("load",i);break;case"details":ce("toggle",i);break;case"input":Pf(i,s),ce("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ce("invalid",i);break;case"textarea":_f(i,s),ce("invalid",i)}hl(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&ro(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ro(i.textContent,a,t),r=["children",""+a]):ps.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",i)}switch(n){case"input":Js(i),Rf(i,s,!0);break;case"textarea":Js(i),xf(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Xo)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Pm(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Jt]=e,t[ws]=i,Jg(t,e,!1,!1),e.stateNode=t;e:{switch(o=pl(n,i),n){case"dialog":ce("cancel",t),ce("close",t),r=i;break;case"iframe":case"object":case"embed":ce("load",t),r=i;break;case"video":case"audio":for(r=0;r<Zr.length;r++)ce(Zr[r],t);r=i;break;case"source":ce("error",t),r=i;break;case"img":case"image":case"link":ce("error",t),ce("load",t),r=i;break;case"details":ce("toggle",t),r=i;break;case"input":Pf(t,i),r=cl(t,i),ce("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ge({},i,{value:void 0}),ce("invalid",t);break;case"textarea":_f(t,i),r=dl(t,i),ce("invalid",t);break;default:r=i}hl(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?xm(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Rm(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ms(t,c):typeof c=="number"&&ms(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ps.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ce("scroll",t):c!=null&&Wu(t,s,c,o))}switch(n){case"input":Js(t),Rf(t,i,!1);break;case"textarea":Js(t),xf(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ii(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ir(t,!!i.multiple,s,!1):i.defaultValue!=null&&ir(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Xo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Be(e),null;case 6:if(t&&e.stateNode!=null)Xg(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(A(166));if(n=vi(Ps.current),vi(en.current),so(e)){if(i=e.stateNode,n=e.memoizedProps,i[Jt]=e,(s=i.nodeValue!==n)&&(t=ft,t!==null))switch(t.tag){case 3:ro(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ro(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Jt]=e,e.stateNode=i}return Be(e),null;case 13:if(ue(pe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&ut!==null&&e.mode&1&&!(e.flags&128))gg(),yr(),e.flags|=98560,s=!1;else if(s=so(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(A(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(A(317));s[Jt]=e}else yr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Be(e),s=!1}else Dt!==null&&(Gl(Dt),Dt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Re===0&&(Re=3):Rd())),e.updateQueue!==null&&(e.flags|=4),Be(e),null);case 4:return br(),Bl(t,e),t===null&&Cs(e.stateNode.containerInfo),Be(e),null;case 10:return ud(e.type._context),Be(e),null;case 17:return nt(e.type)&&Zo(),Be(e),null;case 19:if(ue(pe),s=e.memoizedState,s===null)return Be(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Vr(s,!1);else{if(Re!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=oa(t),o!==null){for(e.flags|=128,Vr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return oe(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&Se()>Cr&&(e.flags|=128,i=!0,Vr(s,!1),e.lanes=4194304)}else{if(!i)if(t=oa(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Vr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return Be(e),null}else 2*Se()-s.renderingStartTime>Cr&&n!==1073741824&&(e.flags|=128,i=!0,Vr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Se(),e.sibling=null,n=pe.current,oe(pe,i?n&1|2:n&1),e):(Be(e),null);case 22:case 23:return Pd(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ct&1073741824&&(Be(e),e.subtreeFlags&6&&(e.flags|=8192)):Be(e),null;case 24:return null;case 25:return null}throw Error(A(156,e.tag))}function oS(t,e){switch(od(e),e.tag){case 1:return nt(e.type)&&Zo(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return br(),ue(tt),ue($e),md(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return pd(e),null;case 13:if(ue(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(A(340));yr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(pe),null;case 4:return br(),null;case 10:return ud(e.type._context),null;case 22:case 23:return Pd(),null;case 24:return null;default:return null}}var co=!1,Ve=!1,aS=typeof WeakSet=="function"?WeakSet:Set,B=null;function Zi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ye(t,e,i)}else n.current=null}function Vl(t,e,n){try{n()}catch(i){ye(t,e,i)}}var yh=!1;function cS(t,e){if(wl=Qo,t=ig(),rd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,f=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===t)break t;if(f===n&&++l===r&&(a=o),f===s&&++u===i&&(c=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(El={focusedElem:t,selectionRange:n},Qo=!1,B=e;B!==null;)if(e=B,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,B=t;else for(;B!==null;){e=B;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var m=y.memoizedProps,T=y.memoizedState,h=e.stateNode,v=h.getSnapshotBeforeUpdate(e.elementType===e.type?m:It(e.type,m),T);h.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(A(163))}}catch(b){ye(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}return y=yh,yh=!1,y}function cs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Vl(e,n,s)}r=r.next}while(r!==i)}}function Ba(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function zl(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Zg(t){var e=t.alternate;e!==null&&(t.alternate=null,Zg(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Jt],delete e[ws],delete e[_l],delete e[qb],delete e[Wb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ev(t){return t.tag===5||t.tag===3||t.tag===4}function kh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ev(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $l(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Xo));else if(i!==4&&(t=t.child,t!==null))for($l(t,e,n),t=t.sibling;t!==null;)$l(t,e,n),t=t.sibling}function ql(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(ql(t,e,n),t=t.sibling;t!==null;)ql(t,e,n),t=t.sibling}var Ne=null,Ot=!1;function Nn(t,e,n){for(n=n.child;n!==null;)tv(t,e,n),n=n.sibling}function tv(t,e,n){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(Ma,n)}catch{}switch(n.tag){case 5:Ve||Zi(n,e);case 6:var i=Ne,r=Ot;Ne=null,Nn(t,e,n),Ne=i,Ot=r,Ne!==null&&(Ot?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(Ot?(t=Ne,n=n.stateNode,t.nodeType===8?Tc(t.parentNode,n):t.nodeType===1&&Tc(t,n),ks(t)):Tc(Ne,n.stateNode));break;case 4:i=Ne,r=Ot,Ne=n.stateNode.containerInfo,Ot=!0,Nn(t,e,n),Ne=i,Ot=r;break;case 0:case 11:case 14:case 15:if(!Ve&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Vl(n,e,o),r=r.next}while(r!==i)}Nn(t,e,n);break;case 1:if(!Ve&&(Zi(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ye(n,e,a)}Nn(t,e,n);break;case 21:Nn(t,e,n);break;case 22:n.mode&1?(Ve=(i=Ve)||n.memoizedState!==null,Nn(t,e,n),Ve=i):Nn(t,e,n);break;default:Nn(t,e,n)}}function bh(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new aS),e.forEach(function(i){var r=vS.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Rt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ne=a.stateNode,Ot=!1;break e;case 3:Ne=a.stateNode.containerInfo,Ot=!0;break e;case 4:Ne=a.stateNode.containerInfo,Ot=!0;break e}a=a.return}if(Ne===null)throw Error(A(160));tv(s,o,r),Ne=null,Ot=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){ye(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)nv(e,t),e=e.sibling}function nv(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rt(e,t),Ht(t),i&4){try{cs(3,t,t.return),Ba(3,t)}catch(m){ye(t,t.return,m)}try{cs(5,t,t.return)}catch(m){ye(t,t.return,m)}}break;case 1:Rt(e,t),Ht(t),i&512&&n!==null&&Zi(n,n.return);break;case 5:if(Rt(e,t),Ht(t),i&512&&n!==null&&Zi(n,n.return),t.flags&32){var r=t.stateNode;try{ms(r,"")}catch(m){ye(t,t.return,m)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&wm(r,s),pl(a,o);var l=pl(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?xm(r,d):u==="dangerouslySetInnerHTML"?Rm(r,d):u==="children"?ms(r,d):Wu(r,u,d,l)}switch(a){case"input":ll(r,s);break;case"textarea":Em(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?ir(r,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?ir(r,!!s.multiple,s.defaultValue,!0):ir(r,!!s.multiple,s.multiple?[]:"",!1))}r[ws]=s}catch(m){ye(t,t.return,m)}}break;case 6:if(Rt(e,t),Ht(t),i&4){if(t.stateNode===null)throw Error(A(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(m){ye(t,t.return,m)}}break;case 3:if(Rt(e,t),Ht(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{ks(e.containerInfo)}catch(m){ye(t,t.return,m)}break;case 4:Rt(e,t),Ht(t);break;case 13:Rt(e,t),Ht(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(wd=Se())),i&4&&bh(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ve=(l=Ve)||u,Rt(e,t),Ve=l):Rt(e,t),Ht(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(B=t,u=t.child;u!==null;){for(d=B=u;B!==null;){switch(f=B,p=f.child,f.tag){case 0:case 11:case 14:case 15:cs(4,f,f.return);break;case 1:Zi(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){i=f,n=f.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(m){ye(i,n,m)}}break;case 5:Zi(f,f.return);break;case 22:if(f.memoizedState!==null){Ch(d);continue}}p!==null?(p.return=f,B=p):Ch(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=_m("display",o))}catch(m){ye(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){ye(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Rt(e,t),Ht(t),i&4&&bh(t);break;case 21:break;default:Rt(e,t),Ht(t)}}function Ht(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ev(n)){var i=n;break e}n=n.return}throw Error(A(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(ms(r,""),i.flags&=-33);var s=kh(t);ql(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=kh(t);$l(t,a,o);break;default:throw Error(A(161))}}catch(c){ye(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function lS(t,e,n){B=t,iv(t)}function iv(t,e,n){for(var i=(t.mode&1)!==0;B!==null;){var r=B,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||co;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ve;a=co;var l=Ve;if(co=o,(Ve=c)&&!l)for(B=r;B!==null;)o=B,c=o.child,o.tag===22&&o.memoizedState!==null?Th(r):c!==null?(c.return=o,B=c):Th(r);for(;s!==null;)B=s,iv(s),s=s.sibling;B=r,co=a,Ve=l}Sh(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,B=s):Sh(t)}}function Sh(t){for(;B!==null;){var e=B;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ve||Ba(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ve)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:It(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&sh(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}sh(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ks(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(A(163))}Ve||e.flags&512&&zl(e)}catch(f){ye(e,e.return,f)}}if(e===t){B=null;break}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}}function Ch(t){for(;B!==null;){var e=B;if(e===t){B=null;break}var n=e.sibling;if(n!==null){n.return=e.return,B=n;break}B=e.return}}function Th(t){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ba(4,e)}catch(c){ye(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){ye(e,r,c)}}var s=e.return;try{zl(e)}catch(c){ye(e,s,c)}break;case 5:var o=e.return;try{zl(e)}catch(c){ye(e,o,c)}}}catch(c){ye(e,e.return,c)}if(e===t){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var uS=Math.ceil,la=_n.ReactCurrentDispatcher,Cd=_n.ReactCurrentOwner,St=_n.ReactCurrentBatchConfig,J=0,Oe=null,we=null,Le=0,ct=0,er=ci(0),Re=0,Is=null,Pi=0,Va=0,Td=0,ls=null,Je=null,wd=0,Cr=1/0,dn=null,ua=!1,Wl=null,Yn=null,lo=!1,qn=null,da=0,us=0,Hl=null,Po=-1,Ro=0;function Ke(){return J&6?Se():Po!==-1?Po:Po=Se()}function Xn(t){return t.mode&1?J&2&&Le!==0?Le&-Le:Kb.transition!==null?(Ro===0&&(Ro=Vm()),Ro):(t=ee,t!==0||(t=window.event,t=t===void 0?16:Gm(t.type)),t):1}function Bt(t,e,n,i){if(50<us)throw us=0,Hl=null,Error(A(185));Bs(t,n,i),(!(J&2)||t!==Oe)&&(t===Oe&&(!(J&2)&&(Va|=n),Re===4&&Vn(t,Le)),it(t,i),n===1&&J===0&&!(e.mode&1)&&(Cr=Se()+500,Ua&&li()))}function it(t,e){var n=t.callbackNode;Kk(t,e);var i=Go(t,t===Oe?Le:0);if(i===0)n!==null&&Mf(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Mf(n),e===1)t.tag===0?Hb(wh.bind(null,t)):hg(wh.bind(null,t)),zb(function(){!(J&6)&&li()}),n=null;else{switch(zm(i)){case 1:n=Ju;break;case 4:n=jm;break;case 16:n=Ko;break;case 536870912:n=Bm;break;default:n=Ko}n=dv(n,rv.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function rv(t,e){if(Po=-1,Ro=0,J&6)throw Error(A(327));var n=t.callbackNode;if(cr()&&t.callbackNode!==n)return null;var i=Go(t,t===Oe?Le:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=fa(t,i);else{e=i;var r=J;J|=2;var s=ov();(Oe!==t||Le!==e)&&(dn=null,Cr=Se()+500,yi(t,e));do try{hS();break}catch(a){sv(t,a)}while(!0);ld(),la.current=s,J=r,we!==null?e=0:(Oe=null,Le=0,e=Re)}if(e!==0){if(e===2&&(r=kl(t),r!==0&&(i=r,e=Kl(t,r))),e===1)throw n=Is,yi(t,0),Vn(t,i),it(t,Se()),n;if(e===6)Vn(t,i);else{if(r=t.current.alternate,!(i&30)&&!dS(r)&&(e=fa(t,i),e===2&&(s=kl(t),s!==0&&(i=s,e=Kl(t,s))),e===1))throw n=Is,yi(t,0),Vn(t,i),it(t,Se()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(A(345));case 2:hi(t,Je,dn);break;case 3:if(Vn(t,i),(i&130023424)===i&&(e=wd+500-Se(),10<e)){if(Go(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ke(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Rl(hi.bind(null,t,Je,dn),e);break}hi(t,Je,dn);break;case 4:if(Vn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-jt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Se()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*uS(i/1960))-i,10<i){t.timeoutHandle=Rl(hi.bind(null,t,Je,dn),i);break}hi(t,Je,dn);break;case 5:hi(t,Je,dn);break;default:throw Error(A(329))}}}return it(t,Se()),t.callbackNode===n?rv.bind(null,t):null}function Kl(t,e){var n=ls;return t.current.memoizedState.isDehydrated&&(yi(t,e).flags|=256),t=fa(t,e),t!==2&&(e=Je,Je=n,e!==null&&Gl(e)),t}function Gl(t){Je===null?Je=t:Je.push.apply(Je,t)}function dS(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Vt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vn(t,e){for(e&=~Td,e&=~Va,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-jt(e),i=1<<n;t[n]=-1,e&=~i}}function wh(t){if(J&6)throw Error(A(327));cr();var e=Go(t,0);if(!(e&1))return it(t,Se()),null;var n=fa(t,e);if(t.tag!==0&&n===2){var i=kl(t);i!==0&&(e=i,n=Kl(t,i))}if(n===1)throw n=Is,yi(t,0),Vn(t,e),it(t,Se()),n;if(n===6)throw Error(A(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hi(t,Je,dn),it(t,Se()),null}function Ed(t,e){var n=J;J|=1;try{return t(e)}finally{J=n,J===0&&(Cr=Se()+500,Ua&&li())}}function Ri(t){qn!==null&&qn.tag===0&&!(J&6)&&cr();var e=J;J|=1;var n=St.transition,i=ee;try{if(St.transition=null,ee=1,t)return t()}finally{ee=i,St.transition=n,J=e,!(J&6)&&li()}}function Pd(){ct=er.current,ue(er)}function yi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Vb(n)),we!==null)for(n=we.return;n!==null;){var i=n;switch(od(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Zo();break;case 3:br(),ue(tt),ue($e),md();break;case 5:pd(i);break;case 4:br();break;case 13:ue(pe);break;case 19:ue(pe);break;case 10:ud(i.type._context);break;case 22:case 23:Pd()}n=n.return}if(Oe=t,we=t=Zn(t.current,null),Le=ct=e,Re=0,Is=null,Td=Va=Pi=0,Je=ls=null,gi!==null){for(e=0;e<gi.length;e++)if(n=gi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}gi=null}return t}function sv(t,e){do{var n=we;try{if(ld(),To.current=ca,aa){for(var i=me.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}aa=!1}if(Ei=0,_e=Pe=me=null,as=!1,Rs=0,Cd.current=null,n===null||n.return===null){Re=1,Is=e,we=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=Le,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=dh(o);if(p!==null){p.flags&=-257,fh(p,o,a,s,e),p.mode&1&&uh(s,l,e),e=p,c=l;var y=e.updateQueue;if(y===null){var m=new Set;m.add(c),e.updateQueue=m}else y.add(c);break e}else{if(!(e&1)){uh(s,l,e),Rd();break e}c=Error(A(426))}}else if(fe&&a.mode&1){var T=dh(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),fh(T,o,a,s,e),ad(Sr(c,a));break e}}s=c=Sr(c,a),Re!==4&&(Re=2),ls===null?ls=[s]:ls.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var h=zg(s,c,e);rh(s,h);break e;case 1:a=c;var v=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Yn===null||!Yn.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var b=$g(s,a,e);rh(s,b);break e}}s=s.return}while(s!==null)}cv(n)}catch(S){e=S,we===n&&n!==null&&(we=n=n.return);continue}break}while(!0)}function ov(){var t=la.current;return la.current=ca,t===null?ca:t}function Rd(){(Re===0||Re===3||Re===2)&&(Re=4),Oe===null||!(Pi&268435455)&&!(Va&268435455)||Vn(Oe,Le)}function fa(t,e){var n=J;J|=2;var i=ov();(Oe!==t||Le!==e)&&(dn=null,yi(t,e));do try{fS();break}catch(r){sv(t,r)}while(!0);if(ld(),J=n,la.current=i,we!==null)throw Error(A(261));return Oe=null,Le=0,Re}function fS(){for(;we!==null;)av(we)}function hS(){for(;we!==null&&!Fk();)av(we)}function av(t){var e=uv(t.alternate,t,ct);t.memoizedProps=t.pendingProps,e===null?cv(t):we=e,Cd.current=null}function cv(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=oS(n,e),n!==null){n.flags&=32767,we=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Re=6,we=null;return}}else if(n=sS(n,e,ct),n!==null){we=n;return}if(e=e.sibling,e!==null){we=e;return}we=e=t}while(e!==null);Re===0&&(Re=5)}function hi(t,e,n){var i=ee,r=St.transition;try{St.transition=null,ee=1,pS(t,e,n,i)}finally{St.transition=r,ee=i}return null}function pS(t,e,n,i){do cr();while(qn!==null);if(J&6)throw Error(A(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(A(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Gk(t,s),t===Oe&&(we=Oe=null,Le=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||lo||(lo=!0,dv(Ko,function(){return cr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=St.transition,St.transition=null;var o=ee;ee=1;var a=J;J|=4,Cd.current=null,cS(t,n),nv(n,t),Nb(El),Qo=!!wl,El=wl=null,t.current=n,lS(n),jk(),J=a,ee=o,St.transition=s}else t.current=n;if(lo&&(lo=!1,qn=t,da=r),s=t.pendingLanes,s===0&&(Yn=null),zk(n.stateNode),it(t,Se()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ua)throw ua=!1,t=Wl,Wl=null,t;return da&1&&t.tag!==0&&cr(),s=t.pendingLanes,s&1?t===Hl?us++:(us=0,Hl=t):us=0,li(),null}function cr(){if(qn!==null){var t=zm(da),e=St.transition,n=ee;try{if(St.transition=null,ee=16>t?16:t,qn===null)var i=!1;else{if(t=qn,qn=null,da=0,J&6)throw Error(A(331));var r=J;for(J|=4,B=t.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(B=l;B!==null;){var u=B;switch(u.tag){case 0:case 11:case 15:cs(8,u,s)}var d=u.child;if(d!==null)d.return=u,B=d;else for(;B!==null;){u=B;var f=u.sibling,p=u.return;if(Zg(u),u===l){B=null;break}if(f!==null){f.return=p,B=f;break}B=p}}}var y=s.alternate;if(y!==null){var m=y.child;if(m!==null){y.child=null;do{var T=m.sibling;m.sibling=null,m=T}while(m!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:cs(9,s,s.return)}var h=s.sibling;if(h!==null){h.return=s.return,B=h;break e}B=s.return}}var v=t.current;for(B=v;B!==null;){o=B;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,B=k;else e:for(o=v;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ba(9,a)}}catch(S){ye(a,a.return,S)}if(a===o){B=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,B=b;break e}B=a.return}}if(J=r,li(),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(Ma,t)}catch{}i=!0}return i}finally{ee=n,St.transition=e}}return!1}function Eh(t,e,n){e=Sr(n,e),e=zg(t,e,1),t=Jn(t,e,1),e=Ke(),t!==null&&(Bs(t,1,e),it(t,e))}function ye(t,e,n){if(t.tag===3)Eh(t,t,n);else for(;e!==null;){if(e.tag===3){Eh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Yn===null||!Yn.has(i))){t=Sr(n,t),t=$g(e,t,1),e=Jn(e,t,1),t=Ke(),e!==null&&(Bs(e,1,t),it(e,t));break}}e=e.return}}function mS(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ke(),t.pingedLanes|=t.suspendedLanes&n,Oe===t&&(Le&n)===n&&(Re===4||Re===3&&(Le&130023424)===Le&&500>Se()-wd?yi(t,0):Td|=n),it(t,e)}function lv(t,e){e===0&&(t.mode&1?(e=Zs,Zs<<=1,!(Zs&130023424)&&(Zs=4194304)):e=1);var n=Ke();t=Tn(t,e),t!==null&&(Bs(t,e,n),it(t,n))}function gS(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),lv(t,n)}function vS(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(A(314))}i!==null&&i.delete(e),lv(t,n)}var uv;uv=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||tt.current)Ze=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ze=!1,rS(t,e,n);Ze=!!(t.flags&131072)}else Ze=!1,fe&&e.flags&1048576&&pg(e,na,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Eo(t,e),t=e.pendingProps;var r=vr(e,$e.current);ar(e,n),r=vd(null,e,i,t,r,n);var s=yd();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,nt(i)?(s=!0,ea(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,fd(e),r.updater=ja,e.stateNode=r,r._reactInternals=e,Nl(e,i,t,n),e=Ul(null,e,i,!0,s,n)):(e.tag=0,fe&&s&&sd(e),He(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Eo(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=kS(i),t=It(i,t),r){case 0:e=Ll(null,e,i,t,n);break e;case 1:e=mh(null,e,i,t,n);break e;case 11:e=hh(null,e,i,t,n);break e;case 14:e=ph(null,e,i,It(i.type,t),n);break e}throw Error(A(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),Ll(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),mh(t,e,i,r,n);case 3:e:{if(Kg(e),t===null)throw Error(A(387));i=e.pendingProps,s=e.memoizedState,r=s.element,bg(t,e),sa(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Sr(Error(A(423)),e),e=gh(t,e,i,n,r);break e}else if(i!==r){r=Sr(Error(A(424)),e),e=gh(t,e,i,n,r);break e}else for(ut=Qn(e.stateNode.containerInfo.firstChild),ft=e,fe=!0,Dt=null,n=yg(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yr(),i===r){e=wn(t,e,n);break e}He(t,e,i,n)}e=e.child}return e;case 5:return Sg(e),t===null&&Ol(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Pl(i,r)?o=null:s!==null&&Pl(i,s)&&(e.flags|=32),Hg(t,e),He(t,e,o,n),e.child;case 6:return t===null&&Ol(e),null;case 13:return Gg(t,e,n);case 4:return hd(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=kr(e,null,i,n):He(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),hh(t,e,i,r,n);case 7:return He(t,e,e.pendingProps,n),e.child;case 8:return He(t,e,e.pendingProps.children,n),e.child;case 12:return He(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,oe(ia,i._currentValue),i._currentValue=o,s!==null)if(Vt(s.value,o)){if(s.children===r.children&&!tt.current){e=wn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=bn(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Ml(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(A(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ml(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}He(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,ar(e,n),r=Ct(r),i=i(r),e.flags|=1,He(t,e,i,n),e.child;case 14:return i=e.type,r=It(i,e.pendingProps),r=It(i.type,r),ph(t,e,i,r,n);case 15:return qg(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),Eo(t,e),e.tag=1,nt(i)?(t=!0,ea(e)):t=!1,ar(e,n),Vg(e,i,r),Nl(e,i,r,n),Ul(null,e,i,!0,t,n);case 19:return Qg(t,e,n);case 22:return Wg(t,e,n)}throw Error(A(156,e.tag))};function dv(t,e){return Fm(t,e)}function yS(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bt(t,e,n,i){return new yS(t,e,n,i)}function _d(t){return t=t.prototype,!(!t||!t.isReactComponent)}function kS(t){if(typeof t=="function")return _d(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ku)return 11;if(t===Gu)return 14}return 2}function Zn(t,e){var n=t.alternate;return n===null?(n=bt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function _o(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")_d(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case qi:return ki(n.children,r,s,e);case Hu:o=8,r|=8;break;case rl:return t=bt(12,n,e,r|2),t.elementType=rl,t.lanes=s,t;case sl:return t=bt(13,n,e,r),t.elementType=sl,t.lanes=s,t;case ol:return t=bt(19,n,e,r),t.elementType=ol,t.lanes=s,t;case Sm:return za(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case km:o=10;break e;case bm:o=9;break e;case Ku:o=11;break e;case Gu:o=14;break e;case Fn:o=16,i=null;break e}throw Error(A(130,t==null?t:typeof t,""))}return e=bt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function ki(t,e,n,i){return t=bt(7,t,i,e),t.lanes=n,t}function za(t,e,n,i){return t=bt(22,t,i,e),t.elementType=Sm,t.lanes=n,t.stateNode={isHidden:!1},t}function Oc(t,e,n){return t=bt(6,t,null,e),t.lanes=n,t}function Mc(t,e,n){return e=bt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function bS(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fc(0),this.expirationTimes=fc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fc(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function xd(t,e,n,i,r,s,o,a,c){return t=new bS(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=bt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},fd(s),t}function SS(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$i,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function fv(t){if(!t)return ri;t=t._reactInternals;e:{if(Ni(t)!==t||t.tag!==1)throw Error(A(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(nt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(A(171))}if(t.tag===1){var n=t.type;if(nt(n))return fg(t,n,e)}return e}function hv(t,e,n,i,r,s,o,a,c){return t=xd(n,i,!0,t,r,s,o,a,c),t.context=fv(null),n=t.current,i=Ke(),r=Xn(n),s=bn(i,r),s.callback=e??null,Jn(n,s,r),t.current.lanes=r,Bs(t,r,i),it(t,i),t}function $a(t,e,n,i){var r=e.current,s=Ke(),o=Xn(r);return n=fv(n),e.context===null?e.context=n:e.pendingContext=n,e=bn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Jn(r,e,o),t!==null&&(Bt(t,r,o,s),Co(t,r,o)),o}function ha(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ph(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Id(t,e){Ph(t,e),(t=t.alternate)&&Ph(t,e)}function CS(){return null}var pv=typeof reportError=="function"?reportError:function(t){console.error(t)};function Od(t){this._internalRoot=t}qa.prototype.render=Od.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(A(409));$a(t,e,null,null)};qa.prototype.unmount=Od.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ri(function(){$a(null,t,null,null)}),e[Cn]=null}};function qa(t){this._internalRoot=t}qa.prototype.unstable_scheduleHydration=function(t){if(t){var e=Wm();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Bn.length&&e!==0&&e<Bn[n].priority;n++);Bn.splice(n,0,t),n===0&&Km(t)}};function Md(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Wa(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Rh(){}function TS(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=ha(o);s.call(l)}}var o=hv(e,i,t,0,null,!1,!1,"",Rh);return t._reactRootContainer=o,t[Cn]=o.current,Cs(t.nodeType===8?t.parentNode:t),Ri(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=ha(c);a.call(l)}}var c=xd(t,0,!1,null,null,!1,!1,"",Rh);return t._reactRootContainer=c,t[Cn]=c.current,Cs(t.nodeType===8?t.parentNode:t),Ri(function(){$a(e,c,n,i)}),c}function Ha(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=ha(o);a.call(c)}}$a(e,o,t,r)}else o=TS(n,e,t,r,i);return ha(o)}$m=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Xr(e.pendingLanes);n!==0&&(Yu(e,n|1),it(e,Se()),!(J&6)&&(Cr=Se()+500,li()))}break;case 13:Ri(function(){var i=Tn(t,1);if(i!==null){var r=Ke();Bt(i,t,1,r)}}),Id(t,1)}};Xu=function(t){if(t.tag===13){var e=Tn(t,134217728);if(e!==null){var n=Ke();Bt(e,t,134217728,n)}Id(t,134217728)}};qm=function(t){if(t.tag===13){var e=Xn(t),n=Tn(t,e);if(n!==null){var i=Ke();Bt(n,t,e,i)}Id(t,e)}};Wm=function(){return ee};Hm=function(t,e){var n=ee;try{return ee=t,e()}finally{ee=n}};gl=function(t,e,n){switch(e){case"input":if(ll(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=La(i);if(!r)throw Error(A(90));Tm(i),ll(i,r)}}}break;case"textarea":Em(t,n);break;case"select":e=n.value,e!=null&&ir(t,!!n.multiple,e,!1)}};Mm=Ed;Dm=Ri;var wS={usingClientEntryPoint:!1,Events:[zs,Gi,La,Im,Om,Ed]},zr={findFiberByHostInstance:mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ES={bundleType:zr.bundleType,version:zr.version,rendererPackageName:zr.rendererPackageName,rendererConfig:zr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_n.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Lm(t),t===null?null:t.stateNode},findFiberByHostInstance:zr.findFiberByHostInstance||CS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uo.isDisabled&&uo.supportsFiber)try{Ma=uo.inject(ES),Zt=uo}catch{}}gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wS;gt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Md(e))throw Error(A(200));return SS(t,e,null,n)};gt.createRoot=function(t,e){if(!Md(t))throw Error(A(299));var n=!1,i="",r=pv;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=xd(t,1,!1,null,null,n,!1,i,r),t[Cn]=e.current,Cs(t.nodeType===8?t.parentNode:t),new Od(e)};gt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(A(188)):(t=Object.keys(t).join(","),Error(A(268,t)));return t=Lm(e),t=t===null?null:t.stateNode,t};gt.flushSync=function(t){return Ri(t)};gt.hydrate=function(t,e,n){if(!Wa(e))throw Error(A(200));return Ha(null,t,e,!0,n)};gt.hydrateRoot=function(t,e,n){if(!Md(t))throw Error(A(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=pv;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=hv(e,null,t,1,n??null,r,!1,s,o),t[Cn]=e.current,Cs(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new qa(e)};gt.render=function(t,e,n){if(!Wa(e))throw Error(A(200));return Ha(null,t,e,!1,n)};gt.unmountComponentAtNode=function(t){if(!Wa(t))throw Error(A(40));return t._reactRootContainer?(Ri(function(){Ha(null,null,t,!1,function(){t._reactRootContainer=null,t[Cn]=null})}),!0):!1};gt.unstable_batchedUpdates=Ed;gt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Wa(n))throw Error(A(200));if(t==null||t._reactInternals===void 0)throw Error(A(38));return Ha(t,e,n,!1,i)};gt.version="18.3.1-next-f1338f8080-20240426";function mv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mv)}catch(t){console.error(t)}}mv(),mm.exports=gt;var PS=mm.exports,gv,_h=PS;gv=_h.createRoot,_h.hydrateRoot;var xh={};function RS(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var _S=Object.defineProperty,xS=(t,e,n)=>e in t?_S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ih=(t,e,n)=>xS(t,typeof e!="symbol"?e+"":e,n);class rt{constructor(){Ih(this,"_locking"),Ih(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function ke(t,e){if(!t)throw new Error(e)}const IS=34028234663852886e22,OS=-34028234663852886e22,MS=4294967295,DS=2147483647,NS=-2147483648;function xo(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>DS||t<NS)throw new Error("invalid int 32: "+t)}function Ql(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>MS||t<0)throw new Error("invalid uint 32: "+t)}function vv(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>IS||t<OS))throw new Error("invalid float 32: "+t)}const yv=Symbol("@bufbuild/protobuf/enum-type");function AS(t){const e=t[yv];return ke(e,"missing enum type on enum object"),e}function kv(t,e,n,i){t[yv]=bv(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function bv(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Sv(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function LS(t,e,n){const i={};for(const r of e){const s=Sv(r);i[s.localName]=s.no,i[s.no]=s.localName}return kv(i,t,e),i}function Sv(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Dd{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function US(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Dd),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function FS(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Dc(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Io=4294967296;function Oh(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Io&&(r=r+(i/Io|0),i=i%Io)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Tv(i,r):Nd(i,r)}function jS(t,e){let n=Nd(t,e);const i=n.hi&2147483648;i&&(n=Tv(n.lo,n.hi));const r=Cv(n.lo,n.hi);return i?"-"+r:r}function Cv(t,e){if({lo:t,hi:e}=BS(t,e),e<=2097151)return String(Io*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Mh(o)+Mh(s)}function BS(t,e){return{lo:t>>>0,hi:e>>>0}}function Nd(t,e){return{lo:t|0,hi:e|0}}function Tv(t,e){return e=~e,t?t=~t+1:e+=1,Nd(t,e)}const Mh=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Dh(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function VS(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function zS(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof xh!="object"||xh.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>ke(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>ke(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Oh(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Oh(r)},dec(r,s){return jS(r,s)},uDec(r,s){return Cv(r,s)}}}const he=zS();var D;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(D||(D={}));var si;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(si||(si={}));function An(t,e,n){if(e===n)return!0;if(t==D.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return e==n}return!1}function Tr(t,e){switch(t){case D.BOOL:return!1;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return e==0?he.zero:"0";case D.DOUBLE:case D.FLOAT:return 0;case D.BYTES:return new Uint8Array(0);case D.STRING:return"";default:return 0}}function wv(t,e){switch(t){case D.BOOL:return e===!1;case D.STRING:return e==="";case D.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Ce;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Ce||(Ce={}));class $S{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ql(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return xo(e),Dh(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){vv(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Ql(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){xo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return xo(e),e=(e<<1^e>>31)>>>0,Dh(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=he.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=he.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=he.enc(e);return Dc(n.lo,n.hi,this.buf),this}sint64(e){let n=he.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Dc(r,s,this.buf),this}uint64(e){let n=he.uEnc(e);return Dc(n.lo,n.hi,this.buf),this}}class qS{constructor(e,n){this.varint64=FS,this.uint32=VS,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Ce.Varint:for(;this.buf[this.pos++]&128;);break;case Ce.Bit64:this.pos+=4;case Ce.Bit32:this.pos+=4;break;case Ce.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Ce.StartGroup:for(;;){const[s,o]=this.tag();if(o===Ce.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return he.dec(...this.varint64())}uint64(){return he.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,he.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return he.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return he.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function WS(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Ev(t){const e=t.field.localName,n=Object.create(null);return n[e]=HS(t),[n,()=>n[e]]}function HS(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Tr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function KS(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let pn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ka=[];for(let t=0;t<pn.length;t++)Ka[pn[t].charCodeAt(0)]=t;Ka[45]=pn.indexOf("+");Ka[95]=pn.indexOf("/");const Pv={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=Ka[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=pn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=pn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=pn[r|i>>6],e+=pn[i&63],n=0;break}return n&&(e+=pn[r],e+="=",n==1&&(e+="=")),e}};function GS(t,e,n){_v(e,t);const i=e.runtime.bin.makeReadOptions(n),r=KS(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Ev(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function QS(t,e,n,i){_v(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(Rv(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function Rv(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function _v(t,e){ke(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function xv(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!wv(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Nh(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Tr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function mn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Dd.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Iv(t,e){return mn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}D.DOUBLE,D.FLOAT,D.INT64,D.UINT64,D.INT32,D.UINT32,D.BOOL,D.STRING,D.BYTES;const Ah={ignoreUnknownFields:!1},Lh={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function JS(t){return t?Object.assign(Object.assign({},Ah),t):Ah}function YS(t){return t?Object.assign(Object.assign({},Lh),t):Lh}const pa=Symbol(),Oo=Symbol();function XS(){return{makeReadOptions:JS,makeWriteOptions:YS,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Qt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}Uh(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,f]=Ev(u);Uh(d,a,u.field,n,u),QS(i,u,f(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!xv(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!eC(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Fh(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&Rv(t,a)){const c=GS(t,a,e),l=Fh(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return ds(t,e,n??si.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||wv(t,e)))return Mo(t,e)},debug:Qt}}function Qt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Uh(t,e,n,i,r){let s=n.localName;if(n.repeated){if(ke(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Nc(n.T,a,i.ignoreUnknownFields,!0);c!==Oo&&o.push(c);break;case"scalar":try{o.push(ds(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=ZS(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Nc(n.V.T,c,i.ignoreUnknownFields,!0);u!==Oo&&(o[l]=u);break;case"scalar":try{o[l]=ds(n.V.T,c,si.BIGINT,!0)}catch(d){let f="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];mn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Nc(n.T,e,i.ignoreUnknownFields,!1);switch(c){case pa:Nh(n,t);break;case Oo:break;default:t[s]=c;break}break;case"scalar":try{const l=ds(n.T,e,n.L,!1);switch(l){case pa:Nh(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Qt(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function ZS(t,e){if(t===D.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return ds(t,e,si.BIGINT,!0).toString()}function ds(t,e,n,i){if(e===null)return i?Tr(t,n):pa;switch(t){case D.DOUBLE:case D.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==D.FLOAT&&vv(r),r;case D.INT32:case D.FIXED32:case D.SFIXED32:case D.SINT32:case D.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==D.UINT32||t==D.FIXED32?Ql(s):xo(s),s;case D.INT64:case D.SFIXED64:case D.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=he.parse(e);return n?o.toString():o;case D.FIXED64:case D.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=he.uParse(e);return n?a.toString():a;case D.BOOL:if(typeof e!="boolean")break;return e;case D.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case D.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Pv.dec(e)}throw new Error}function Nc(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:pa;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Oo;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Qt(e)))}function eC(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Fh(t,e,n){if(t.kind=="map"){ke(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Mo(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Ac(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){ke(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Mo(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Ac(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Mo(t.T,e);case"enum":return Ac(t.T,e,n.enumAsInteger);case"message":return Iv(t.T,e).toJson(n)}}function Ac(t,e,n){var i;if(ke(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Mo(t,e){switch(t){case D.INT32:case D.SFIXED32:case D.SINT32:case D.FIXED32:case D.UINT32:return ke(typeof e=="number"),e;case D.FLOAT:case D.DOUBLE:return ke(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case D.STRING:return ke(typeof e=="string"),e;case D.BOOL:return ke(typeof e=="boolean"),e;case D.UINT64:case D.FIXED64:case D.INT64:case D.SFIXED64:case D.SINT64:return ke(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case D.BYTES:return ke(e instanceof Uint8Array),Pv.enc(e)}}const Bi=Symbol("@bufbuild/protobuf/unknown-fields"),jh={readUnknownFields:!0,readerFactory:t=>new qS(t)},Bh={writeUnknownFields:!0,writerFactory:()=>new $S};function tC(t){return t?Object.assign(Object.assign({},jh),t):jh}function nC(t){return t?Object.assign(Object.assign({},Bh),t):Bh}function iC(){return{makeReadOptions:tC,makeWriteOptions:nC,listUnknownFields(t){var e;return(e=t[Bi])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Bi]},writeUnknownFields(t,e){const i=t[Bi];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Bi])||(r[Bi]=[]),r[Bi].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==Ce.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Vh(t,e,l,c,i)}if(r&&(c!=Ce.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Vh,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!xv(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];zh(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&zh(t,e,n,i)}}}function Vh(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?D.INT32:n.T;let c=ma;if(n.kind=="scalar"&&n.L>0&&(c=sC),s){let f=t[o];if(i==Ce.LengthDelimited&&a!=D.STRING&&a!=D.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)f.push(c(e,a))}else f.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(Do(e,new l,r,n)):mn(t[o])?Do(e,t[o],r,n):(t[o]=Do(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=rC(n,e,r);t[o][u]=d;break}}function Do(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function rC(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=ma(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=ma(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Do(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Tr(t.K,si.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Tr(t.V.T,si.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function sC(t,e){const n=ma(t,e);return typeof n=="bigint"?n.toString():n}function ma(t,e){switch(e){case D.STRING:return t.string();case D.BOOL:return t.bool();case D.DOUBLE:return t.double();case D.FLOAT:return t.float();case D.INT32:return t.int32();case D.INT64:return t.int64();case D.UINT64:return t.uint64();case D.FIXED64:return t.fixed64();case D.BYTES:return t.bytes();case D.FIXED32:return t.fixed32();case D.SFIXED32:return t.sfixed32();case D.SFIXED64:return t.sfixed64();case D.SINT64:return t.sint64();case D.UINT32:return t.uint32();case D.SINT32:return t.sint32()}}function zh(t,e,n,i){ke(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?D.INT32:t.T;if(r)if(ke(Array.isArray(e)),t.packed)aC(n,s,t.no,e);else for(const o of e)fs(n,s,t.no,o);else fs(n,s,t.no,e);break;case"message":if(r){ke(Array.isArray(e));for(const o of e)$h(n,i,t,o)}else $h(n,i,t,e);break;case"map":ke(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))oC(n,i,t,o,a);break}}function oC(t,e,n,i,r){t.tag(n.no,Ce.LengthDelimited),t.fork();let s=i;switch(n.K){case D.INT32:case D.FIXED32:case D.UINT32:case D.SFIXED32:case D.SINT32:s=Number.parseInt(i);break;case D.BOOL:ke(i=="true"||i=="false"),s=i=="true";break}switch(fs(t,n.K,1,s),n.V.kind){case"scalar":fs(t,n.V.T,2,r);break;case"enum":fs(t,D.INT32,2,r);break;case"message":ke(r!==void 0),t.tag(2,Ce.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function $h(t,e,n,i){const r=Iv(n.T,i);n.delimited?t.tag(n.no,Ce.StartGroup).raw(r.toBinary(e)).tag(n.no,Ce.EndGroup):t.tag(n.no,Ce.LengthDelimited).bytes(r.toBinary(e))}function fs(t,e,n,i){ke(i!==void 0);let[r,s]=Ov(e);t.tag(n,r)[s](i)}function aC(t,e,n,i){if(!i.length)return;t.tag(n,Ce.LengthDelimited).fork();let[,r]=Ov(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function Ov(t){let e=Ce.Varint;switch(t){case D.BYTES:case D.STRING:e=Ce.LengthDelimited;break;case D.DOUBLE:case D.FIXED64:case D.SFIXED64:e=Ce.Bit64;break;case D.FIXED32:case D.SFIXED32:case D.FLOAT:e=Ce.Bit32;break}const n=D[t].toLowerCase();return[e,n]}function cC(){return{setEnumType:kv,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!mn(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===D.BYTES&&(l=$r(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===D.BYTES&&(u=i.repeated?u.map($r):$r(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===D.BYTES)for(const[p,y]of Object.entries(o[r]))s[r][p]=$r(y);else Object.assign(s[r],o[r]);break;case"message":const f=i.V.T;for(const p of Object.keys(o[r])){let y=o[r][p];f.fieldWrapper||(y=new f(y)),s[r][p]=y}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(f=>mn(f,d)?f:new d(f));else{const f=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=$r(f):s[r]=f:s[r]=mn(f,d)?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>An(i.T,o,s[a]));case"enum":return r.every((o,a)=>An(D.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!mn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!mn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return An(D.INT32,r,s);case"scalar":return An(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return An(D.INT32,r.value,s.value);case"scalar":return An(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(f=>u.equals(r[f],s[f]));case"enum":return l.every(f=>An(D.INT32,r[f],s[f]));case"scalar":const d=i.V.T;return l.every(f=>An(d,r[f],s[f]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(fo);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=fo(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:fo(s.value)}:{case:void 0}:o=fo(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function fo(t){if(t===void 0)return t;if(mn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function $r(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function lC(t,e,n){return{syntax:t,json:XS(),bin:iC(),util:Object.assign(Object.assign({},cC()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return US(this,i,r,s)},makeEnum:LS,makeEnumType:bv,getEnumType:AS,makeExtension(i,r,s){return WS(this,i,r,s)}}}class uC{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Mv(t,e){const n=Dv(t);return e?n:gC(mC(n))}function dC(t){return Mv(t,!1)}const fC=Dv;function Dv(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const hC=new Set(["constructor","toString","toJSON","valueOf"]),pC=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Nv=t=>"".concat(t,"$"),mC=t=>pC.has(t)?Nv(t):t,gC=t=>hC.has(t)?Nv(t):t;class vC{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=dC(e)}addField(e){ke(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function yC(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=Mv(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:fC(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:si.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=D.BYTES&&u.T!=D.STRING),u.oneof!==void 0){const f=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=f)&&(l=new vC(f)),d.oneof=l,l.addField(d)}c.push(d)}return c}const R=lC("proto3",t=>new uC(t,e=>yC(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Tr(e.T,e.L);break}}});class Ye extends Dd{constructor(e){super(),this.seconds=he.zero,this.nanos=0,R.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(R.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=he.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Ye.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Ye({seconds:he.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Ye().fromBinary(e,n)}static fromJson(e,n){return new Ye().fromJson(e,n)}static fromJsonString(e,n){return new Ye().fromJsonString(e,n)}static equals(e,n){return R.util.equals(Ye,e,n)}}Ye.runtime=R;Ye.typeName="google.protobuf.Timestamp";Ye.fields=R.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const kC=R.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ye},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:bC,repeated:!0},{no:5,name:"events",kind:"message",T:CC,repeated:!0}]),bC=R.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:SC,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),SC=R.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ye},{no:3,name:"value",kind:"scalar",T:2}]),CC=R.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Ye},{no:7,name:"normalized_end_timestamp",kind:"message",T:Ye,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Av=R.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Nt=R.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Te=R.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Ad=R.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),es=R.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Os=R.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Ft=R.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Vi=R.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),TC=R.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),xe=R.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Ga=R.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ga,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Gv}]),ga=R.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),wC=R.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:R.getEnumType(Te),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),_i=R.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(lr)},{no:4,name:"tracks",kind:"message",T:tr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:wC},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:R.getEnumType(Ms)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:R.getEnumType(Ft)},{no:18,name:"kind_details",kind:"enum",T:R.getEnumType(EC),repeated:!0}]),lr=R.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ms=R.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),EC=R.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),lt=R.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),PC=R.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:bi,repeated:!0}]),tr=R.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:R.getEnumType(Nt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:R.getEnumType(Te)},{no:10,name:"layers",kind:"message",T:bi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:PC,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:R.getEnumType(lt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Gv},{no:19,name:"audio_features",kind:"enum",T:R.getEnumType(xe),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(Av)}]),bi=R.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Ad)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Xe=R.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:R.getEnumType(W)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Uv,oneof:"value"},{no:3,name:"speaker",kind:"message",T:RC,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Fv,oneof:"value"},{no:7,name:"transcription",kind:"message",T:_C,oneof:"value"},{no:8,name:"metrics",kind:"message",T:kC,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Jl,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:jv,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Bv,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Vv,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Xl,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Zl,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:eu,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),W=R.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),RC=R.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:Lv,repeated:!0}]),Lv=R.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Uv=R.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Fv=R.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),_C=R.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:xC,repeated:!0}]),xC=R.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Jl=R.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),jv=R.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Bv=R.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Vv=R.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:zv,oneof:"value"}]),zv=R.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),$v=R.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),qv=R.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:R.getEnumType(Wv)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Wv=R.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),IC=R.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:R.getEnumType(Hv)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Hv=R.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Kv=R.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:qh},{no:2,name:"screen",kind:"message",T:qh},{no:3,name:"resume_connection",kind:"enum",T:R.getEnumType(Os)},{no:4,name:"disabled_codecs",kind:"message",T:OC},{no:5,name:"force_relay",kind:"enum",T:R.getEnumType(Os)}]),qh=R.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:R.getEnumType(Os)}]),OC=R.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ga,repeated:!0},{no:2,name:"publish",kind:"message",T:ga,repeated:!0}]),Gv=R.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Yl=R.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Qv=R.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:R.getEnumType(Yl)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Jv=R.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Xl=R.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:R.getEnumType(lt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Qv,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Jv,oneof:"content_header"}],{localName:"DataStream_Header"}),Zl=R.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),eu=R.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),At=R.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),tu=R.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),MC=R.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),DC=R.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:xi,oneof:"message"},{no:2,name:"answer",kind:"message",T:xi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Ld,oneof:"message"},{no:4,name:"add_track",kind:"message",T:iu,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ud,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Qa,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Yv,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ja,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Zv,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:i0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:r0,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Kt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:e0,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:a0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Xv,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:FC,oneof:"message"}]),Wh=R.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:NC,oneof:"message"},{no:2,name:"answer",kind:"message",T:xi,oneof:"message"},{no:3,name:"offer",kind:"message",T:xi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Ld,oneof:"message"},{no:5,name:"update",kind:"message",T:UC,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Fd,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ja,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ud,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:jC,oneof:"message"},{no:11,name:"room_update",kind:"message",T:BC,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:zC,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:qC,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:HC,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:KC,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:LC,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:AC,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:QC,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:XC,oneof:"message"},{no:22,name:"request_response",kind:"message",T:ZC,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:eT,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:GC,oneof:"message"}]),nu=R.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),iu=R.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:R.getEnumType(Nt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:R.getEnumType(Te)},{no:9,name:"layers",kind:"message",T:bi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:nu,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:R.getEnumType(lt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(Av)},{no:17,name:"audio_features",kind:"enum",T:R.getEnumType(xe),repeated:!0}]),Ld=R.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:R.getEnumType(At)},{no:3,name:"final",kind:"scalar",T:8}]),Ud=R.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),NC=R.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Ga},{no:2,name:"participant",kind:"message",T:_i},{no:3,name:"other_participants",kind:"message",T:_i,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:t0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Kv},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:qv},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ga,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),AC=R.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:t0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Kv},{no:3,name:"server_info",kind:"message",T:qv},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Fd=R.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:tr}]),LC=R.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),xi=R.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),UC=R.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:_i,repeated:!0}]),Qa=R.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:$v,repeated:!0}]),Yv=R.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:R.getEnumType(Ad)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Xv=R.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:R.getEnumType(xe),repeated:!0}]),FC=R.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Ja=R.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Ft)},{no:3,name:"action",kind:"enum",T:R.getEnumType(ur)},{no:4,name:"regions",kind:"message",T:JC}]),ur=R.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Zv=R.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:bi,repeated:!0}]),e0=R.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),t0=R.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),jC=R.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:Lv,repeated:!0}]),BC=R.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Ga}]),VC=R.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:R.getEnumType(es)},{no:3,name:"score",kind:"scalar",T:2}]),zC=R.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:VC,repeated:!0}]),$C=R.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(tu)}]),qC=R.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:$C,repeated:!0}]),jd=R.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Ad)},{no:2,name:"enabled",kind:"scalar",T:8}]),WC=R.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:jd,repeated:!0}]),HC=R.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:jd,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:WC,repeated:!0}]),n0=R.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),i0=R.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:n0,repeated:!0}]),KC=R.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),GC=R.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Ga},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:_i},{no:4,name:"other_participants",kind:"message",T:_i,repeated:!0}]),r0=R.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:xi},{no:2,name:"subscription",kind:"message",T:Qa},{no:3,name:"publish_tracks",kind:"message",T:Fd,repeated:!0},{no:4,name:"data_channels",kind:"message",T:o0,repeated:!0},{no:5,name:"offer",kind:"message",T:xi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:s0,repeated:!0}]),s0=R.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),o0=R.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:R.getEnumType(At)}]),Kt=R.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:R.getEnumType(MC),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),a0=R.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),QC=R.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),JC=R.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:YC,repeated:!0}]),YC=R.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),XC=R.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:R.getEnumType(TC)}]),ZC=R.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Bd)},{no:3,name:"message",kind:"scalar",T:9}]),Bd=R.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),eT=R.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function tT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var No={exports:{}},nT=No.exports,Hh;function iT(){return Hh||(Hh=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(nT,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,T){var h=m[T];if(typeof h.bind=="function")return h.bind(m);try{return Function.prototype.bind.call(h,m)}catch{return function(){return Function.prototype.apply.apply(h,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),T=0;T<r.length;T++){var h=r[T];this[h]=T<m?e:this.methodFactory(h,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function f(m,T,h){return l(m)||d.apply(this,arguments)}function p(m,T){var h=this,v,k,b,S="loglevel";typeof m=="string"?S+=":"+m:typeof m=="symbol"&&(S=void 0);function w(N){var j=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!S)){try{window.localStorage[S]=j;return}catch{}try{window.document.cookie=encodeURIComponent(S)+"="+j+";"}catch{}}}function P(){var N;if(!(typeof window===n||!S)){try{N=window.localStorage[S]}catch{}if(typeof N===n)try{var j=window.document.cookie,V=encodeURIComponent(S),Z=j.indexOf(V+"=");Z!==-1&&(N=/^([^;]+)/.exec(j.slice(Z+V.length+1))[1])}catch{}return h.levels[N]===void 0&&(N=void 0),N}}function x(){if(!(typeof window===n||!S)){try{window.localStorage.removeItem(S)}catch{}try{window.document.cookie=encodeURIComponent(S)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function O(N){var j=N;if(typeof j=="string"&&h.levels[j.toUpperCase()]!==void 0&&(j=h.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=h.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+N)}h.name=m,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=T||f,h.getLevel=function(){return b??k??v},h.setLevel=function(N,j){return b=O(N),j!==!1&&w(b),u.call(h)},h.setDefaultLevel=function(N){k=O(N),P()||h.setLevel(N,!1)},h.resetLevel=function(){b=null,x(),u.call(h)},h.enableAll=function(N){h.setLevel(h.levels.TRACE,N)},h.disableAll=function(N){h.setLevel(h.levels.SILENT,N)},h.rebuild=function(){if(o!==h&&(v=O(o.getLevel())),u.call(h),o===h)for(var N in s)s[N].rebuild()},v=O(o?o.getLevel():"WARN");var I=P();I!=null&&(b=O(I)),u.call(h)}o=new p,o.getLogger=function(T){if(typeof T!="symbol"&&typeof T!="string"||T==="")throw new TypeError("You must supply a name when creating a logger.");var h=s[T];return h||(h=s[T]=new p(T,o.methodFactory)),h};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(No)),No.exports}var Ya=iT(),ru;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(ru||(ru={}));var zt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(zt||(zt={}));let H=Ya.getLogger("livekit");Object.values(zt).map(t=>Ya.getLogger(t));H.setDefaultLevel(ru.info);function En(t){const e=Ya.getLogger(t);return e.setDefaultLevel(H.getLevel()),e}const rT=Ya.getLogger("lk-e2ee"),qr=7e3,sT=[0,300,2*2*300,3*3*300,4*4*300,qr,qr,qr,qr,qr];class oT{constructor(e){this._retryDelays=e!==void 0?[...e]:sT}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function aT(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function C(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Kh(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function gn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Kh=="function"?Kh(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var ho={exports:{}},Gh;function cT(){if(Gh)return ho.exports;Gh=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(S,w,P){return Function.prototype.apply.call(S,w,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:n=function(S){return Object.getOwnPropertyNames(S)};function i(b){console&&console.warn&&console.warn(b)}var r=Number.isNaN||function(S){return S!==S};function s(){s.init.call(this)}ho.exports=s,ho.exports.once=h,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function c(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(S){for(var w=[],P=1;P<arguments.length;P++)w.push(arguments[P]);var x=S==="error",O=this._events;if(O!==void 0)x=x&&O.error===void 0;else if(!x)return!1;if(x){var I;if(w.length>0&&(I=w[0]),I instanceof Error)throw I;var N=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw N.context=I,N}var j=O[S];if(j===void 0)return!1;if(typeof j=="function")e(j,this,w);else for(var V=j.length,Z=y(j,V),P=0;P<V;++P)e(Z[P],this,w);return!0};function l(b,S,w,P){var x,O,I;if(a(w),O=b._events,O===void 0?(O=b._events=Object.create(null),b._eventsCount=0):(O.newListener!==void 0&&(b.emit("newListener",S,w.listener?w.listener:w),O=b._events),I=O[S]),I===void 0)I=O[S]=w,++b._eventsCount;else if(typeof I=="function"?I=O[S]=P?[w,I]:[I,w]:P?I.unshift(w):I.push(w),x=c(b),x>0&&I.length>x&&!I.warned){I.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=b,N.type=S,N.count=I.length,i(N)}return b}s.prototype.addListener=function(S,w){return l(this,S,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(S,w){return l(this,S,w,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(b,S,w){var P={fired:!1,wrapFn:void 0,target:b,type:S,listener:w},x=u.bind(P);return x.listener=w,P.wrapFn=x,x}s.prototype.once=function(S,w){return a(w),this.on(S,d(this,S,w)),this},s.prototype.prependOnceListener=function(S,w){return a(w),this.prependListener(S,d(this,S,w)),this},s.prototype.removeListener=function(S,w){var P,x,O,I,N;if(a(w),x=this._events,x===void 0)return this;if(P=x[S],P===void 0)return this;if(P===w||P.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete x[S],x.removeListener&&this.emit("removeListener",S,P.listener||w));else if(typeof P!="function"){for(O=-1,I=P.length-1;I>=0;I--)if(P[I]===w||P[I].listener===w){N=P[I].listener,O=I;break}if(O<0)return this;O===0?P.shift():m(P,O),P.length===1&&(x[S]=P[0]),x.removeListener!==void 0&&this.emit("removeListener",S,N||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(S){var w,P,x;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[S]),this;if(arguments.length===0){var O=Object.keys(P),I;for(x=0;x<O.length;++x)I=O[x],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=P[S],typeof w=="function")this.removeListener(S,w);else if(w!==void 0)for(x=w.length-1;x>=0;x--)this.removeListener(S,w[x]);return this};function f(b,S,w){var P=b._events;if(P===void 0)return[];var x=P[S];return x===void 0?[]:typeof x=="function"?w?[x.listener||x]:[x]:w?T(x):y(x,x.length)}s.prototype.listeners=function(S){return f(this,S,!0)},s.prototype.rawListeners=function(S){return f(this,S,!1)},s.listenerCount=function(b,S){return typeof b.listenerCount=="function"?b.listenerCount(S):p.call(b,S)},s.prototype.listenerCount=p;function p(b){var S=this._events;if(S!==void 0){var w=S[b];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(b,S){for(var w=new Array(S),P=0;P<S;++P)w[P]=b[P];return w}function m(b,S){for(;S+1<b.length;S++)b[S]=b[S+1];b.pop()}function T(b){for(var S=new Array(b.length),w=0;w<S.length;++w)S[w]=b[w].listener||b[w];return S}function h(b,S){return new Promise(function(w,P){function x(I){b.removeListener(S,O),P(I)}function O(){typeof b.removeListener=="function"&&b.removeListener("error",x),w([].slice.call(arguments))}k(b,S,O,{once:!0}),S!=="error"&&v(b,x,{once:!0})})}function v(b,S,w){typeof b.on=="function"&&k(b,"error",S,w)}function k(b,S,w,P){if(typeof b.on=="function")P.once?b.once(S,w):b.on(S,w);else if(typeof b.addEventListener=="function")b.addEventListener(S,function x(O){P.once&&b.removeEventListener(S,x),w(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return ho.exports}var an=cT();let c0=!0,l0=!0;function ts(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Ai(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function lT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(c0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function uT(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(l0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function u0(){if(typeof window=="object"){if(c0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Vd(t,e){l0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function dT(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ts(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ts(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ts(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ts(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Qh(t){return Object.prototype.toString.call(t)==="[object Object]"}function d0(t){return Qh(t)?Object.keys(t).reduce(function(e,n){const i=Qh(t[n]),r=i?d0(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function su(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?su(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{su(t,t.get(r),n)})}))}function Jh(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&su(t,a,r)})}),r}const Yh=u0;function f0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",l)]=u.ideal,c.optional.push(f),f={},f[d("max",l)]=u.ideal,c.optional.push(f)):(f[d("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(y=>y.kind==="videoinput");let p=f.find(y=>d.some(m=>y.label.toLowerCase().includes(m)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),Yh("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Yh("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function h0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function p0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ai(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function m0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function g0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Jh(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Ai(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Jh(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function v0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function y0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return v0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[d.id];if(y)y.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new t.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],y=l._streams[p.id];d=d.replace(new RegExp(y.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],y=l._streams[p.id];d=d.replace(new RegExp(p.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[y=>{const m=s(this,y);f[0].apply(null,[m])},y=>{f[1]&&f[1].apply(null,y)},arguments[2]]):u.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ou(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function k0(t,e){Ai(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Xh=Object.freeze({__proto__:null,fixNegotiationNeeded:k0,shimAddTrackRemoveTrack:y0,shimAddTrackRemoveTrackWithNative:v0,shimGetSendersWithDtmf:m0,shimGetUserMedia:f0,shimMediaStream:h0,shimOnTrack:p0,shimPeerConnection:ou,shimSenderReceiverGetStats:g0});function b0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Vd("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function fT(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function S0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function au(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function C0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function T0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Ai(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function w0(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Vd("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function E0(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function P0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function R0(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function _0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function x0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Zh=Object.freeze({__proto__:null,shimAddTransceiver:P0,shimCreateAnswer:x0,shimCreateOffer:_0,shimGetDisplayMedia:fT,shimGetParameters:R0,shimGetUserMedia:b0,shimOnTrack:S0,shimPeerConnection:au,shimRTCDataChannel:E0,shimReceiverGetStats:T0,shimRemoveStream:w0,shimSenderGetStats:C0});function I0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function O0(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function M0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function D0(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(N0(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function N0(t){return t&&t.video!==void 0?Object.assign({},t,{video:d0(t.video)}):t}function A0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Vd("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function L0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U0(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function F0(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var ep=Object.freeze({__proto__:null,shimAudioContext:F0,shimCallbacksAPI:M0,shimConstraints:N0,shimCreateOfferLegacy:U0,shimGetUserMedia:D0,shimLocalStreamsAPI:I0,shimRTCIceServerUrls:A0,shimRemoteStreamsAPI:O0,shimTrackEventTransceiver:L0}),Lc={exports:{}},tp;function hT(){return tp||(tp=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(y=>parseInt(y,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(f=>{f.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Lc)),Lc.exports}var j0=hT(),dr=tT(j0),pT=RS({__proto__:null,default:dr},[j0]);function Ao(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=dr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Ai(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function cu(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ai(t,"icecandidate",e=>{if(e.candidate){const n=dr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Lo(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=dr.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=dr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=dr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function Uo(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Ai(t,"datachannel",i=>(e(i.channel,i.target),i))}function lu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function uu(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Fo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function jo(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var mT=Object.freeze({__proto__:null,removeExtmapAllowMixed:uu,shimAddIceCandidateNullOrEmpty:Fo,shimConnectionState:lu,shimMaxMessageSize:Lo,shimParameterlessSetLocalDescription:jo,shimRTCIceCandidate:Ao,shimRTCIceCandidateRelayProtocol:cu,shimSendThrowTypeError:Uo});function gT(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=u0,i=dT(t),r={browserDetails:i,commonShim:mT,extractVersion:ts,disableLog:lT,disableWarnings:uT,sdp:pT};switch(i.browser){case"chrome":if(!Xh||!ou||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Xh,Fo(t,i),jo(t),f0(t,i),h0(t),ou(t,i),p0(t),y0(t,i),m0(t),g0(t),k0(t,i),Ao(t),cu(t),lu(t),Lo(t,i),Uo(t),uu(t,i);break;case"firefox":if(!Zh||!au||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Zh,Fo(t,i),jo(t),b0(t,i),au(t,i),S0(t),w0(t),C0(t),T0(t),E0(t),P0(t),R0(t),_0(t),x0(t),Ao(t),lu(t),Lo(t,i),Uo(t);break;case"safari":if(!ep||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=ep,Fo(t,i),jo(t),A0(t),U0(t),M0(t),I0(t),O0(t),L0(t),D0(t),F0(t),Ao(t),cu(t),Lo(t,i),Uo(t),uu(t,i);break;default:n("Unsupported browser!");break}return r}gT({window:typeof window>"u"?void 0:window});const vT=10,Wr="lk_e2ee",yT="LKFrameEncryptionKey",kT={sharedKey:!1,ratchetSalt:yT,ratchetWindowSize:8,failureTolerance:vT,keyringSize:16};var ei;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(ei||(ei={}));var np;(function(t){t.KeyRatcheted="keyRatcheted"})(np||(np={}));var Wn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Wn||(Wn={}));var ip;(function(t){t.Error="cryptorError"})(ip||(ip={}));function bT(){return ST()||du()}function du(){return typeof window.RTCRtpScriptTransform<"u"}function ST(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class q_ extends an.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{H.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},kT),e),this.on(ei.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(ei.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ei.RatchetRequest,e,n)}}class xn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Q;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Q||(Q={}));class se extends xn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Q[n]}}class zd extends xn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class vn extends xn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class CT extends xn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ee extends xn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class fu extends xn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class rp extends xn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class sp extends xn{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Bd[n]}}var Lt;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"})(Lt||(Lt={}));class zn extends xn{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Lt[n]}}var Ds;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Ds||(Ds={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Ds||(Ds={}));var op;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(op||(op={}));var _;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(_||(_={}));var M;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(M||(M={}));var F;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(F||(F={}));var L;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(L||(L={}));function TT(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const wT=/version\/(\d+(\.?_?\d+)+)/i;let Uc;function ht(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Uc===void 0||e){const i=ET.find(r=>{let{test:s}=r;return s.test(n)});Uc=i==null?void 0:i.describe(n)}return Uc}const ET=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Bo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Fc(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Bo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Fc(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Bo(wT,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Fc(t)}}}];function Bo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Fc(t){return t.includes("mac os")?Bo(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var PT="2.15.5";const RT=PT,_T=16;class Ae{}Ae.setTimeout=function(){return setTimeout(...arguments)};Ae.setInterval=function(){return setInterval(...arguments)};Ae.clearTimeout=function(){return clearTimeout(...arguments)};Ae.clearInterval=function(){return clearInterval(...arguments)};const xT=5e3,Hr=[];var dt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(dt||(dt={}));class E extends an.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=E.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=H,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),xT):this.handleAppVisibilityChanged()},this.log=En((r=i.loggerName)!==null&&r!==void 0?r:zt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=E.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===E.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===E.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Hr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Hr.splice(Hr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),nr(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?L.AudioPlaybackStarted:L.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?L.AudioPlaybackFailed:L.VideoPlaybackFailed,s):s.name==="AbortError"?H.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):H.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(L.ElementAttached,e),e}detach(e){try{if(e){fr(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(L.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{fr(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(L.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=En(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Hr.forEach(i=>{i.parentElement||(n=!1)}),n&&Hr.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===E.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){et()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){et()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function nr(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ii()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ii()||wr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function fr(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Nt.AUDIO;case e.Video:return Nt.VIDEO;default:return Nt.DATA}}t.kindToProto=r;function s(l){switch(l){case Nt.AUDIO:return e.Audio;case Nt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return Te.CAMERA;case n.Microphone:return Te.MICROPHONE;case n.ScreenShare:return Te.SCREEN_SHARE;case n.ScreenShareAudio:return Te.SCREEN_SHARE_AUDIO;default:return Te.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case Te.CAMERA:return n.Camera;case Te.MICROPHONE:return n.Microphone;case Te.SCREEN_SHARE:return n.ScreenShare;case Te.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case tu.ACTIVE:return i.Active;case tu.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(E||(E={}));class ie{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const IT=["vp8","h264"],OT=["vp8","h264","vp9","av1","h265"];function MT(t){return!!IT.find(e=>e===t)}var ap;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(ap||(ap={}));var hu;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(hu||(hu={}));const Ns={h90:new ie(160,90,9e4,20),h180:new ie(320,180,16e4,20),h216:new ie(384,216,18e4,20),h360:new ie(640,360,45e4,20),h540:new ie(960,540,8e5,25),h720:new ie(1280,720,17e5,30),h1080:new ie(1920,1080,3e6,30),h1440:new ie(2560,1440,5e6,30),h2160:new ie(3840,2160,8e6,30)},pu={h120:new ie(160,120,7e4,20),h180:new ie(240,180,125e3,20),h240:new ie(320,240,14e4,20),h360:new ie(480,360,33e4,20),h480:new ie(640,480,5e5,20),h540:new ie(720,540,6e5,25),h720:new ie(960,720,13e5,30),h1080:new ie(1440,1080,23e5,30),h1440:new ie(1920,1440,38e5,30)},$d={h360fps3:new ie(640,360,2e5,3,"medium"),h360fps15:new ie(640,360,4e5,15,"medium"),h720fps5:new ie(1280,720,8e5,5,"medium"),h720fps15:new ie(1280,720,15e5,15,"medium"),h720fps30:new ie(1280,720,2e6,30,"medium"),h1080fps15:new ie(1920,1080,25e5,15,"medium"),h1080fps30:new ie(1920,1080,5e6,30,"medium"),original:new ie(0,0,7e6,30,"medium")},DT="|",cp="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function NT(t){const e=t.split(DT);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function st(t){return C(this,void 0,void 0,function*(){return new Promise(e=>Ae.setTimeout(e,t))})}function mu(){return"addTransceiver"in RTCPeerConnection.prototype}function gu(){return"addTrack"in RTCPeerConnection.prototype}function AT(){if(!("getCapabilities"in RTCRtpSender)||Ii())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function LT(){if(!("getCapabilities"in RTCRtpSender)||wr())return!1;if(Ii()){const n=ht();if(n!=null&&n.version&&sn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&sn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function Yt(t){return t==="av1"||t==="vp9"}function vu(t){return!document||va()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function UT(){return typeof RTCPeerConnection>"u"?!1:mu()||gu()}function wr(){var t;return((t=ht())===null||t===void 0?void 0:t.name)==="Firefox"}function Ii(){var t;return((t=ht())===null||t===void 0?void 0:t.name)==="Safari"}function va(){const t=ht();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function FT(){const t=ht();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&sn(t.osVersion,"17")>=0}function jT(t){return t||(t=ht()),(t==null?void 0:t.name)==="Safari"&&sn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&sn(t.osVersion,"18.3")>0}function B0(){var t,e;return et()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function BT(){const t=ht(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&sn(e,t.osVersion)>=0?!0:t.name==="Safari"&&sn(e,t.version)>=0}function et(){return typeof document<"u"}function rn(){return navigator.product=="ReactNative"}function yu(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function V0(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function z0(){if(!rn())return;let t=V0();if(t)return t.platform}function lp(){if(et())return window.devicePixelRatio;if(rn()){let t=V0();if(t)return t.devicePixelRatio}return 1}function sn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function VT(t){for(const e of t)e.target.handleResize(e)}function zT(t){for(const e of t)e.target.handleVisibilityChanged(e)}let jc=null;const up=()=>(jc||(jc=new ResizeObserver(VT)),jc);let Bc=null;const dp=()=>(Bc||(Bc=new IntersectionObserver(zT,{root:null,rootMargin:"0px"})),Bc);function $T(){var t;const e=new IC({sdk:Hv.JS,protocol:_T,version:RT});return rn()&&(e.os=(t=z0())!==null&&t!==void 0?t:""),e}function fp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Kr;function Vc(){if(!Kr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Kr]=i.stream.getAudioTracks(),!Kr)throw Error("Could not get empty media stream audio track");Kr.enabled=!1}return Kr.clone()}class Xt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>C(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function qT(t){return OT.includes(t)}function ti(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function WT(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ku(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function HT(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function KT(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function hp(t){switch(t.reason){case Q.LeaveRequest:return t.context;case Q.Cancelled:return Ft.CLIENT_INITIATED;case Q.NotAllowed:return Ft.USER_REJECTED;case Q.ServerUnreachable:return Ft.JOIN_FAILURE;default:return Ft.UNKNOWN_REASON}}function Vo(t){return t!==void 0?Number(t):void 0}function pi(t){return t!==void 0?BigInt(t):void 0}function Si(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function tn(t){return!!t&&t.kind==E.Kind.Audio}function Li(t){return!!t&&t.kind==E.Kind.Video}function Ln(t){return Si(t)&&Li(t)}function un(t){return Si(t)&&tn(t)}function bu(t){return!!t&&!t.isLocal}function GT(t){return!!t&&!t.isLocal}function zc(t){return bu(t)&&Li(t)}function QT(t){return t.isLocal}function JT(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function $0(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=H0(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,f=a??{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Su(f.audio,e),(i=(s=f.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(f.audio.processor=c??u)),f.video&&(Su(f.video,n),(r=(o=f.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(f.video.processor=l??d)),f}function Su(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function qd(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Su(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function q0(t){return C(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=W0();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield st(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function W0(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>C(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function YT(t){return t==="audioinput"?E.Source.Microphone:t==="videoinput"?E.Source.Camera:E.Source.Unknown}function Cu(t){return t===E.Source.Microphone?"audioinput":t===E.Source.Camera?"videoinput":void 0}function XT(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ii()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function zo(t){return t.split("/")[1].toLowerCase()}function ZT(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Fd({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function K(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?K(t.track):{})}}function e1(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function t1(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function H0(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:TT(e)}}function n1(t){switch(t){case Te.CAMERA:return E.Source.Camera;case Te.MICROPHONE:return E.Source.Microphone;case Te.SCREEN_SHARE:return E.Source.ScreenShare;case Te.SCREEN_SHARE_AUDIO:return E.Source.ScreenShareAudio;default:return E.Source.Unknown}}function pp(t,e){return t.width*t.height<e.width*e.height}function i1(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class r1 extends an.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":H.error(o.error.message),this.emit(Wn.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Wn.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Wn.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(ei.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{H.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Wn.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!bT())throw new zd("tried to setup end-to-end encryption on an unsupported browser");if(H.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:rT.getLevel()}};this.worker&&(H.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){H.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?H.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(F.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(_.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==lt.NONE,r.identity)),e.on(_.ConnectionStateChanged,i=>{i===Y.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==lt.NONE,r.identity)})})}).on(_.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(_.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(_.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(M.LocalSenderCreated,(i,r)=>C(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(ei.SetKey,i=>this.postKey(i)).on(ei.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?zo(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Si(e)||!n){n||H.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return C(this,void 0,void 0,function*(){if(this.worker){if(du()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Wr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Wr in e}};this.worker.postMessage(a,[o,s])}e[Wr]=!0}})}handleSender(e,n,i){var r;if(!(Wr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(du()){H.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{H.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Wr]=!0}}}const $c="default";class Ie{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ie),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ie.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){H.debug("awaiting getUserMedia promise");try{n?yield Ie.userMediaPromiseMap.get(n):yield Promise.all(Ie.userMediaPromiseMap.values())}catch{H.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ii()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return C(this,void 0,void 0,function*(){if(n!==$c)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===$c);if(!s){H.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==$c&&a.groupId===(i??s.groupId));if(!o){H.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ie.userMediaPromiseMap.has(e):Ie.userMediaPromiseMap.size>0}}Ie.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ie.userMediaPromiseMap=new Map;var hs;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(hs||(hs={}));class s1{constructor(){this.pendingTasks=new Map,this.taskMutex=new rt,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:hs.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=hs.RUNNING,yield e()}finally{n.status=hs.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function o1(t,e){const n=new URL(WT(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),K0(n,"rtc")}function a1(t){const e=new URL(ku(t));return K0(e,"validate")}function c1(t){return t.endsWith("/")?t:"".concat(t,"/")}function K0(t,e){return t.pathname="".concat(c1(t.pathname)).concat(e),t.toString()}const l1=["syncState","trickle","offer","answer","simulate","leave"];function u1(t){const e=l1.indexOf(t.case)>=0;return H.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var le;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(le||(le={}));class Wd{get currentState(){return this.state}get isDisconnected(){return this.state===le.DISCONNECTING||this.state===le.DISCONNECTED}get isEstablishingConnection(){return this.state===le.CONNECTING||this.state===le.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=le.DISCONNECTED,this.log=H,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=En((i=n.loggerName)!==null&&i!==void 0?i:zt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new s1,this.queuedRequests=[],this.closingLock=new rt,this.connectionLock=new rt,this.state=le.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return C(this,void 0,void 0,function*(){return this.state=le.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=le.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=$T(),o=d1(n,s,i),a=o1(e,o),c=a1(a);return new Promise((l,u)=>C(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const f=()=>C(this,void 0,void 0,function*(){this.close(),clearTimeout(p),u(new se("room connection has been cancelled (signal)",Q.Cancelled))}),p=setTimeout(()=>{this.close(),u(new se("room connection has timed out (signal)",Q.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&f(),r==null||r.addEventListener("abort",f);const y=new URL(a);y.searchParams.has("access_token")&&y.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(y),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(p)},this.ws.onerror=m=>C(this,void 0,void 0,function*(){if(this.state!==le.CONNECTED){this.state=le.DISCONNECTED,clearTimeout(p);try{const T=yield fetch(c);if(T.status.toFixed(0).startsWith("4")){const h=yield T.text();u(new se(h,Q.NotAllowed,T.status))}else u(new se("Encountered unknown websocket error during connection: ".concat(m.toString()),Q.InternalError,T.status))}catch(T){u(new se(T instanceof Error?T.message:"server was not reachable",Q.ServerUnreachable))}return}this.handleWSError(m)}),this.ws.onmessage=m=>C(this,void 0,void 0,function*(){var T,h,v;let k;if(typeof m.data=="string"){const b=JSON.parse(m.data);k=Wh.fromJson(b,{ignoreUnknownFields:!0})}else if(m.data instanceof ArrayBuffer)k=Wh.fromBinary(new Uint8Array(m.data));else{this.log.error("could not decode websocket message: ".concat(typeof m.data),this.logContext);return}if(this.state!==le.CONNECTED){let b=!1;if(((T=k.message)===null||T===void 0?void 0:T.case)==="join"?(this.state=le.CONNECTED,r==null||r.removeEventListener("abort",f),this.pingTimeoutDuration=k.message.value.pingTimeout,this.pingIntervalDuration=k.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(k.message.value)):this.state===le.RECONNECTING&&k.message.case!=="leave"?(this.state=le.CONNECTED,r==null||r.removeEventListener("abort",f),this.startPingInterval(),((h=k.message)===null||h===void 0?void 0:h.case)==="reconnect"?l(k.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),b=!0)):this.isEstablishingConnection&&k.message.case==="leave"?u(new se("Received leave request while trying to (re)connect",Q.LeaveRequest,void 0,k.message.value.reason)):i.reconnect||u(new se("did not receive join response, got ".concat((v=k.message)===null||v===void 0?void 0:v.case," instead"),Q.InternalError)),!b)return}this.signalLatency&&(yield st(this.signalLatency)),this.handleSignalResponse(k)}),this.ws.onclose=m=>{this.isEstablishingConnection&&u(new se("Websocket got closed during a (re)connection attempt",Q.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:m.reason,code:m.code,wasClean:m.wasClean,state:this.state})),this.handleOnClose(m.reason)}}finally{d()}}))}close(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=le.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,st(250)])),e.ws=void 0}}finally{n&&(e.state=le.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ya(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ya(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Ld({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Ud({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new e0({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Zv({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new i0({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:he.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new a0({timestamp:he.parse(Date.now()),rtt:he.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Xv({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Ja({reason:Ft.CLIENT_INITIATED,action:ur.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!u1(n)&&i.state===le.RECONNECTING){i.queuedRequests.push(()=>C(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield st(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new DC({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=mp(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=mp(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===le.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ae.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ae.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ae.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ae.clearInterval(this.pingInterval)}}function mp(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function ya(t,e){return new xi({sdp:t.sdp,type:t.type,id:e})}function d1(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",rn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class gp{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class f1{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var _t={},qc={},Wc={exports:{}},vp;function Hd(){if(vp)return Wc.exports;vp=1;var t=Wc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Wc.exports}var yp;function h1(){return yp||(yp=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=Hd(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var f=d[0],p=d.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var y=0;y<(r[f]||[]).length;y+=1){var m=r[f][y];if(m.reg.test(p))return i(m,u,p)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(qc)),qc}var Hc,kp;function p1(){if(kp)return Hc;kp=1;var t=Hd(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var f=a.names[d];a.name?u.push(c[a.name][f]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Hc=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(f){f.name in o&&o[f.name]!=null?u.push(i(d,f,o)):f.push in o&&o[f.push]!=null&&o[f.push].forEach(function(p){u.push(i(d,f,p))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(f){t[f].forEach(function(p){p.name in d&&d[p.name]!=null?u.push(i(f,p,d)):p.push in d&&d[p.push]!=null&&d[p.push].forEach(function(y){u.push(i(f,p,y))})})})}),u.join(`\r
`)+`\r
`},Hc}var bp;function m1(){if(bp)return _t;bp=1;var t=h1(),e=p1(),n=Hd();return _t.grammar=n,_t.write=e,_t.parse=t.parse,_t.parseParams=t.parseParams,_t.parseFmtpConfig=t.parseFmtpConfig,_t.parsePayloads=t.parsePayloads,_t.parseRemoteCandidates=t.parseRemoteCandidates,_t.parseImageAttributes=t.parseImageAttributes,_t.parseSimulcastStreamList=t.parseSimulcastStreamList,_t}var Un=m1();function Kd(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var p=Date.now()-l;if(p+e>=c)return c-p}return e}var f=function(){var p=[].slice.call(arguments),y=this;return new Promise(function(m,T){var h=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var k=t.apply(y,p);a&&a(k),u.forEach(function(b){return(0,b.resolve)(k)}),u=[]}},d()),h){var v=t.apply(y,p);return a&&a(v),m(v)}u.push({resolve:m,reject:T})})};return f.cancel=function(p){s!==void 0&&clearTimeout(s),u.forEach(function(y){return(0,y.reject)(p)}),u=[]},f}const g1=.7,v1=20,hr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Sp extends an.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=H,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Kd(r=>C(this,void 0,void 0,function*(){this.emit(hr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),v1),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=En((i=n.loggerName)!==null&&i!==void 0?i:zt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new rt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return C(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=y1(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Un.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let c=0;if(o.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0)return!0;let l=!1;for(const u of o.fmtp)if(u.payload===c){u.config=u.config.split(";").filter(d=>!d.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(u.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=Un.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(hr.NegotiationComplete),e.sdp&&Un.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(hr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Un.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Tp(a),a.type==="audio"?Cp(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||(Yt(c.codec)&&!Ii()&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*g1);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Un.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Un.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Tp(r),r.type==="audio"&&Cp(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Un.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ee("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ee("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return C(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new fu(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===cp))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:cp})}}}function Cp(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function y1(t){var e;const n=[],i=[],r=Un.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function Tp(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Tu="vp8",k1={audioPreset:hu.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:$d.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Tu,backupCodec:!0,preConnectBuffer:!1},G0={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Q0={deviceId:{ideal:"default"},resolution:Ns.h720.resolution},b1={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new oT,disconnectOnPageLeave:!0,webAudioMix:!1},Gd={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ve;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ve||(ve={}));class S1{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Gd.peerConnectionTimeout,this.log=H,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ve.CONNECTED:a.some(c=>c==="failed")?this.state=ve.FAILED:a.some(c=>c==="connecting")?this.state=ve.CONNECTING:a.every(c=>c==="closed")?this.state=ve.CLOSED:a.some(c=>c==="closed")?this.state=ve.CLOSING:a.every(c=>c==="new")&&(this.state=ve.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ve[o]," to ").concat(ve[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=En((r=i.loggerName)!==null&&r!==void 0?r:zt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Sp(e,i),this.subscriber=new Sp(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,At.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,At.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ve.NEW,this.connectionLock=new rt,this.remoteOfferLock=new rt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return C(this,void 0,void 0,function*(){n===At.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return C(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return C(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new Promise((n,i)=>C(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(hr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(hr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===At.PUBLISHER?this.publisher.getConnectedAddress():e===At.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>C(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Ae.clearTimeout(d),l(new se("room connection has been cancelled",Q.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Ae.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new se("could not establish pc connection",Q.InternalError))},o);for(;this.state!==ve.CONNECTED;)if(yield st(50),r!=null&&r.signal.aborted){l(new se("room connection has been cancelled",Q.Cancelled));return}Ae.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}class be extends Error{constructor(e,n,i){super(n),this.code=e,this.message=wp(n,be.MAX_MESSAGE_BYTES),this.data=i?wp(i,be.MAX_DATA_BYTES):void 0}static fromProto(e){return new be(e.code,e.message,e.data)}toProto(){return new zv({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new be(be.ErrorCode[e],be.ErrorMessage[e],n)}}be.MAX_MESSAGE_BYTES=256;be.MAX_DATA_BYTES=15360;be.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};be.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const J0=15360;function Qd(t){return new TextEncoder().encode(t).length}function wp(t,e){if(Qd(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Jd=2e3;function Xa(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Yd=typeof MediaRecorder<"u";class C1{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const T1=Yd?MediaRecorder:C1;class w1 extends T1{constructor(e,n){if(!Yd)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>C(this,void 0,void 0,function*(){let u;if(l.data.arrayBuffer){const d=yield l.data.arrayBuffer();u=new Uint8Array(d)}else if(l.data.byteArray)u=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function E1(){return Yd}const P1=1e3,R1=1e4;class Y0 extends E{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Kd(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(L.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new rt,this.pauseUpstreamLock=new rt,this.trackChangeLock=new rt,this.trackChangeLock.lock().then(o=>C(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==E.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return C(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{fr(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(nr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{nr(r??e,s)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P1;return function*(){var i;if(e.kind===E.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ht())===null||i===void 0?void 0:i.os)==="iOS"&&(yield st(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield st(50)}throw new vn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ti(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ti(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===E.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===E.Kind.Audio?"audioinput":"videoinput";return n?Ie.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return C(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new vn("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=aT(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===E.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{fr(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(L.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?L.Muted:L.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),B0()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(L.UpstreamPaused,this);const i=ht();if((i==null?void 0:i.name)==="Safari"&&sn(i.version,"12.0")<0)throw new zd("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(L.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(nr(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(fr(i._mediaStreamTrack,l),nr(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(L.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(L.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!E1()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new w1(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},R1)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class ka extends Y0{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,E.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Xa(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(L.AudioTrackFeatureUpdate,this,xe.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(L.AudioTrackFeatureUpdate,this,xe.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===E.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ti(this._constraints.deviceId);return this.source===E.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let n;if(e){const i=qd({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){et()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Jd)))}setProcessor(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!rn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(L.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield q0(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(L.AudioSilenceDetected)),e})}}function _1(t,e,n){switch(t.kind){case"audio":return new ka(t,e,!1,void 0,n);case"video":return new ba(t,e,!1,n);default:throw new vn("unsupported track type: ".concat(t.kind))}}const x1=Object.values(Ns),I1=Object.values(pu),O1=Object.values($d),M1=[Ns.h180,Ns.h360],D1=[pu.h180,pu.h360],N1=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ie(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),wu=["q","h","f"];function Eu(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=L1(t,e,n,l),H.debug("using video encoding",o));const u=o.maxFramerate,d=new ie(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Yt(l)){const y=new X0(c),m=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const T=ht();if(va()||rn()||(T==null?void 0:T.name)==="Chrome"&&sn(T==null?void 0:T.version,"113")<0){const h=y.suffix=="h"?2:3,v=jT(T);for(let k=0;k<y.spatial;k+=1)m.push({rid:wu[2-k],maxBitrate:o.maxBitrate/Math.pow(h,k),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:v?Math.pow(2,k):void 0});m[0].scalabilityMode=c}else m.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(m[0].priority=d.encoding.priority,m[0].networkPriority=d.encoding.priority),H.debug("using svc encoding",{encodings:m}),m}if(!a)return[o];let f=[];t?f=(r=Pp(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Ep(t,d):f=(s=Pp(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Ep(t,d);let p;if(f.length>0){const y=f[0];f.length>1&&([,p]=f);const m=Math.max(e,n);if(m>=960&&p)return Kc(e,n,[y,p,d],u);if(m>=480)return Kc(e,n,[y,d],u)}return Kc(e,n,[d])}function A1(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&H.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===E.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Eu(t.source===E.Source.ScreenShare,c,l,n)}function L1(t,e,n,i){const r=U1(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function U1(t,e,n){if(t)return O1;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?x1:I1}function Ep(t,e){if(t)return N1(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?M1:D1}function Kc(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=wu.length)return;const a=Math.min(t,e),l={rid:wu[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=wr()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),rn()&&z0()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,H.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),H.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Pp(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class X0{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function F1(t){return t.source===E.Source.ScreenShare||t.constraints.height&&ti(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const j1=5e3;class ba extends Y0{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,E.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(L.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const f=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=Xa(l,f)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new rt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!et())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Jd))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=gn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=gn(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===E.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===E.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=dt.LOW;i<=dt.HIGH;i+=1)n.push(new jd({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Yt(this.codec),n)}restartTrack(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=qd({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=gn(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var f=!0,p=gn(r.simulcastCodecs.values()),y;y=yield p.next(),o=y.done,!o;f=!0)l=y.value,f=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(m){a={error:m}}finally{try{!f&&!o&&(c=p.return)&&(yield c.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},j1))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Yt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=gn(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Yt(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const f of u.qualities)if(f.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Rp(d.sender,d.encodings,u.qualities,this.senderLock,Yt(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Rp(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Yt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),B0()&&this.isInBackground&&this.source===E.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Rp(t,e,n,i,r,s,o){return C(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(p=>p.enabled)&&n.forEach(p=>p.enabled=!0),l.forEach((f,p)=>{var y;let m=(y=f.rid)!==null&&y!==void 0?y:"";m===""&&(m="q");const T=Z0(m),h=n.find(v=>v.quality===T);h&&f.active!==h.enabled&&(u=!0,f.active=h.enabled,s.debug("setting layer ".concat(h.quality," to ").concat(f.active?"enabled":"disabled"),o),wr()&&(h.enabled?(f.scaleResolutionDownBy=e[p].scaleResolutionDownBy,f.maxBitrate=e[p].maxBitrate,f.maxFrameRate=e[p].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Z0(t){switch(t){case"f":return dt.HIGH;case"h":return dt.MEDIUM;case"q":return dt.LOW;default:return dt.HIGH}}function _p(t,e,n,i){if(!n)return[new bi({quality:dt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new X0(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new bi({quality:Math.min(dt.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Z0((o=r.rid)!==null&&o!==void 0?o:"");return new bi({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const xp="_lossy",Ip="_reliable",B1=2*1e3,Gc="leave-reconnect",V1=3e4;var xt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(xt||(xt={}));class z1 extends an.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Gd.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=xt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=H,this.reliableDataSequence=1,this.reliableMessageBuffer=new gp,this.reliableReceivedState=new f1(V1),this.handleDataChannel=i=>C(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Ip)s.reliableDCSub=o;else if(o.label===xp)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>C(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=Xe.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(F.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&q1(c,c.value.value),this.emit(F.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?W.LOSSY:W.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(F.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Gc&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ae.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===xt.Connected&&i();const s=()=>{this.off(F.Disconnected,o),i()},o=()=>{this.off(F.Restarted,s),r()};this.once(F.Restarted,s),this.once(F.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(F.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===W.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===le.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Vi.RR_SIGNAL_DISCONNECTED))},this.log=En((n=e.loggerName)!==null&&n!==void 0?n:zt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Wd(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new rt,this.dataProcessLock=new rt,this.dcBufferStatus=new Map([[W.LOSSY,!0],[W.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(F.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(F.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(F.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(F.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(F.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(F.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(F.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(F.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return C(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,this.emit(F.SignalConnected,s),s}catch(s){if(s instanceof se&&s.reason===Q.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(F.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new gp,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new vn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new se("publication of local track timed out, no response from server",Q.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return C(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ve.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new S1(r,e.subscriberPrimary,this.loggerOptions),this.emit(F.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ve.CONNECTED){const u=this.pcState===xt.New;this.pcState=xt.Connected,u&&this.emit(F.Connected,e)}else s===ve.FAILED&&this.pcState===xt.Connected&&(this.pcState=xt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Vi.RR_SUBSCRIBER_FAILED:Vi.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===le.RECONNECTING,l=[ve.FAILED,ve.CLOSING,ve.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(F.Offline)}),this.pcManager.onTrack=s=>{this.emit(F.MediaTrackAdded,s.track,s.streams[0],s.receiver)},$1((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(F.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(F.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(F.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(F.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(F.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Vi.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case ur.DISCONNECT:this.emit(F.Disconnected,e==null?void 0:e.reason),this.close();break;case ur.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Gc);break;case ur.RESUME:this.handleDisconnect(Gc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Os.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(xp,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Ip,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return C(this,void 0,void 0,function*(){if(mu())return yield this.createTransceiverRTCRtpSender(e,n,i);if(gu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ee("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(mu())return this.createSimulcastTransceiverSender(e,n,i,r);if(gu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ee("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ee("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Li(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ee("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ee("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){H.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Os.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ve.NEW)===ve.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Ee?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof zi||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Vi.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(F.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Ee("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new zi;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof se&&o.reason===Q.NotAllowed?new Ee("could not reconnect, token might be expired"):new zi}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(F.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==le.CONNECTED)throw new zi("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(F.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ee("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ee("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof se&&r.reason===Q.NotAllowed?new Ee("could not reconnect, token might be expired"):r instanceof se&&r.reason===Q.LeaveRequest?r:new zi(s)}if(this.emit(F.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==le.CONNECTED)throw new zi("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(F.Resumed)})}waitForPCInitialConnection(e,n){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ee("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=xt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield st(B1),!this.pcManager)throw new Ee("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=xt.Connected}catch(e){throw this.pcState=xt.Disconnected,new se("could not establish PC connection, ".concat(e.message),Q.InternalError)}})}publishRpcResponse(e,n,i,r){return C(this,void 0,void 0,function*(){const s=new Xe({destinationIdentities:[e],kind:W.RELIABLE,value:{case:"rpcResponse",value:new Vv({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,W.RELIABLE)})}publishRpcAck(e,n){return C(this,void 0,void 0,function*(){const i=new Xe({destinationIdentities:[e],kind:W.RELIABLE,value:{case:"rpcAck",value:new Bv({requestId:n})}});yield this.sendDataPacket(i,W.RELIABLE)})}sendDataPacket(e,n){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===W.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===W.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(W.RELIABLE);const n=this.dataChannelForKind(W.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(W.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(F.Closing,r);!this.dcBufferStatus.get(e);)yield st(10);this.off(F.Closing,r),n()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Ee("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new se("".concat(a," connection not set"),Q.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield st(50)}throw new se("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),Q.InternalError)}()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ve.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new Promise((e,n)=>C(this,void 0,void 0,function*(){if(!this.pcManager){n(new fu("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(F.Closing,r),this.pcManager.publisher.once(hr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();qT(c)&&o.set(a.payload,c)}),this.emit(F.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof fu&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Vi.RR_UNKNOWN),n(s)}finally{this.off(F.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===W.LOSSY)return this.lossyDCSub;if(e===W.RELIABLE)return this.reliableDCSub}else{if(e===W.LOSSY)return this.lossyDC;if(e===W.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new r0({answer:s?ya({sdp:s.sdp,type:s.type}):void 0,offer:o?ya({sdp:o.sdp,type:o.type}):void 0,subscription:new Qa({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:ZT(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((u,d)=>new s0({publisherSid:d,lastSeq:u}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new o0({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(W.LOSSY),At.PUBLISHER),n(this.dataChannelForKind(W.RELIABLE),At.PUBLISHER),n(this.dataChannelForKind(W.LOSSY,!0),At.SUBSCRIBER),n(this.dataChannelForKind(W.RELIABLE,!0),At.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ae.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){et()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){et()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class zi extends Error{}function $1(t){return t!==void 0&&t>13}function q1(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Pu{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return yu(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),H.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){const n=yield fetch("".concat(W1(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new se("Could not fetch region settings: ".concat(n.statusText),n.status===401?Q.NotAllowed:Q.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function W1(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class ey{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new zn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Lt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new zn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Lt.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class H1 extends ey{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Xt,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return C(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=gn(c),d;d=yield u.next(),i=d.done,!i;l=!0){o=d.value,l=!1;const f=o;a.add(f)}}catch(f){r={error:f}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class K1 extends ey{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Vo(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Xt,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:u}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(f){throw new zn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(f),Lt.DecodeFailed)}return{done:!1,value:d}}}catch(l){throw o(),l}}),return(){return C(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,u=gn(c),d;d=yield u.next(),i=d.done,!i;l=!0)o=d.value,l=!1,a+=o}catch(f){r={error:f}}finally{try{!l&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class G1{constructor(){this.log=H,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new zn('A text stream handler for topic "'.concat(e,'" has already been set.'),Lt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new zn('A byte stream handler for topic "'.concat(e,'" has already been set.'),Lt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new zn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Lt.AbnormalEnd);for(const[l,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e){return C(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n){return C(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o=new Xt,a={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Vo(e.timestamp),attributes:e.attributes},c=new ReadableStream({start:l=>{if(s=l,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Lt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:a,controller:s,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new H1(a,c,Vo(e.totalLength),o),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o=new Xt,a={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},c=new ReadableStream({start:l=>{if(s=l,this.textStreamControllers.has(e.streamId))throw new zn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Lt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:a,controller:s,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new K1(a,c,Vo(e.totalLength),o),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class ty{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class Q1 extends ty{}class J1 extends ty{}const Op=15e3;class Y1{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return C(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,f)=>{var p;c[f]=d;const y=c.reduce((m,T)=>m+T,0);(p=n==null?void 0:n.onProgress)===null||p===void 0||p.call(n,y)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,f)=>C(this,void 0,void 0,function*(){return this._sendFile(a[f],d,{topic:n.topic,mimeType:d.type,onProgress:p=>{l(p,f+1)}})})))),u.info})}streamText(e){return C(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new Xl({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:pi(s.timestamp),totalLength:pi(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new Qv({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Yl.UPDATE:Yl.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new Xe({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,W.RELIABLE);let l=0;const u=this.engine,d=new WritableStream({write(y){return C(this,void 0,void 0,function*(){for(const m of JT(y,Op)){yield u.waitForBufferStatusLow(W.RELIABLE);const T=new Zl({content:m,streamId:r,chunkIndex:pi(l)}),h=new Xe({destinationIdentities:a,value:{case:"streamChunk",value:T}});yield u.sendDataPacket(h,W.RELIABLE),l+=1}})},close(){return C(this,void 0,void 0,function*(){const y=new eu({streamId:r}),m=new Xe({destinationIdentities:a,value:{case:"streamTrailer",value:y}});yield u.sendDataPacket(m,W.RELIABLE)})},abort(y){console.log("Sink error:",y)}});let f=()=>C(this,void 0,void 0,function*(){yield p.close()});u.once(F.Closing,f);const p=new Q1(d,s,()=>this.engine.off(F.Closing,f));return p})}sendFile(e,n){return C(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return C(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new Xl({totalLength:pi((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:pi(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new Jv({name:l.name})}}),d=new Xe({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,W.RELIABLE);let f=0;const p=new rt,y=this.engine,m=this.log,T=new WritableStream({write(v){return C(this,void 0,void 0,function*(){const k=yield p.lock();let b=0;try{for(;b<v.byteLength;){const S=v.slice(b,b+Op);yield y.waitForBufferStatusLow(W.RELIABLE);const w=new Xe({destinationIdentities:c,value:{case:"streamChunk",value:new Zl({content:S,streamId:a,chunkIndex:pi(f)})}});yield y.sendDataPacket(w,W.RELIABLE),f+=1,b+=S.byteLength}}finally{k()}})},close(){return C(this,void 0,void 0,function*(){const v=new eu({streamId:a}),k=new Xe({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield y.sendDataPacket(k,W.RELIABLE)})},abort(v){m.error("Sink error:",v)}});return new J1(T,l)})}}class ny extends E{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?L.Muted:L.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(L.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Jd)),e1()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(L.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class iy extends ny{constructor(e,n,i,r,s,o){super(e,n,E.Kind.Audio,i,o),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Xa(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;rn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(rn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(vu(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&vu(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(L.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(L.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Qc=100;class X1 extends ny{constructor(e,n,i,r,s){super(e,n,E.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Xa(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Kd(()=>{this.updateDimensions()},Qc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?fr(this._mediaStreamTrack,n):nr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new Z1(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<Qc){Ae.setTimeout(()=>{this.updateVisibility()},Qc);return}this.lastVisible=o,this.emit(L.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(L.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?lp():n||(lp()>2?2:1)}}class Z1{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=Gr(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Gr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Gr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Ru(e),this.isPiP=et()&&Gr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Ru(this.element),this.isPiP=Gr(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,dp().observe(this.element),up().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=dp())===null||e===void 0||e.unobserve(this.element),(n=up())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Gr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Ru(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Ru(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class hn extends an.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=lt.NONE,this.log=H,this.handleMuted=()=>{this.emit(L.Muted)},this.handleUnmuted=()=>{this.emit(L.Unmuted)},this.log=En((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:zt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=E.Source.Unknown}setTrack(e){this.track&&(this.track.off(L.Muted,this.handleMuted),this.track.off(L.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(L.Muted,this.handleMuted),e.on(L.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),K(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==lt.NONE}get audioTrack(){if(tn(this.track))return this.track}get videoTrack(){if(Li(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=E.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===E.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(hn||(hn={}));class Sa extends hn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(L.Ended)},this.handleCpuConstrained=()=>{this.track&&Li(this.track)&&this.emit(L.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(L.Ended,this.handleTrackEnded),this.track.off(L.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(L.Ended,this.handleTrackEnded),e.on(L.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(tn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(xe.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(xe.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(xe.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(xe.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(xe.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(xe.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Za(t,e){return C(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=H0(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=$0(s,G0,Q0),l=qd(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ie.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Ie.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ie.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Ie.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(f=>C(this,void 0,void 0,function*(){const p=f.kind==="audio";let y=p?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let m;const T=p?l.audio:l.video;typeof T!="boolean"&&(m=T);const h=f.getSettings().deviceId;m!=null&&m.deviceId&&ti(m.deviceId)!==h?m.deviceId=h:m||(m={deviceId:h});const v=_1(f,m,e);return v.kind===E.Kind.Video?v.source=E.Source.Camera:v.kind===E.Kind.Audio&&(v.source=E.Source.Microphone),v.mediaStream=d,tn(v)&&i?yield v.setProcessor(i):Li(v)&&r&&(yield v.setProcessor(r)),v})))}catch(d){if(!n)throw d;return Za(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function ew(t){return C(this,void 0,void 0,function*(){return(yield Za({audio:!1,video:!0}))[0]})}function tw(t){return C(this,void 0,void 0,function*(){return(yield Za({audio:!0,video:!1}))[0]})}var Ut;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Ut||(Ut={}));function nw(t){switch(t){case es.EXCELLENT:return Ut.Excellent;case es.GOOD:return Ut.Good;case es.POOR:return Ut.Poor;case es.LOST:return Ut.Lost;default:return Ut.Unknown}}class ry extends an.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ms.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===lr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ms.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ut.Unknown,this.log=H,this.log=En((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:zt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Xt,this.once(M.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(E.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(E.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(E.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===lr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==lr.ACTIVE&&this.emit(M.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(M.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(M.ParticipantNameChanged,e)}_setAttributes(e){const n=t1(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(M.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var f;return u!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(M.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(M.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=nw(e),n!==this._connectionQuality&&this.emit(M.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>tn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(L.Muted,()=>{this.emit(M.TrackMuted,e)}),e.on(L.Unmuted,()=>{this.emit(M.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case E.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case E.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function iw(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new n0({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class rw extends ry{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=lt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Xt)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,u,d,f;this.reconnectFuture&&(this.reconnectFuture.promise.catch(p=>this.log.warn(p.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(l=this.signalConnectedFuture).reject)===null||u===void 0||u.call(l,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(f=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Xt),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:u}=a,d=this.pendingSignalRequests.get(c);d&&(l!==Bd.OK&&d.reject(new sp(u,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,u=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(u=be.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>iw(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),K(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),K(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),K(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),K(c))),this.emit(M.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>C(this,void 0,void 0,function*(){var c,l,u,d,f;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const p=this.videoTrackPublications.get(a.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!p.videoTrack)return;const y=yield p.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var m=!0,T=gn(y),h;h=yield T.next(),c=h.done,!c;m=!0){d=h.value,m=!1;const v=d;MT(v)&&(this.log.debug("publish ".concat(v," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),K(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,v,p.options))}}catch(v){l={error:v}}finally{try{!m&&!c&&(u=T.return)&&(yield u.call(T))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>C(this,void 0,void 0,function*(){if(a.source===E.Source.ScreenShare||a.source===E.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),K(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(un(a)||Ln(a))try{if(et())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===E.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),K(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),K(a))),un(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),K(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==lt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(F.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(F.Connected,this.handleReconnected).on(F.SignalConnected,this.handleSignalConnected).on(F.SignalRestarted,this.handleReconnected).on(F.SignalResumed,this.handleReconnected).on(F.Restarting,this.handleReconnecting).on(F.Resuming,this.handleReconnecting).on(F.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(F.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(F.Closing,this.handleClosing).on(F.SignalRequestResponse,this.handleSignalRequestResponse).on(F.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>C(i,void 0,void 0,function*(){var l,u;try{let d=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(f,{resolve:a,reject:y=>{c(y),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-p<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(y=>{let[m,T]=y;return this.attributes[m]===T||T===""&&!this.attributes[m]}))){this.pendingSignalRequests.delete(f),a();return}yield st(50)}c(new sp("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(E.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(E.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(E.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(M.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?lt.GCM:lt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return C(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case E.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case E.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case E.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new vn(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(M.MediaDevicesError,l,Cu(e)),this.pendingPublishing.delete(e),l}for(const l of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===E.Source.Microphone&&tn(l)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),K(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===E.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(E.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(E.Source.Camera)||this.pendingPublishing.has(E.Source.Microphone))){this.pendingPublishing.add(E.Source.Camera),this.pendingPublishing.add(E.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(E.Source.Camera),this.pendingPublishing.delete(E.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var n,i;e??(e={});const r=$0(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Za(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(tn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=E.Source.Microphone,this.emit(M.AudioStreamAcquired)),Li(a)&&(this.cameraError=void 0,a.source=E.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new zd("getDisplayMedia not supported");e.resolution===void 0&&!FT()&&(e.resolution=$d.h1080fps30.resolution);const n=XT(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new vn("no video track found");const s=new ba(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=E.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(M.AudioStreamAcquired);const a=new ka(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=E.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;un(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Si(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let h;switch(i.source){case E.Source.Microphone:h="audioinput";break;case E.Source.Camera:h="videoinput"}h&&s.activeDeviceMap.has(h)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(h)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new ka(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new ba(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new vn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let f;if(s.trackPublications.forEach(h=>{h.track&&h.track===i&&(f=h)}),f)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),K(f))),f;const p="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,y=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:p;y&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),K(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(u=r.red)!==null&&u!==void 0||(r.red=!1));const m=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!BT()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),m.simulcast=!1),m.source&&(i.source=m.source);const T=new Promise((h,v)=>C(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==le.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:K(i)}));const k=setTimeout(()=>{v(new rp("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(k);const b=yield this.publish(i,m,y);h(b)}else try{const k=yield this.publish(i,m,y);h(k)}catch(k){v(k)}}catch(k){v(k)}}));s.pendingPublishPromises.set(i,T);try{return yield T}catch(h){throw h}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Xt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),K(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>n1(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),K(e))),!1)}publish(e,n,i){return C(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,f,p;if(!this.hasPermissionsToPublish(e))throw new rp("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(O=>Si(e)&&O.source===e.source)&&e.source!==E.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),K(e))),n.stopMicTrackOnMute&&tn(e)&&(e.stopOnMute=!0),e.source===E.Source.ScreenShare&&wr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!AT()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!LT()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Tu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(O=>n.videoCodec===zo(O.mime))||(n.videoCodec=zo(this.enabledPublishVideoCodecs[0].mime)));const m=n.videoCodec;e.on(L.Muted,this.onTrackMuted),e.on(L.Unmuted,this.onTrackUnmuted),e.on(L.Ended,this.handleTrackEnded),e.on(L.UpstreamPaused,this.onTrackUpstreamPaused),e.on(L.UpstreamResumed,this.onTrackUpstreamResumed),e.on(L.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const T=[],h=!(!((r=n.dtx)!==null&&r!==void 0)||r),v=e.getSourceTrackSettings();v.autoGainControl&&T.push(xe.TF_AUTO_GAIN_CONTROL),v.echoCancellation&&T.push(xe.TF_ECHO_CANCELLATION),v.noiseSuppression&&T.push(xe.TF_NOISE_SUPPRESSION),v.channelCount&&v.channelCount>1&&T.push(xe.TF_STEREO),h&&T.push(xe.TF_NO_DTX),un(e)&&e.hasPreConnectBuffer&&T.push(xe.TF_PRECONNECT_BUFFER);const k=new iu({cid:e.mediaStreamTrack.id,name:n.name,type:E.kindToProto(e.kind),muted:e.isMuted,source:E.sourceToProto(e.source),disableDtx:h,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:T});let b;if(e.kind===E.Kind.Video){let O={width:0,height:0};try{O=yield e.waitForDimensions()}catch{const N=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Ns.h720.resolution;O={width:N.width,height:N.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{dims:O}))}k.width=O.width,k.height=O.height,Ln(e)&&(Yt(m)&&(e.source===E.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),K(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),k.simulcastCodecs=[new nu({codec:m,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Tu}),n.backupCodec&&m!==n.backupCodec.codec&&k.encryption===lt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),k.simulcastCodecs.push(new nu({codec:n.backupCodec.codec,cid:""})))),b=Eu(e.source===E.Source.ScreenShare,k.width,k.height,n),k.layers=_p(k.width,k.height,b,Yt(n.videoCodec))}else e.kind===E.Kind.Audio&&(b=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ee("cannot publish track when not connected");const S=()=>C(this,void 0,void 0,function*(){var O,I,N;if(!this.engine.pcManager)throw new Ee("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,b),this.emit(M.LocalSenderCreated,e.sender,e),Ln(e)&&((O=n.degradationPreference)!==null&&O!==void 0||(n.degradationPreference=F1(e)),e.setDegradationPreference(n.degradationPreference)),b)if(wr()&&e.kind===E.Kind.Audio){let j;for(const V of this.engine.pcManager.publisher.getTransceivers())if(V.sender===e.sender){j=V;break}j&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:j,codec:"opus",maxbr:!((I=b[0])===null||I===void 0)&&I.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&Yt(e.codec)&&(!((N=b[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:k.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let w;const P=new Promise((O,I)=>C(this,void 0,void 0,function*(){var N;try{w=yield this.engine.addTrack(k),O(w)}catch(j){e.sender&&(!((N=this.engine.pcManager)===null||N===void 0)&&N.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(V=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:V}))})),I(j)}}));if(this.enabledPublishVideoCodecs.length>0)w=(yield Promise.all([P,S()]))[0];else{w=yield P;let O;if(w.codecs.forEach(I=>{O===void 0&&(O=I.mimeType)}),O&&e.kind===E.Kind.Video){const I=zo(O);I!==m&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{codec:I})),n.videoCodec=I,b=Eu(e.source===E.Source.ScreenShare,k.width,k.height,n))}yield S()}const x=new Sa(e.kind,w,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(x.on(L.CpuConstrained,O=>this.onTrackCpuConstrained(O,x)),x.options=n,e.sid=w.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:w})),Ln(e)?e.startMonitor(this.engine.client):un(e)&&e.startMonitor(),this.addTrackPublication(x),this.emit(M.LocalTrackPublished,x),un(e)&&w.audioFeatures.includes(xe.TF_PRECONNECT_BUFFER)){const O=e.getPreConnectBuffer(),I=e.getPreConnectBufferMimeType();this.on(M.LocalTrackSubscribed,N=>{if(N.trackSid===w.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e))),e.stopPreConnectBuffer()}}),O&&new Promise((j,V)=>C(this,void 0,void 0,function*(){var Z,qe,te,De,U,z;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),K(e)));const Et=setTimeout(()=>{V(new Error("agent not active within 10 seconds"))},1e4),Pt=yield this.waitUntilActiveAgentPresent();clearTimeout(Et),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),K(e)));const Mn=yield this.streamBytes({name:"preconnect-buffer",mimeType:I,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Pt.identity],attributes:{trackId:x.trackSid,sampleRate:String((U=v.sampleRate)!==null&&U!==void 0?U:"48000"),channels:String((z=v.channelCount)!==null&&z!==void 0?z:"1")}});try{for(var $=!0,ne=gn(O),re;re=yield ne.next(),Z=re.done,!Z;$=!0){De=re.value,$=!1;const We=De;yield Mn.write(We)}}catch(We){qe={error:We}}finally{try{!$&&!Z&&(te=ne.return)&&(yield te.call(ne))}finally{if(qe)throw qe.error}}yield Mn.close(),j()}catch(Et){V(Et)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),K(e)))}).catch(j=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{error:j}))})}return x})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return C(this,void 0,void 0,function*(){var r;if(this.encryptionType!==lt.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new vn("track is not published");if(!Ln(e))throw new vn("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=A1(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),K(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new iu({cid:c.mediaStreamTrack.id,type:E.kindToProto(e.kind),muted:e.isMuted,source:E.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=_p(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Ee("cannot publish track when not connected");const u=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:f}))})}unpublishTrack(e,n){return C(this,void 0,void 0,function*(){var i,r;if(Si(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),K(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?K(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(L.Muted,this.onTrackMuted),e.off(L.Unmuted,this.onTrackUnmuted),e.off(L.Ended,this.handleTrackEnded),e.off(L.UpstreamPaused,this.onTrackUpstreamPaused),e.off(L.UpstreamResumed,this.onTrackUpstreamResumed),e.off(L.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ve.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Ln(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case E.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case E.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(M.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>C(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>C(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==E.Source.ScreenShare&&l.source!==E.Source.ScreenShareAudio&&(un(l)||Ln(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?W.RELIABLE:W.LOSSY,o=r.destinationIdentities,a=r.topic,c=new Xe({kind:s,value:{case:"user",value:new Uv({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return C(this,void 0,void 0,function*(){const i=new Xe({kind:W.RELIABLE,value:{case:"sipDtmf",value:new Fv({code:e,digit:n})}});yield this.engine.sendDataPacket(i,W.RELIABLE)})}sendChatMessage(e,n){return C(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Xe({value:{case:"chatMessage",value:new Jl(Object.assign(Object.assign({},i),{timestamp:he.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,W.RELIABLE),this.emit(M.ChatMessage,i),i})}editChatMessage(e,n){return C(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Xe({value:{case:"chatMessage",value:new Jl(Object.assign(Object.assign({},i),{timestamp:he.parse(i.timestamp),editTimestamp:he.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,W.RELIABLE),this.emit(M.ChatMessage,i),i})}sendText(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return C(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,u)=>C(i,void 0,void 0,function*(){var d,f,p,y;if(Qd(o)>J0){u(be.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((f=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||f===void 0)&&f.version&&sn((y=(p=this.engine.latestJoinResponse)===null||p===void 0?void 0:p.serverInfo)===null||y===void 0?void 0:y.version,"1.8.0")<0){u(be.builtIn("UNSUPPORTED_SERVER"));return}const m=crypto.randomUUID();yield this.publishRpcRequest(r,m,s,o,a-2e3);const T=setTimeout(()=>{this.pendingAcks.delete(m),u(be.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(m),clearTimeout(h)},2e3);this.pendingAcks.set(m,{resolve:()=>{clearTimeout(T)},participantIdentity:r});const h=setTimeout(()=>{this.pendingResponses.delete(m),u(be.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(m,{resolve:(v,k)=>{clearTimeout(h),this.pendingAcks.has(m)&&(console.warn("RPC response received before ack",m),this.pendingAcks.delete(m),clearTimeout(T)),k?u(k):l(v??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return C(this,void 0,void 0,function*(){const o=new Xe({destinationIdentities:[e],kind:W.RELIABLE,value:{case:"rpcRequest",value:new jv({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,W.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,be.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),K(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Xt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(un(r)||Ln(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield st(20)}})}}class Ca extends hn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(L.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Qa({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new $v({participantSid:"",trackSids:[this.trackSid]})]});this.emit(L.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?hn.SubscriptionStatus.Unsubscribed:super.isSubscribed?hn.SubscriptionStatus.Subscribed:hn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?hn.PermissionStatus.Allowed:hn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(zc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&zc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:dt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(L.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(L.VisibilityChanged,this.handleVisibilityChange),r.off(L.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(L.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(L.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(L.VisibilityChanged,this.handleVisibilityChange),e.on(L.Ended,this.handleEnded),this.emit(L.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(L.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?L.Muted:L.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(L.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(L.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return zc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Yv({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===E.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)pp(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=i1(this.trackInfo,this.requestedMaxQuality);i&&pp(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:dt.HIGH})),e.quality=dt.HIGH)}this.emit(L.UpdateSettings,e)}}class Ta extends ry{static fromParticipantInfo(e,n,i){return new Ta(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ms.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(L.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),K(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(L.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(L.SubscriptionPermissionChanged,n=>{this.emit(M.TrackSubscriptionPermissionChanged,e,n)}),e.on(L.SubscriptionStatusChanged,n=>{this.emit(M.TrackSubscriptionStatusChanged,e,n)}),e.on(L.Subscribed,n=>{this.emit(M.TrackSubscribed,n,e)}),e.on(L.Unsubscribed,n=>{this.emit(M.TrackUnsubscribed,n,e)}),e.on(L.SubscriptionFailed,n=>{this.emit(M.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(M.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),K(a))),this.emit(M.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new X1(e,n,r,s):l=new iy(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&bu(l)&&tn(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=E.kindFromProto(r.type);if(!c)return;a=new Ca(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==E.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:K(l),newTrack:K(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),K(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(M.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case E.Kind.Audio:this.audioTrackPublications.delete(e);break;case E.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(M.TrackUnpublished,i)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;tn(i.track)&&bu(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Y;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Y||(Y={}));const sw=4*1e3;class Pn extends an.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=Y.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=H,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>C(this,void 0,void 0,function*(){var l;if(!UT())throw rn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Y.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Y.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),yu(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Pu(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(p=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(p)}).catch(p=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:p}))}));const d=(p,y,m)=>C(this,void 0,void 0,function*(){var T,h;this.abortController&&this.abortController.abort();const v=new AbortController;this.abortController=v,u==null||u();try{yield this.attemptConnection(m??o,a,c,v),this.abortController=void 0,p()}catch(k){if(this.regionUrlProvider&&k instanceof se&&k.reason!==Q.Cancelled&&k.reason!==Q.NotAllowed){let b=null;try{b=yield this.regionUrlProvider.getNextBestRegionUrl((T=this.abortController)===null||T===void 0?void 0:T.signal)}catch(S){if(S instanceof se&&(S.status===401||S.reason===Q.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(S);return}}b&&!(!((h=this.abortController)===null||h===void 0)&&h.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(b),this.logContext),this.recreateEngine(),yield d(p,y,b)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,hp(k)),y(k))}else{let b=Ft.UNKNOWN_REASON;k instanceof se&&(b=hp(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,b),y(k)}}}),f=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Xt((p,y)=>{d(p,y,f)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>C(this,void 0,void 0,function*(){var f,p,y;const m=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let T=m.serverInfo;if(T||(T={version:m.serverVersion,region:m.serverRegion}),this.serverInfo=T,this.log.debug("connected to Livekit Server ".concat(Object.entries(T).map(h=>{let[v,k]=h;return"".concat(v,": ").concat(k)}).join(", ")),{room:(f=m.room)===null||f===void 0?void 0:f.name,roomSid:(p=m.room)===null||p===void 0?void 0:p.sid,identity:(y=m.participant)===null||y===void 0?void 0:y.identity}),!T.version)throw new CT("unknown server version");return T.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),m}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>C(this,void 0,void 0,function*(){var u,d;this.state===Y.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Gd),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const f=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(f),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected)}catch(f){yield this.engine.close(),this.recreateEngine();const p=new se("could not establish signal connection",Q.ServerUnreachable);throw f instanceof Error&&(p.message="".concat(p.message,": ").concat(f.message)),f instanceof se&&(p.reason=f.reason,p.status=f.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:f})),p}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new se("Connection attempt aborted",Q.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(f){throw yield this.engine.close(),this.recreateEngine(),f}et()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),et()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Y.Connected),this.emit(_.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return C(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,f,p,y;const m=yield l.disconnectLock.lock();try{if(l.state===Y.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===Y.Connecting||l.state===Y.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(p=(f=l.connectFuture)===null||f===void 0?void 0:f.reject)===null||p===void 0||p.call(f,new se("Client initiated disconnect",Q.Cancelled)),l.connectFuture=void 0),!((y=l.engine)===null||y===void 0)&&y.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Ft.CLIENT_INITIATED),l.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const o=[],a=ht();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=Vc();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(_.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)},this.handleSignalRestarted=o=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Y.Connected),this.emit(_.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===lr.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(_.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(_.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=E.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(M.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(_.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(_.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(M.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(_.SipDTMFReceived,a,o),o==null||o.emit(M.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=HT(a,this.transcriptionReceivedTimes);l==null||l.emit(L.TranscriptionReceived,u),c==null||c.emit(M.TranscriptionReceived,u,l),this.emit(_.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=KT(a);this.emit(_.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(_.MetricsReceived,o,a)},this.handleDataStream=o=>{this.incomingDataStreamManager.handleDataStreamPacket(o)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(_.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(_.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(_.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(_.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var o;((o=ht())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(_.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(_.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(_.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(_.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(_.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(_.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(_.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(_.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>C(this,void 0,void 0,function*(){var a,c,l,u,d,f;(a=o.track)===null||a===void 0||a.on(L.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(L.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(_.LocalTrackPublished,o,this.localParticipant),un(o.track)&&(yield o.track.checkForSilence())&&this.emit(_.LocalAudioSilenceDetected,o);const p=yield(f=o.track)===null||f===void 0?void 0:f.getDeviceId(!1),y=Cu(o.source);y&&p&&p!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,p),this.emit(_.ActiveDeviceChanged,y,p))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(L.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(L.Restarted,this.onLocalTrackRestarted),this.emit(_.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>C(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=Cu(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(_.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(_.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(_.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(_.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(_.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},b1),e),this.log=En((i=this.options.loggerName)!==null&&i!==void 0?i:zt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},G0),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Q0),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},k1),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new G1,this.outgoingDataStreamManager=new Y1(this.engine,this.log),this.disconnectLock=new rt,this.localParticipant=new rw("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ti(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ti(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ti(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),et()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),Pn.cleanupRegistry&&Pn.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new r1(this.options.e2ee),this.e2eeManager.on(Wn.ParticipantEncryptionStatusChanged,(n,i)=>{QT(i)&&(this.isE2EEEnabled=n),this.emit(_.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(Wn.EncryptionError,n=>this.emit(_.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return C(this,void 0,void 0,function*(){return this.state===Y.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(F.RoomUpdate,i),e(r.sid))};this.engine.on(F.RoomUpdate,i),this.once(_.Disconnected,()=>{this.engine.off(F.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new z1(this.options),this.engine.on(F.ParticipantUpdate,this.handleParticipantUpdates).on(F.RoomUpdate,this.handleRoomUpdate).on(F.SpeakersChanged,this.handleSpeakersChanged).on(F.StreamStateChanged,this.handleStreamStateUpdate).on(F.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(F.SubscriptionError,this.handleSubscriptionError).on(F.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(F.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(F.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(F.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(F.DataPacketReceived,this.handleDataPacket).on(F.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Y.SignalReconnecting)&&this.emit(_.SignalReconnecting)}).on(F.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Y.Connected)&&this.emit(_.Reconnected)}).on(F.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Y.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(F.Restarting,this.handleRestarting).on(F.SignalRestarted,this.handleSignalRestarted).on(F.Offline,()=>{this.setAndEmitConnectionState(Y.Reconnecting)&&this.emit(_.Reconnecting)}).on(F.DCBufferStatusChanged,(e,n)=>{this.emit(_.DCBufferStatusChanged,e,n)}).on(F.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(M.LocalTrackSubscribed,n),this.emitWhenConnected(_.LocalTrackSubscribed,n,this.localParticipant)}).on(F.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(_.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ie.getInstance().getDevices(e,n)}prepareConnection(e,n){return C(this,void 0,void 0,function*(){if(this.state===Y.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(yu(new URL(e))&&n){this.regionUrlProvider=new Pu(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Y.Disconnected&&(this.regionUrl=i,yield fetch(ku(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ku(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return C(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Kt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Kt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Kt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Kt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Kt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Kt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>C(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Ja({reason:Ft.CLIENT_INITIATED,action:ur.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Kt({scenario:{case:"subscriberBandwidth",value:pi(n)}});break;case"leave-full-reconnect":r=new Kt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,f,p;let y=!0,m=!1;const T=o?{exact:r}:r;if(i==="audioinput"){m=s.localParticipant.audioTrackPublications.size===0;const h=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=T;const v=Array.from(s.localParticipant.audioTrackPublications.values()).filter(b=>b.source===E.Source.Microphone);try{y=(yield Promise.all(v.map(b=>{var S;return(S=b.audioTrack)===null||S===void 0?void 0:S.setDeviceId(T)}))).every(b=>b===!0)}catch(b){throw s.options.audioCaptureDefaults.deviceId=h,b}const k=v.some(b=>{var S,w;return(w=(S=b.track)===null||S===void 0?void 0:S.isMuted)!==null&&w!==void 0?w:!1});y&&k&&(m=!0)}else if(i==="videoinput"){m=s.localParticipant.videoTrackPublications.size===0;const h=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=T;const v=Array.from(s.localParticipant.videoTrackPublications.values()).filter(b=>b.source===E.Source.Camera);try{y=(yield Promise.all(v.map(b=>{var S;return(S=b.videoTrack)===null||S===void 0?void 0:S.setDeviceId(T)}))).every(b=>b===!0)}catch(b){throw s.options.videoCaptureDefaults.deviceId=h,b}const k=v.some(b=>{var S,w;return(w=(S=b.track)===null||S===void 0?void 0:S.isMuted)!==null&&w!==void 0?w:!1});y&&k&&(m=!0)}else if(i==="audiooutput"){if(m=!0,!vu()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield Ie.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(p=s.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const h=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((f=s.audioContext)===null||f===void 0||f.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(v=>v.setAudioOutput({deviceId:r})))}catch(v){throw s.options.audioOutput.deviceId=h,v}}return m&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(_.ActiveDeviceChanged,i,r)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(M.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(M.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(M.AttributesChanged,this.onLocalAttributesChanged).on(M.TrackMuted,this.onLocalTrackMuted).on(M.TrackUnmuted,this.onLocalTrackUnmuted).on(M.LocalTrackPublished,this.onLocalTrackPublished).on(M.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(M.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(M.MediaDevicesError,this.onMediaDevicesError).on(M.AudioStreamAcquired,this.startAudio).on(M.ChatMessage,this.onLocalChatMessageSent).on(M.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Y.Connecting||this.state===Y.Reconnecting){const u=()=>{this.onTrackAdded(e,n,i),d()},d=()=>{this.off(_.Reconnected,u),this.off(_.Connected,u),this.off(_.Disconnected,d)};this.once(_.Reconnected,u),this.once(_.Connected,u),this.once(_.Disconnected,d);return}if(this.state===Y.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=NT(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==Y.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(M.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(M.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(M.AttributesChanged,this.onLocalAttributesChanged).off(M.TrackMuted,this.onLocalTrackMuted).off(M.TrackUnmuted,this.onLocalTrackUnmuted).off(M.LocalTrackPublished,this.onLocalTrackPublished).off(M.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(M.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(M.MediaDevicesError,this.onMediaDevicesError).off(M.AudioStreamAcquired,this.startAudio).off(M.ChatMessage,this.onLocalChatMessageSent).off(M.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),et()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Y.Disconnected),this.emit(_.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(_.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Qd(u)>J0?(c=be.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof be?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=be.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,n,i;const r=Ie.getInstance().previousDevices,s=yield Ie.getInstance().getDevices(void 0,!1),o=ht();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(_.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=YT(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(p=>p.kind===c),f=this.getActiveDevice(c);if(f===((n=r.filter(p=>p.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==f){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!va()||c==="videoinput"||d.length>0&&!d.find(p=>p.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!va())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=W0())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),st(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(_.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Ta.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ta(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(_.ParticipantConnected,i),i.on(M.TrackPublished,r=>{this.emitWhenConnected(_.TrackPublished,r,i)}).on(M.TrackSubscribed,(r,s)=>{r.kind===E.Kind.Audio?(r.on(L.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(L.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===E.Kind.Video&&(r.on(L.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(L.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(_.TrackSubscribed,r,s,i)}).on(M.TrackUnpublished,r=>{this.emit(_.TrackUnpublished,r,i)}).on(M.TrackUnsubscribed,(r,s)=>{this.emit(_.TrackUnsubscribed,r,s,i)}).on(M.TrackMuted,r=>{this.emitWhenConnected(_.TrackMuted,r,i)}).on(M.TrackUnmuted,r=>{this.emitWhenConnected(_.TrackUnmuted,r,i)}).on(M.ParticipantMetadataChanged,r=>{this.emitWhenConnected(_.ParticipantMetadataChanged,r,i)}).on(M.ParticipantNameChanged,r=>{this.emitWhenConnected(_.ParticipantNameChanged,r,i)}).on(M.AttributesChanged,r=>{this.emitWhenConnected(_.ParticipantAttributesChanged,r,i)}).on(M.ConnectionQualityChanged,r=>{this.emitWhenConnected(_.ConnectionQualityChanged,r,i)}).on(M.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(_.ParticipantPermissionsChanged,r,i)}).on(M.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionStatusChanged,r,s,i)}).on(M.TrackSubscriptionFailed,(r,s)=>{this.emit(_.TrackSubscriptionFailed,r,i,s)}).on(M.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(_.TrackSubscriptionPermissionChanged,r,s,i)}).on(M.Active,()=>{this.emitWhenConnected(_.ParticipantActive,i),i.kind===Ms.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&GT(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ae.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ft.STATE_MISMATCH))):e=0},sw)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ae.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(_.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Y.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Y.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Ga({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:he.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new _i({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(_.SignalConnected),this.emit(_.Connected),this.setAndEmitConnectionState(Y.Connected),r.video){const o=new Sa(E.Kind.Video,new tr({source:Te.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Nt.AUDIO,name:"video-dummy"}),new ba(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:fp(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(M.LocalTrackPublished,o)}if(r.audio){const o=new Sa(E.Kind.Audio,new tr({source:Te.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Nt.AUDIO}),new ka(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Vc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(M.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new _i({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:lr.ACTIVE,tracks:[],joinedAt:he.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=fp(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new tr({source:Te.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Nt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=Vc(),u=new tr({source:Te.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Nt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==_.ActiveSpeakersChanged&&e!==_.TranscriptionReceived){const s=sy(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Pn.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function sy(t){return t.map(e=>{if(e)return Array.isArray(e)?sy(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Mt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Mt||(Mt={}));class ui extends an.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Mt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Pn(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return C(this,void 0,void 0,function*(){if(this.status!==Mt.IDLE)throw Error("check is running already");this.setStatus(Mt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Mt.SKIPPED&&this.setStatus(this.isSuccess()?Mt.SUCCESS:Mt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===Y.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==Y.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Mt.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(_.Reconnecting,()=>{n=!0}),this.room.once(_.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield st(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class ow extends ui{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new Pu(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let y=0;y<c;y++)yield s.write(l);yield s.close();const d=Date.now(),f=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),p={region:r,rtt:1e4,duration:d-u};return f==null||f.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(p.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),p})}}const Jc=1e4;class aw extends ui{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Jc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Jc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>C(this,void 0,void 0,function*(){const f=yield l.getRTCStatsReport();f==null||f.forEach(p=>{p.type==="outbound-rtp"?(u.packetsSent=p.packetsSent,u.qualityLimitationDurations=p.qualityLimitationDurations,u.bitrateTotal+=p.targetBitrate,u.count++):p.type==="remote-inbound-rtp"&&(u.packetsLost=p.packetsLost,u.rttTotal+=p.roundTripTime,u.jitterTotal+=p.jitter)})}),1e3);return yield new Promise(f=>setTimeout(f,Jc)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class cw extends ui{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield tw();if(yield q0(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class lw extends ui{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield ew();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,f=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=f;const p=l.getContext("2d");p.drawImage(i,0,0);const m=p.getImageData(0,0,l.width,l.height).data;let T=!0;for(let h=0;h<m.length;h+=4)if(m[h]!==0||m[h+1]!==0||m[h+2]!==0){T=!1;break}T?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class uw extends ui{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(_.SignalReconnecting,a).on(_.Reconnecting,a).on(_.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Y.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class dw extends ui{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,n;const i=new Wd,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class fw extends ui{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(_.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(hw(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),H.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function hw(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class pw extends ui{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Wd;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===Wv.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class W_ extends an.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Mt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Mt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(pw)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(fw)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(dw)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(uw)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(cw)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(lw)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(aw);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(ow)})}}function mw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;const i=Si(t)?t.mediaStreamTrack:t,r=i.getSettings();let s={facingMode:(n=e.defaultFacingMode)!==null&&n!==void 0?n:"user",confidence:"low"};if("facingMode"in r){const o=r.facingMode;H.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&yw(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){H.trace("Try to get facing mode from device label: (".concat(i.label,")"));const o=vw(i.label);o!==void 0&&(s=o)}return s}const Mp=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),gw=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function vw(t){var e;const n=t.trim().toLowerCase();if(n!=="")return Mp.has(n)?Mp.get(n):(e=Array.from(gw.entries()).find(i=>{let[r]=i;return n.includes(r)}))===null||e===void 0?void 0:e[1]}function yw(t){return t===void 0||["user","environment","left","right"].includes(t)}const wa=Math.min,Ci=Math.max,Ea=Math.round,po=Math.floor,nn=t=>({x:t,y:t}),kw={left:"right",right:"left",bottom:"top",top:"bottom"},bw={start:"end",end:"start"};function Dp(t,e,n){return Ci(t,wa(e,n))}function ec(t,e){return typeof t=="function"?t(e):t}function Oi(t){return t.split("-")[0]}function tc(t){return t.split("-")[1]}function oy(t){return t==="x"?"y":"x"}function ay(t){return t==="y"?"height":"width"}function Er(t){return["top","bottom"].includes(Oi(t))?"y":"x"}function cy(t){return oy(Er(t))}function Sw(t,e,n){n===void 0&&(n=!1);const i=tc(t),r=cy(t),s=ay(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Pa(o)),[o,Pa(o)]}function Cw(t){const e=Pa(t);return[_u(t),e,_u(e)]}function _u(t){return t.replace(/start|end/g,e=>bw[e])}function Tw(t,e,n){const i=["left","right"],r=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?s:o;default:return[]}}function ww(t,e,n,i){const r=tc(t);let s=Tw(Oi(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(_u)))),s}function Pa(t){return t.replace(/left|right|bottom|top/g,e=>kw[e])}function Ew(t){return{top:0,right:0,bottom:0,left:0,...t}}function Pw(t){return typeof t!="number"?Ew(t):{top:t,right:t,bottom:t,left:t}}function Ra(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function Np(t,e,n){let{reference:i,floating:r}=t;const s=Er(e),o=cy(e),a=ay(o),c=Oi(e),l=s==="y",u=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,f=i[a]/2-r[a]/2;let p;switch(c){case"top":p={x:u,y:i.y-r.height};break;case"bottom":p={x:u,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:d};break;case"left":p={x:i.x-r.width,y:d};break;default:p={x:i.x,y:i.y}}switch(tc(e)){case"start":p[o]-=f*(n&&l?-1:1);break;case"end":p[o]+=f*(n&&l?-1:1);break}return p}const Rw=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:u,y:d}=Np(l,i,c),f=i,p={},y=0;for(let m=0;m<a.length;m++){const{name:T,fn:h}=a[m],{x:v,y:k,data:b,reset:S}=await h({x:u,y:d,initialPlacement:i,placement:f,strategy:r,middlewareData:p,rects:l,platform:o,elements:{reference:t,floating:e}});u=v??u,d=k??d,p={...p,[T]:{...p[T],...b}},S&&y<=50&&(y++,typeof S=="object"&&(S.placement&&(f=S.placement),S.rects&&(l=S.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):S.rects),{x:u,y:d}=Np(l,f,c)),m=-1)}return{x:u,y:d,placement:f,strategy:r,middlewareData:p}};async function ly(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=ec(e,t),y=Pw(p),m=a[f?d==="floating"?"reference":"floating":d],T=Ra(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(m)))==null||n?m:m.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),h=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,v=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),k=await(s.isElement==null?void 0:s.isElement(v))?await(s.getScale==null?void 0:s.getScale(v))||{x:1,y:1}:{x:1,y:1},b=Ra(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:h,offsetParent:v,strategy:c}):h);return{top:(T.top-b.top+y.top)/k.y,bottom:(b.bottom-T.bottom+y.bottom)/k.y,left:(T.left-b.left+y.left)/k.x,right:(b.right-T.right+y.right)/k.x}}const _w=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:m=!0,...T}=ec(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const h=Oi(r),v=Er(a),k=Oi(a)===a,b=await(c.isRTL==null?void 0:c.isRTL(l.floating)),S=f||(k||!m?[Pa(a)]:Cw(a)),w=y!=="none";!f&&w&&S.push(...ww(a,m,y,b));const P=[a,...S],x=await ly(e,T),O=[];let I=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&O.push(x[h]),d){const Z=Sw(r,o,b);O.push(x[Z[0]],x[Z[1]])}if(I=[...I,{placement:r,overflows:O}],!O.every(Z=>Z<=0)){var N,j;const Z=(((N=s.flip)==null?void 0:N.index)||0)+1,qe=P[Z];if(qe)return{data:{index:Z,overflows:I},reset:{placement:qe}};let te=(j=I.filter(De=>De.overflows[0]<=0).sort((De,U)=>De.overflows[1]-U.overflows[1])[0])==null?void 0:j.placement;if(!te)switch(p){case"bestFit":{var V;const De=(V=I.filter(U=>{if(w){const z=Er(U.placement);return z===v||z==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(z=>z>0).reduce((z,$)=>z+$,0)]).sort((U,z)=>U[1]-z[1])[0])==null?void 0:V[0];De&&(te=De);break}case"initialPlacement":te=a;break}if(r!==te)return{reset:{placement:te}}}return{}}}};async function xw(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=Oi(n),a=tc(n),c=Er(n)==="y",l=["left","top"].includes(o)?-1:1,u=s&&c?-1:1,d=ec(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}const Iw=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,c=await xw(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:s+c.y,data:{...c,placement:o}}}}},Ow=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:T=>{let{x:h,y:v}=T;return{x:h,y:v}}},...c}=ec(t,e),l={x:n,y:i},u=await ly(e,c),d=Er(Oi(r)),f=oy(d);let p=l[f],y=l[d];if(s){const T=f==="y"?"top":"left",h=f==="y"?"bottom":"right",v=p+u[T],k=p-u[h];p=Dp(v,p,k)}if(o){const T=d==="y"?"top":"left",h=d==="y"?"bottom":"right",v=y+u[T],k=y-u[h];y=Dp(v,y,k)}const m=a.fn({...e,[f]:p,[d]:y});return{...m,data:{x:m.x-n,y:m.y-i,enabled:{[f]:s,[d]:o}}}}}};function nc(){return typeof window<"u"}function Mr(t){return uy(t)?(t.nodeName||"").toLowerCase():"#document"}function pt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function cn(t){var e;return(e=(uy(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function uy(t){return nc()?t instanceof Node||t instanceof pt(t).Node:!1}function $t(t){return nc()?t instanceof Element||t instanceof pt(t).Element:!1}function on(t){return nc()?t instanceof HTMLElement||t instanceof pt(t).HTMLElement:!1}function Ap(t){return!nc()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof pt(t).ShadowRoot}function qs(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=qt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function Mw(t){return["table","td","th"].includes(Mr(t))}function ic(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Xd(t){const e=Zd(),n=$t(t)?qt(t):t;return["transform","translate","scale","rotate","perspective"].some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function Dw(t){let e=oi(t);for(;on(e)&&!Pr(e);){if(Xd(e))return e;if(ic(e))return null;e=oi(e)}return null}function Zd(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Pr(t){return["html","body","#document"].includes(Mr(t))}function qt(t){return pt(t).getComputedStyle(t)}function rc(t){return $t(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function oi(t){if(Mr(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Ap(t)&&t.host||cn(t);return Ap(e)?e.host:e}function dy(t){const e=oi(t);return Pr(e)?t.ownerDocument?t.ownerDocument.body:t.body:on(e)&&qs(e)?e:dy(e)}function As(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=dy(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=pt(r);if(s){const a=xu(o);return e.concat(o,o.visualViewport||[],qs(r)?r:[],a&&n?As(a):[])}return e.concat(r,As(r,[],n))}function xu(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function fy(t){const e=qt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=on(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Ea(n)!==s||Ea(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function ef(t){return $t(t)?t:t.contextElement}function pr(t){const e=ef(t);if(!on(e))return nn(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=fy(e);let o=(s?Ea(n.width):n.width)/i,a=(s?Ea(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Nw=nn(0);function hy(t){const e=pt(t);return!Zd()||!e.visualViewport?Nw:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Aw(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==pt(t)?!1:e}function Mi(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=ef(t);let o=nn(1);e&&(i?$t(i)&&(o=pr(i)):o=pr(t));const a=Aw(s,n,i)?hy(s):nn(0);let c=(r.left+a.x)/o.x,l=(r.top+a.y)/o.y,u=r.width/o.x,d=r.height/o.y;if(s){const f=pt(s),p=i&&$t(i)?pt(i):i;let y=f,m=xu(y);for(;m&&i&&p!==y;){const T=pr(m),h=m.getBoundingClientRect(),v=qt(m),k=h.left+(m.clientLeft+parseFloat(v.paddingLeft))*T.x,b=h.top+(m.clientTop+parseFloat(v.paddingTop))*T.y;c*=T.x,l*=T.y,u*=T.x,d*=T.y,c+=k,l+=b,y=pt(m),m=xu(y)}}return Ra({width:u,height:d,x:c,y:l})}function tf(t,e){const n=rc(t).scrollLeft;return e?e.left+n:Mi(cn(t)).left+n}function py(t,e,n){n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-(n?0:tf(t,i)),s=i.top+e.scrollTop;return{x:r,y:s}}function Lw(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=cn(i),a=e?ic(e.floating):!1;if(i===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=nn(1);const u=nn(0),d=on(i);if((d||!d&&!s)&&((Mr(i)!=="body"||qs(o))&&(c=rc(i)),on(i))){const p=Mi(i);l=pr(i),u.x=p.x+i.clientLeft,u.y=p.y+i.clientTop}const f=o&&!d&&!s?py(o,c,!0):nn(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function Uw(t){return Array.from(t.getClientRects())}function Fw(t){const e=cn(t),n=rc(t),i=t.ownerDocument.body,r=Ci(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Ci(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+tf(t);const a=-n.scrollTop;return qt(i).direction==="rtl"&&(o+=Ci(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function jw(t,e){const n=pt(t),i=cn(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,c=0;if(r){s=r.width,o=r.height;const l=Zd();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:s,height:o,x:a,y:c}}function Bw(t,e){const n=Mi(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=on(t)?pr(t):nn(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=r*s.x,l=i*s.y;return{width:o,height:a,x:c,y:l}}function Lp(t,e,n){let i;if(e==="viewport")i=jw(t,n);else if(e==="document")i=Fw(cn(t));else if($t(e))i=Bw(e,n);else{const r=hy(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Ra(i)}function my(t,e){const n=oi(t);return n===e||!$t(n)||Pr(n)?!1:qt(n).position==="fixed"||my(n,e)}function Vw(t,e){const n=e.get(t);if(n)return n;let i=As(t,[],!1).filter(a=>$t(a)&&Mr(a)!=="body"),r=null;const s=qt(t).position==="fixed";let o=s?oi(t):t;for(;$t(o)&&!Pr(o);){const a=qt(o),c=Xd(o);!c&&a.position==="fixed"&&(r=null),(s?!c&&!r:!c&&a.position==="static"&&r&&["absolute","fixed"].includes(r.position)||qs(o)&&!c&&my(t,o))?i=i.filter(l=>l!==o):r=a,o=oi(o)}return e.set(t,i),i}function zw(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const s=[...n==="clippingAncestors"?ic(e)?[]:Vw(e,this._c):[].concat(n),i],o=s[0],a=s.reduce((c,l)=>{const u=Lp(e,l,r);return c.top=Ci(u.top,c.top),c.right=wa(u.right,c.right),c.bottom=wa(u.bottom,c.bottom),c.left=Ci(u.left,c.left),c},Lp(e,o,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function $w(t){const{width:e,height:n}=fy(t);return{width:e,height:n}}function qw(t,e,n){const i=on(e),r=cn(e),s=n==="fixed",o=Mi(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=nn(0);if(i||!i&&!s)if((Mr(e)!=="body"||qs(r))&&(a=rc(e)),i){const f=Mi(e,!0,s,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else r&&(c.x=tf(r));const l=r&&!i&&!s?py(r,a):nn(0),u=o.left+a.scrollLeft-c.x-l.x,d=o.top+a.scrollTop-c.y-l.y;return{x:u,y:d,width:o.width,height:o.height}}function Yc(t){return qt(t).position==="static"}function Up(t,e){if(!on(t)||qt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return cn(t)===n&&(n=n.ownerDocument.body),n}function gy(t,e){const n=pt(t);if(ic(t))return n;if(!on(t)){let r=oi(t);for(;r&&!Pr(r);){if($t(r)&&!Yc(r))return r;r=oi(r)}return n}let i=Up(t,e);for(;i&&Mw(i)&&Yc(i);)i=Up(i,e);return i&&Pr(i)&&Yc(i)&&!Xd(i)?n:i||Dw(t)||n}const Ww=async function(t){const e=this.getOffsetParent||gy,n=this.getDimensions,i=await n(t.floating);return{reference:qw(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function Hw(t){return qt(t).direction==="rtl"}const Kw={convertOffsetParentRelativeRectToViewportRelativeRect:Lw,getDocumentElement:cn,getClippingRect:zw,getOffsetParent:gy,getElementRects:Ww,getClientRects:Uw,getDimensions:$w,getScale:pr,isElement:$t,isRTL:Hw};function vy(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Gw(t,e){let n=null,i;const r=cn(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=l;if(a||e(),!f||!p)return;const y=po(d),m=po(r.clientWidth-(u+f)),T=po(r.clientHeight-(d+p)),h=po(u),v={rootMargin:-y+"px "+-m+"px "+-T+"px "+-h+"px",threshold:Ci(0,wa(1,c))||1};let k=!0;function b(S){const w=S[0].intersectionRatio;if(w!==c){if(!k)return o();w?o(!1,w):i=setTimeout(()=>{o(!1,1e-7)},1e3)}w===1&&!vy(l,t.getBoundingClientRect())&&o(),k=!1}try{n=new IntersectionObserver(b,{...v,root:r.ownerDocument})}catch{n=new IntersectionObserver(b,v)}n.observe(t)}return o(!0),s}function Qw(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=ef(t),u=r||s?[...l?As(l):[],...As(e)]:[];u.forEach(h=>{r&&h.addEventListener("scroll",n,{passive:!0}),s&&h.addEventListener("resize",n)});const d=l&&a?Gw(l,n):null;let f=-1,p=null;o&&(p=new ResizeObserver(h=>{let[v]=h;v&&v.target===l&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var k;(k=p)==null||k.observe(e)})),n()}),l&&!c&&p.observe(l),p.observe(e));let y,m=c?Mi(t):null;c&&T();function T(){const h=Mi(t);m&&!vy(m,h)&&n(),m=h,y=requestAnimationFrame(T)}return n(),()=>{var h;u.forEach(v=>{r&&v.removeEventListener("scroll",n),s&&v.removeEventListener("resize",n)}),d==null||d(),(h=p)==null||h.disconnect(),p=null,c&&cancelAnimationFrame(y)}}const Jw=Iw,Yw=Ow,Xw=_w,Zw=(t,e,n)=>{const i=new Map,r={platform:Kw,...n},s={...r.platform,_c:i};return Rw(t,e,{...r,platform:s})};var mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Iu={exports:{}},eE=Iu.exports,Fp;function tE(){return Fp||(Fp=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(eE,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(m,T){var h=m[T];if(typeof h.bind=="function")return h.bind(m);try{return Function.prototype.bind.call(h,m)}catch{return function(){return Function.prototype.apply.apply(h,[m,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(m){return m==="debug"&&(m="log"),typeof console===n?!1:m==="trace"&&i?c:console[m]!==void 0?a(console,m):console.log!==void 0?a(console,"log"):e}function u(){for(var m=this.getLevel(),T=0;T<r.length;T++){var h=r[T];this[h]=T<m?e:this.methodFactory(h,m,this.name)}if(this.log=this.debug,typeof console===n&&m<this.levels.SILENT)return"No console available for logging"}function d(m){return function(){typeof console!==n&&(u.call(this),this[m].apply(this,arguments))}}function f(m,T,h){return l(m)||d.apply(this,arguments)}function p(m,T){var h=this,v,k,b,S="loglevel";typeof m=="string"?S+=":"+m:typeof m=="symbol"&&(S=void 0);function w(N){var j=(r[N]||"silent").toUpperCase();if(!(typeof window===n||!S)){try{window.localStorage[S]=j;return}catch{}try{window.document.cookie=encodeURIComponent(S)+"="+j+";"}catch{}}}function P(){var N;if(!(typeof window===n||!S)){try{N=window.localStorage[S]}catch{}if(typeof N===n)try{var j=window.document.cookie,V=encodeURIComponent(S),Z=j.indexOf(V+"=");Z!==-1&&(N=/^([^;]+)/.exec(j.slice(Z+V.length+1))[1])}catch{}return h.levels[N]===void 0&&(N=void 0),N}}function x(){if(!(typeof window===n||!S)){try{window.localStorage.removeItem(S)}catch{}try{window.document.cookie=encodeURIComponent(S)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function O(N){var j=N;if(typeof j=="string"&&h.levels[j.toUpperCase()]!==void 0&&(j=h.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=h.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+N)}h.name=m,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=T||f,h.getLevel=function(){return b??k??v},h.setLevel=function(N,j){return b=O(N),j!==!1&&w(b),u.call(h)},h.setDefaultLevel=function(N){k=O(N),P()||h.setLevel(N,!1)},h.resetLevel=function(){b=null,x(),u.call(h)},h.enableAll=function(N){h.setLevel(h.levels.TRACE,N)},h.disableAll=function(N){h.setLevel(h.levels.SILENT,N)},h.rebuild=function(){if(o!==h&&(v=O(o.getLevel())),u.call(h),o===h)for(var N in s)s[N].rebuild()},v=O(o?o.getLevel():"WARN");var I=P();I!=null&&(b=O(I)),u.call(h)}o=new p,o.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var T=s[m];return T||(T=s[m]=new p(m,o.methodFactory)),T};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(Iu)),Iu.exports}var nE=tE();const iE=yy(nE);var Ou=function(t,e){return Ou=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},Ou(t,e)};function In(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ou(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function rE(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,[])).next())})}function ky(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Rr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _r(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Ls(t,e,n){if(arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function mr(t){return this instanceof mr?(this.v=t,this):new mr(t)}function sE(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(p){return function(y){return Promise.resolve(y).then(p,d)}}function a(p,y){i[p]&&(r[p]=function(m){return new Promise(function(T,h){s.push([p,m,T,h])>1||c(p,m)})},y&&(r[p]=y(r[p])))}function c(p,y){try{l(i[p](y))}catch(m){f(s[0][3],m)}}function l(p){p.value instanceof mr?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function f(p,y){p(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function oE(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Rr=="function"?Rr(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function ae(t){return typeof t=="function"}function nf(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Xc=nf(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function _a(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ws=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Rr(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(m){e={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(ae(u))try{u()}catch(m){s=m instanceof Xc?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Rr(d),p=f.next();!p.done;p=f.next()){var y=p.value;try{jp(y)}catch(m){s=s??[],m instanceof Xc?s=Ls(Ls([],_r(s)),_r(m.errors)):s.push(m)}}}catch(m){i={error:m}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}}if(s)throw new Xc(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)jp(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&_a(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&_a(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),by=Ws.EMPTY;function Sy(t){return t instanceof Ws||t&&"closed"in t&&ae(t.remove)&&ae(t.add)&&ae(t.unsubscribe)}function jp(t){ae(t)?t():t.unsubscribe()}var aE={Promise:void 0},cE={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Ls([t,e],_r(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Cy(t){cE.setTimeout(function(){throw t})}function Mu(){}function $o(t){t()}var rf=function(t){In(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,Sy(n)&&n.add(i)):i.destination=dE,i}return e.create=function(n,i,r){return new Du(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ws),lE=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){go(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){go(i)}else go(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){go(n)}},t}(),Du=function(t){In(e,t);function e(n,i,r){var s=t.call(this)||this,o;return ae(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new lE(o),s}return e}(rf);function go(t){Cy(t)}function uE(t){throw t}var dE={closed:!0,next:Mu,error:uE,complete:Mu},sf=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function of(t){return t}function fE(t){return t.length===0?of:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var Me=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=pE(e)?e:new Du(e,n,i);return $o(function(){var o=r,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=Bp(n),new n(function(r,s){var o=new Du({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[sf]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return fE(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Bp(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function Bp(t){var e;return(e=t??aE.Promise)!==null&&e!==void 0?e:Promise}function hE(t){return t&&ae(t.next)&&ae(t.error)&&ae(t.complete)}function pE(t){return t&&t instanceof rf||hE(t)&&Sy(t)}function mE(t){return ae(t==null?void 0:t.lift)}function On(t){return function(e){if(mE(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Rn(t,e,n,i,r){return new gE(t,e,n,i,r)}var gE=function(t){In(e,t);function e(n,i,r,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=i?function(l){try{i(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=r?function(){try{r()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(rf),vE=nf(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Us=function(t){In(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new Vp(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new vE},e.prototype.next=function(n){var i=this;$o(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Rr(i.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;$o(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;$o(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?by:(this.currentObservers=null,a.push(n),new Ws(function(){i.currentObservers=null,_a(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Me;return n.source=this,n},e.create=function(n,i){return new Vp(n,i)},e}(Me),Vp=function(t){In(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:by},e}(Us),yE=function(t){In(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Us),kE={now:function(){return Date.now()}},bE=function(t){In(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Ws),zp={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Ls([t,e],_r(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},SE=function(t){In(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),zp.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&zp.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_a(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(bE),$p=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=kE.now,t}(),CE=function(t){In(e,t);function e(n,i){i===void 0&&(i=$p.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}($p),TE=new CE(SE);function wE(t){return t&&ae(t.schedule)}function EE(t){return t[t.length-1]}function af(t){return wE(EE(t))?t.pop():void 0}var cf=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Ty(t){return ae(t==null?void 0:t.then)}function wy(t){return ae(t[sf])}function Ey(t){return Symbol.asyncIterator&&ae(t==null?void 0:t[Symbol.asyncIterator])}function Py(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function PE(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ry=PE();function _y(t){return ae(t==null?void 0:t[Ry])}function xy(t){return sE(this,arguments,function(){var e,n,i,r;return ky(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,mr(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,mr(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,mr(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Iy(t){return ae(t==null?void 0:t.getReader)}function di(t){if(t instanceof Me)return t;if(t!=null){if(wy(t))return RE(t);if(cf(t))return _E(t);if(Ty(t))return xE(t);if(Ey(t))return Oy(t);if(_y(t))return IE(t);if(Iy(t))return OE(t)}throw Py(t)}function RE(t){return new Me(function(e){var n=t[sf]();if(ae(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _E(t){return new Me(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function xE(t){return new Me(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Cy)})}function IE(t){return new Me(function(e){var n,i;try{for(var r=Rr(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function Oy(t){return new Me(function(e){ME(t,e).catch(function(n){return e.error(n)})})}function OE(t){return Oy(xy(t))}function ME(t,e){var n,i,r,s;return rE(this,void 0,void 0,function(){var o,a;return ky(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=oE(t),c.label=1;case 1:return[4,n.next()];case 2:if(i=c.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),r={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ni(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function My(t,e){return e===void 0&&(e=0),On(function(n,i){n.subscribe(Rn(i,function(r){return ni(i,t,function(){return i.next(r)},e)},function(){return ni(i,t,function(){return i.complete()},e)},function(r){return ni(i,t,function(){return i.error(r)},e)}))})}function Dy(t,e){return e===void 0&&(e=0),On(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function DE(t,e){return di(t).pipe(Dy(e),My(e))}function NE(t,e){return di(t).pipe(Dy(e),My(e))}function AE(t,e){return new Me(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function LE(t,e){return new Me(function(n){var i;return ni(n,e,function(){i=t[Ry](),ni(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return ae(i==null?void 0:i.return)&&i.return()}})}function Ny(t,e){if(!t)throw new Error("Iterable cannot be null");return new Me(function(n){ni(n,e,function(){var i=t[Symbol.asyncIterator]();ni(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function UE(t,e){return Ny(xy(t),e)}function FE(t,e){if(t!=null){if(wy(t))return DE(t,e);if(cf(t))return AE(t,e);if(Ty(t))return NE(t,e);if(Ey(t))return Ny(t,e);if(_y(t))return LE(t,e);if(Iy(t))return UE(t,e)}throw Py(t)}function Ay(t,e){return e?FE(t,e):di(t)}function qp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=af(t);return Ay(t,n)}function jE(t){return t instanceof Date&&!isNaN(t)}var BE=nf(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function VE(t,e){var n=jE(t)?{first:t}:typeof t=="number"?{each:t}:t,i=n.first,r=n.each,s=n.with,o=s===void 0?zE:s,a=n.scheduler,c=a===void 0?TE:a,l=n.meta,u=l===void 0?null:l;if(i==null&&r==null)throw new TypeError("No timeout provided.");return On(function(d,f){var p,y,m=null,T=0,h=function(v){y=ni(f,c,function(){try{p.unsubscribe(),di(o({meta:u,lastValue:m,seen:T})).subscribe(f)}catch(k){f.error(k)}},v)};p=d.subscribe(Rn(f,function(v){y==null||y.unsubscribe(),T++,f.next(m=v),r>0&&h(r)},void 0,void 0,function(){y!=null&&y.closed||y==null||y.unsubscribe(),m=null})),!T&&h(i!=null?typeof i=="number"?i:+i-c.now():r)})}function zE(t){throw new BE(t)}function Fe(t,e){return On(function(n,i){var r=0;n.subscribe(Rn(i,function(s){i.next(t.call(e,s,r++))}))})}var $E=Array.isArray;function qE(t,e){return $E(e)?t.apply(void 0,Ls([],_r(e))):t(e)}function WE(t){return Fe(function(e){return qE(t,e)})}function HE(t,e,n,i,r,s,o,a){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&e.complete()},p=function(m){return l<i?y(m):c.push(m)},y=function(m){l++;var T=!1;di(n(m,u++)).subscribe(Rn(e,function(h){e.next(h)},function(){T=!0},void 0,function(){if(T)try{l--;for(var h=function(){var v=c.shift();o||y(v)};c.length&&l<i;)h();f()}catch(v){e.error(v)}}))};return t.subscribe(Rn(e,p,function(){d=!0,f()})),function(){}}function lf(t,e,n){return n===void 0&&(n=1/0),ae(e)?lf(function(i,r){return Fe(function(s,o){return e(i,s,r,o)})(di(t(i,r)))},n):(typeof e=="number"&&(n=e),On(function(i,r){return HE(i,r,t,n)}))}function KE(t){return lf(of,t)}function GE(){return KE(1)}function xa(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return GE()(Ay(t,af(t)))}var QE=["addListener","removeListener"],JE=["addEventListener","removeEventListener"],YE=["on","off"];function Nu(t,e,n,i){if(ae(n)&&(i=n,n=void 0),i)return Nu(t,e,n).pipe(WE(i));var r=_r(eP(t)?JE.map(function(a){return function(c){return t[a](e,c,n)}}):XE(t)?QE.map(Wp(t,e)):ZE(t)?YE.map(Wp(t,e)):[],2),s=r[0],o=r[1];if(!s&&cf(t))return lf(function(a){return Nu(a,e,n)})(di(t));if(!s)throw new TypeError("Invalid event target");return new Me(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function Wp(t,e){return function(n){return function(i){return t[n](e,i)}}}function XE(t){return ae(t.addListener)&&ae(t.removeListener)}function ZE(t){return ae(t.on)&&ae(t.off)}function eP(t){return ae(t.addEventListener)&&ae(t.removeEventListener)}function Ly(t,e){return On(function(n,i){var r=0;n.subscribe(Rn(i,function(s){return t.call(e,s,r++)&&i.next(s)}))})}function tP(t,e){return e===void 0&&(e=of),t=t??nP,On(function(n,i){var r,s=!0;n.subscribe(Rn(i,function(o){var a=e(o);(s||!t(r,a))&&(s=!1,r=a,i.next(o))}))})}function nP(t,e){return t===e}function iP(t){return On(function(e,n){var i=!1,r=Rn(n,function(){r==null||r.unsubscribe(),i=!0},Mu);di(t).subscribe(r),e.subscribe(Rn(n,function(s){return i&&n.next(s)}))})}function Wt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=af(t);return On(function(i,r){(n?xa(t,i,n):xa(t,i)).subscribe(r)})}var rP=Object.defineProperty,Hp=Object.getOwnPropertySymbols,sP=Object.prototype.hasOwnProperty,oP=Object.prototype.propertyIsEnumerable,Kp=(t,e,n)=>e in t?rP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Gp=(t,e)=>{for(var n in e||(e={}))sP.call(e,n)&&Kp(t,n,e[n]);if(Hp)for(var n of Hp(e))oP.call(e,n)&&Kp(t,n,e[n]);return t},Ui=(t,e,n)=>new Promise((i,r)=>{var s=c=>{try{a(n.next(c))}catch(l){r(l)}},o=c=>{try{a(n.throw(c))}catch(l){r(l)}},a=c=>c.done?i(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())}),Uy="lk";function ot(t){return typeof t>"u"?!1:aP(t)||cP(t)}function aP(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function cP(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function Fs(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function ze(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(Fs(t))return`${t.participant.identity}_${t.source}_placeholder`;if(ot(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function Fy(t,e){return typeof e>"u"?!1:ot(t)?e.some(n=>n.participant.identity===t.participant.identity&&ot(n)&&n.publication.trackSid===t.publication.trackSid):Fs(t)?e.some(n=>n.participant.identity===t.participant.identity&&Fs(n)&&n.source===t.source):!1}function lP(t,e){return Fs(t)&&ot(e)&&e.participant.identity===t.participant.identity&&e.source===t.source}function uP(t,e,n){return Qw(t,e,()=>Ui(this,null,function*(){const{x:i,y:r}=yield Zw(t,e,{placement:"top",middleware:[Jw(6),Xw(),Yw({padding:5})]});n==null||n(i,r)}))}function dP(t,e){return!t.contains(e.target)}var fP=[_.ConnectionStateChanged,_.RoomMetadataChanged,_.ActiveSpeakersChanged,_.ConnectionQualityChanged,_.ParticipantConnected,_.ParticipantDisconnected,_.ParticipantPermissionsChanged,_.ParticipantMetadataChanged,_.ParticipantNameChanged,_.ParticipantAttributesChanged,_.TrackMuted,_.TrackUnmuted,_.TrackPublished,_.TrackUnpublished,_.TrackStreamStateChanged,_.TrackSubscriptionFailed,_.TrackSubscriptionPermissionChanged,_.TrackSubscriptionStatusChanged],hP=[...fP,_.LocalTrackPublished,_.LocalTrackUnpublished];M.TrackPublished,M.TrackUnpublished,M.TrackMuted,M.TrackUnmuted,M.TrackStreamStateChanged,M.TrackSubscribed,M.TrackUnsubscribed,M.TrackSubscriptionPermissionChanged,M.TrackSubscriptionFailed,M.LocalTrackPublished,M.LocalTrackUnpublished;var pP=[M.ConnectionQualityChanged,M.IsSpeakingChanged,M.ParticipantMetadataChanged,M.ParticipantPermissionsChanged,M.TrackMuted,M.TrackUnmuted,M.TrackPublished,M.TrackUnpublished,M.TrackStreamStateChanged,M.TrackSubscriptionFailed,M.TrackSubscriptionPermissionChanged,M.TrackSubscriptionStatusChanged];[...pP,M.LocalTrackPublished,M.LocalTrackUnpublished];var X=iE.getLogger("lk-components-js");X.setDefaultLevel("WARN");var mP=[{columns:1,rows:1},{columns:1,rows:2,orientation:"portrait"},{columns:2,rows:1,orientation:"landscape"},{columns:2,rows:2,minWidth:560},{columns:3,rows:3,minWidth:700},{columns:4,rows:4,minWidth:960},{columns:5,rows:5,minWidth:1100}];function jy(t,e,n,i){if(t.length<1)throw new Error("At least one grid layout definition must be provided.");const r=gP(t);if(n<=0||i<=0)return r[0];let s=0;const o=n/i>1?"landscape":"portrait";let a=r.find((c,l,u)=>{s=l;const d=u.findIndex((f,p)=>{const y=!f.orientation||f.orientation===o,m=p>l,T=f.maxTiles===c.maxTiles;return m&&T&&y})!==-1;return c.maxTiles>=e&&!d});if(a===void 0)if(a=r[r.length-1],a)X.warn(`No layout found for: participantCount: ${e}, width/height: ${n}/${i} fallback to biggest available layout (${a}).`);else throw new Error("No layout or fallback layout found.");if((n<a.minWidth||i<a.minHeight)&&s>0){const c=r[s-1];a=jy(r.slice(0,s),c.maxTiles,n,i)}return a}function gP(t){return[...t].map(e=>{var n,i;return{name:`${e.columns}x${e.rows}`,columns:e.columns,rows:e.rows,maxTiles:e.columns*e.rows,minWidth:(n=e.minWidth)!=null?n:0,minHeight:(i=e.minHeight)!=null?i:0,orientation:e.orientation}}).sort((e,n)=>e.maxTiles!==n.maxTiles?e.maxTiles-n.maxTiles:e.minWidth!==0||n.minWidth!==0?e.minWidth-n.minWidth:e.minHeight!==0||n.minHeight!==0?e.minHeight-n.minHeight:0)}function vP(){return typeof navigator<"u"&&navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia}function By(t){return typeof t=="object"}function Vy(t){return Array.isArray(t)&&t.filter(By).length>0}function yP(t,e){return e.audioLevel-t.audioLevel}function kP(t,e){return t.isSpeaking===e.isSpeaking?0:t.isSpeaking?-1:1}function bP(t,e){var n,i,r,s;return t.lastSpokeAt!==void 0||e.lastSpokeAt!==void 0?((i=(n=e.lastSpokeAt)==null?void 0:n.getTime())!=null?i:0)-((s=(r=t.lastSpokeAt)==null?void 0:r.getTime())!=null?s:0):0}function Au(t,e){var n,i,r,s;return((i=(n=t.joinedAt)==null?void 0:n.getTime())!=null?i:0)-((s=(r=e.joinedAt)==null?void 0:r.getTime())!=null?s:0)}function SP(t,e){return ot(t)?ot(e)?0:-1:ot(e)?1:0}function CP(t,e){const n=t.participant.isCameraEnabled,i=e.participant.isCameraEnabled;return n!==i?n?-1:1:0}function TP(t){const e=[],n=[],i=[],r=[];t.forEach(a=>{a.participant.isLocal&&a.source===E.Source.Camera?e.push(a):a.source===E.Source.ScreenShare?n.push(a):a.source===E.Source.Camera?i.push(a):r.push(a)});const s=wP(n),o=EP(i);return[...e,...s,...o,...r]}function wP(t){const e=[],n=[];return t.forEach(i=>{i.participant.isLocal?e.push(i):n.push(i)}),e.sort((i,r)=>Au(i.participant,r.participant)),n.sort((i,r)=>Au(i.participant,r.participant)),[...n,...e]}function EP(t){const e=[],n=[];return t.forEach(i=>{i.participant.isLocal?e.push(i):n.push(i)}),n.sort((i,r)=>i.participant.isSpeaking&&r.participant.isSpeaking?yP(i.participant,r.participant):i.participant.isSpeaking!==r.participant.isSpeaking?kP(i.participant,r.participant):i.participant.lastSpokeAt!==r.participant.lastSpokeAt?bP(i.participant,r.participant):ot(i)!==ot(r)?SP(i,r):i.participant.isCameraEnabled!==r.participant.isCameraEnabled?CP(i,r):Au(i.participant,r.participant)),[...e,...n]}function PP(t,e){return t.reduce((n,i,r)=>r%e===0?[...n,[i]]:[...n.slice(0,-1),[...n.slice(-1)[0],i]],[])}function Qp(t,e){const n=Math.max(t.length,e.length);return new Array(n).fill([]).map((i,r)=>[t[r],e[r]])}function Ia(t,e,n){return t.filter(i=>!e.map(r=>n(r)).includes(n(i)))}function Lu(t){return t.map(e=>typeof e=="string"||typeof e=="number"?`${e}`:ze(e))}function RP(t,e){return{dropped:Ia(t,e,ze),added:Ia(e,t,ze)}}function _P(t){return t.added.length!==0||t.dropped.length!==0}function Uu(t,e){const n=e.findIndex(i=>ze(i)===ze(t));if(n===-1)throw new Error(`Element not part of the array: ${ze(t)} not in ${Lu(e)}`);return n}function xP(t,e,n){const i=Uu(t,n),r=Uu(e,n);return n.splice(i,1,e),n.splice(r,1,t),n}function IP(t,e){const n=Uu(t,e);return e.splice(n,1),e}function OP(t,e){return[...e,t]}function Zc(t,e){return PP(t,e)}function MP(t,e,n){let i=DP(t,e);if(i.length<e.length){const o=Ia(e,i,ze);i=[...i,...o]}const r=Zc(i,n),s=Zc(e,n);if(Qp(r,s).forEach(([o,a],c)=>{if(o&&a){const l=Zc(i,n)[c],u=RP(l,a);_P(u)&&(X.debug(`Detected visual changes on page: ${c}, current: ${Lu(o)}, next: ${Lu(a)}`,{changes:u}),u.added.length===u.dropped.length&&Qp(u.added,u.dropped).forEach(([d,f])=>{if(d&&f)i=xP(d,f,i);else throw new Error(`For a swap action we need a addition and a removal one is missing: ${d}, ${f}`)}),u.added.length===0&&u.dropped.length>0&&u.dropped.forEach(d=>{i=IP(d,i)}),u.added.length>0&&u.dropped.length===0&&u.added.forEach(d=>{i=OP(d,i)}))}}),i.length>e.length){const o=Ia(i,e,ze);i=i.filter(a=>!o.map(ze).includes(ze(a)))}return i}function DP(t,e){return t.map(n=>e.find(r=>ze(n)===ze(r)||typeof n!="number"&&Fs(n)&&ot(r)&&lP(n,r))??n)}function at(t){return`${Uy}-${t}`}function NP(t){const e=Fu(t),n=zy(t.participant).pipe(Fe(()=>Fu(t)),Wt(e));return{className:at(t.source===E.Source.Camera||t.source===E.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function Fu(t){if(ot(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function uf(t,...e){return new Me(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(Wt(t))}function df(t,e){return new Me(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function AP(t){return df(t,_.ConnectionStateChanged).pipe(Fe(([e])=>e),Wt(t.state))}function LP(t,e,n=!0){const i=new Me(s=>{Pn.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e==null||e(o),s.next([]),s.complete()})}),r=new Me(s=>{var o;const a=()=>Ui(this,null,function*(){try{const c=yield Pn.getLocalDevices(t,n);s.next(c)}catch(c){e==null||e(c)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator==null?void 0:navigator.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var c;(c=navigator==null?void 0:navigator.mediaDevices)==null||c.removeEventListener("devicechange",a)}});return xa(i,r)}function UP(t){return uf(t,_.AudioPlaybackStatusChanged).pipe(Fe(e=>({canPlayAudio:e.canPlaybackAudio})))}function FP(t){return uf(t,_.VideoPlaybackStatusChanged).pipe(Fe(e=>({canPlayVideo:e.canPlaybackVideo})))}function jP(t,e){return df(t,_.ActiveDeviceChanged).pipe(Ly(([n])=>n===e),Fe(([n,i])=>(X.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:i}),i)))}function BP(t,e){return df(t,_.ParticipantEncryptionStatusChanged).pipe(Ly(([,n])=>(e==null?void 0:e.identity)===(n==null?void 0:n.identity)||!n&&(e==null?void 0:e.identity)===t.localParticipant.identity),Fe(([n])=>n),Wt(e!=null&&e.isLocal?e.isE2EEEnabled:!!(e!=null&&e.isEncrypted)))}function ff(t,...e){return new Me(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(Wt(t))}function zy(t){return ff(t,M.TrackMuted,M.TrackUnmuted,M.ParticipantPermissionsChanged,M.TrackPublished,M.TrackUnpublished,M.LocalTrackPublished,M.LocalTrackUnpublished,M.MediaDevicesError,M.TrackSubscriptionStatusChanged).pipe(Fe(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(E.Source.Microphone),o=e.getTrackPublication(E.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function VP(t){return t?ff(t,M.ParticipantMetadataChanged,M.ParticipantNameChanged).pipe(Fe(({name:e,identity:n,metadata:i})=>({name:e,identity:n,metadata:i})),Wt({name:t.name,identity:t.identity,metadata:t.metadata})):void 0}function zP(t){return hf(t,M.ConnectionQualityChanged).pipe(Fe(([e])=>e),Wt(t.connectionQuality))}function hf(t,e){return new Me(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function $y(t){var e,n,i,r;return ff(t.participant,M.TrackMuted,M.TrackUnmuted,M.TrackSubscribed,M.TrackUnsubscribed,M.LocalTrackPublished,M.LocalTrackUnpublished).pipe(Fe(s=>{var o,a;const c=(o=t.publication)!=null?o:s.getTrackPublication(t.source);return(a=c==null?void 0:c.isMuted)!=null?a:!0}),Wt((r=(i=(e=t.publication)==null?void 0:e.isMuted)!=null?i:(n=t.participant.getTrackPublication(t.source))==null?void 0:n.isMuted)!=null?r:!0))}function $P(t){return hf(t,M.IsSpeakingChanged).pipe(Fe(([e])=>e))}function qP(t){return hf(t,M.ParticipantPermissionsChanged).pipe(Fe(()=>t.permissions),Wt(t.permissions))}function WP(t,e,n,i,r){const{localParticipant:s}=e,o=(u,d)=>{let f=!1;switch(u){case E.Source.Camera:f=d.isCameraEnabled;break;case E.Source.Microphone:f=d.isMicrophoneEnabled;break;case E.Source.ScreenShare:f=d.isScreenShareEnabled;break}return f},a=zy(s).pipe(Fe(u=>o(t,u.participant)),Wt(o(t,s))),c=new Us,l=(u,d)=>Ui(this,null,function*(){try{switch(d??(d=n),c.next(!0),t){case E.Source.Camera:return yield s.setCameraEnabled(u??!s.isCameraEnabled,d,i),s.isCameraEnabled;case E.Source.Microphone:return yield s.setMicrophoneEnabled(u??!s.isMicrophoneEnabled,d,i),s.isMicrophoneEnabled;case E.Source.ScreenShare:return yield s.setScreenShareEnabled(u??!s.isScreenShareEnabled,d,i),s.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(f){if(r&&f instanceof Error){r==null||r(f);return}else throw f}finally{c.next(!1)}});return{className:at("button"),toggle:l,enabledObserver:a,pendingObserver:c.asObservable()}}function HP(){let t=!1;const e=new Us,n=new Us,i=r=>Ui(this,null,function*(){n.next(!0),t=r??!t,e.next(t),n.next(!1)});return{className:at("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function KP(t,e,n){const i=new yE(void 0),r=jP(e,t),s=(o,...a)=>Ui(this,[o,...a],function*(c,l={}){var u,d,f;if(e){X.debug(`Switching active device of kind "${t}" with id ${c}.`),yield e.switchActiveDevice(t,c,l.exact);const p=(u=e.getActiveDevice(t))!=null?u:c;p!==c&&c!=="default"&&X.info(`We tried to select the device with id (${c}), but the browser decided to select the device with id (${p}) instead.`);let y;t==="audioinput"?y=(d=e.localParticipant.getTrackPublication(E.Source.Microphone))==null?void 0:d.track:t==="videoinput"&&(y=(f=e.localParticipant.getTrackPublication(E.Source.Camera))==null?void 0:f.track);const m=c==="default"&&!y||c==="default"&&(y==null?void 0:y.mediaStreamTrack.label.startsWith("Default"));i.next(m?c:p)}});return{className:at("media-device-select"),activeDeviceObservable:r,setActiveMediaDevice:s}}function GP(t){const e=n=>{t.disconnect(n)};return{className:at("disconnect-button"),disconnect:e}}function QP(t){const e=at("connection-quality"),n=zP(t);return{className:e,connectionQualityObserver:n}}function JP(t){let e="track-muted-indicator-camera";switch(t.source){case E.Source.Camera:e="track-muted-indicator-camera";break;case E.Source.Microphone:e="track-muted-indicator-microphone";break}const n=at(e),i=$y(t);return{className:n,mediaMutedObserver:i}}function YP(t){return{className:"lk-participant-name",infoObserver:VP(t)}}function XP(){return{className:at("participant-tile")}}function ZP(){const t=e=>Ui(this,null,function*(){X.info("Start Audio for room: ",e),yield e.startAudio()});return{className:at("start-audio-button"),roomAudioPlaybackAllowedObservable:UP,handleStartAudioPlayback:t}}function eR(){const t=e=>Ui(this,null,function*(){X.info("Start Video for room: ",e),yield e.startVideo()});return{className:at("start-audio-button"),roomVideoPlaybackAllowedObservable:FP,handleStartVideoPlayback:t}}function tR(){return{className:[at("button"),at("chat-toggle")].join(" ")}}function nR(){return{className:[at("button"),at("focus-toggle-button")].join(" ")}}function iR(){return{className:"lk-room-container"}}function Jp(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],r=[];return i.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));r.push(...a)})}),{trackReferences:r,participants:i}}function rR(t,e,n){var i,r;const s=(i=n.additionalRoomEvents)!=null?i:hP,o=(r=n.onlySubscribed)!=null?r:!0,a=Array.from(new Set([_.ParticipantConnected,_.ParticipantDisconnected,_.ConnectionStateChanged,_.LocalTrackPublished,_.LocalTrackUnpublished,_.TrackPublished,_.TrackUnpublished,_.TrackSubscriptionStatusChanged,...s]).values());return uf(t,...a).pipe(Fe(c=>{const l=Jp(c,e,o);return X.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),Wt(Jp(t,e,o)))}function sR(t,e=1e3){if(t===null)return qp(!1);const n=Nu(t,"mousemove",{passive:!0}).pipe(Fe(()=>!0)),i=n.pipe(VE({each:e,with:()=>xa(qp(!1),i.pipe(iP(n)))}),tP());return i}function oR(t,e){if(typeof localStorage>"u"){X.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,i])=>i!==""));localStorage.setItem(t,JSON.stringify(n))}}catch(n){X.error(`Error setting item to local storage: ${n}`)}}function aR(t){if(typeof localStorage>"u"){X.error("Local storage is not available.");return}try{const e=localStorage.getItem(t);if(!e){X.warn(`Item with key ${t} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){X.error(`Error getting item from local storage: ${e}`);return}}function cR(t){return{load:()=>aR(t),save:e=>oR(t,e)}}var lR=`${Uy}-user-choices`,Qr={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:uR,save:dR}=cR(lR);function fR(t,e=!1){e!==!0&&dR(t)}function hR(t,e=!1){var n,i,r,s,o;const a={videoEnabled:(n=t==null?void 0:t.videoEnabled)!=null?n:Qr.videoEnabled,audioEnabled:(i=t==null?void 0:t.audioEnabled)!=null?i:Qr.audioEnabled,videoDeviceId:(r=t==null?void 0:t.videoDeviceId)!=null?r:Qr.videoDeviceId,audioDeviceId:(s=t==null?void 0:t.audioDeviceId)!=null?s:Qr.audioDeviceId,username:(o=t==null?void 0:t.username)!=null?o:Qr.username};if(e)return a;{const c=uR();return Gp(Gp({},a),c??{})}}const pf=g.createContext(void 0);function qy(){const t=g.useContext(pf);if(!t)throw Error("Tried to access LayoutContext context outside a LayoutContextProvider provider.");return t}function mf(){return g.useContext(pf)}const gf=g.createContext(void 0);function sc(){return g.useContext(gf)}function Dr(t){const e=sc(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}const Wy=g.createContext(void 0);function Hy(){return g.useContext(Wy)}function Hs(t){const e=Hy(),n=sc(),i=t??e??(n==null?void 0:n.participant);if(!i)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return i}const vf=g.createContext(void 0);function yf(){const t=g.useContext(vf);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function oc(){return g.useContext(vf)}function Ks(t){const e=oc(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}const Ky=g.createContext(void 0);function pR(t){return g.useContext(Ky)}function Gy(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=Gy(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function Qy(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=Gy(t))&&(i&&(i+=" "),i+=e);return i}function mR(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function ln(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const r in i){const s=e[r],o=i[r];typeof s=="function"&&typeof o=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=mR(s,o):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[r]=Qy(s,o):e[r]=o!==void 0?o:s}}return e}function gR(t){return t!==void 0}function Fi(...t){return ln(...t.filter(gR))}function vR(t,e,n){return g.Children.map(t,i=>g.isValidElement(i)&&g.Children.only(t)?(i.props.className&&(e??(e={}),e.className=Qy(i.props.className,e.className),e.style={...i.props.style,...e.style}),g.cloneElement(i,{...e,key:n})):i)}function yR(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}const kR={connect:!0,audio:!1,video:!1};function bR(t){const{token:e,serverUrl:n,options:i,room:r,connectOptions:s,connect:o,audio:a,video:c,screen:l,onConnected:u,onDisconnected:d,onError:f,onMediaDeviceFailure:p,onEncryptionError:y,simulateParticipants:m,...T}={...kR,...t};i&&r&&X.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[h,v]=g.useState(),k=g.useRef(o);g.useEffect(()=>{v(r??new Pn(i))},[r,JSON.stringify(i,yR)]);const b=g.useMemo(()=>{const{className:S}=iR();return ln(T,{className:S})},[T]);return g.useEffect(()=>{if(!h)return;const S=()=>{const I=h.localParticipant;X.debug("trying to publish local tracks"),Promise.all([I.setMicrophoneEnabled(!!a,typeof a!="boolean"?a:void 0),I.setCameraEnabled(!!c,typeof c!="boolean"?c:void 0),I.setScreenShareEnabled(!!l,typeof l!="boolean"?l:void 0)]).catch(N=>{X.warn(N),f==null||f(N)})},w=(I,N)=>{const j=Ds.getFailure(I);p==null||p(j,N)},P=I=>{y==null||y(I)},x=I=>{d==null||d(I)},O=()=>{u==null||u()};return h.on(_.SignalConnected,S).on(_.MediaDevicesError,w).on(_.EncryptionError,P).on(_.Disconnected,x).on(_.Connected,O),()=>{h.off(_.SignalConnected,S).off(_.MediaDevicesError,w).off(_.EncryptionError,P).off(_.Disconnected,x).off(_.Connected,O)}},[h,a,c,l,f,y,p,u,d]),g.useEffect(()=>{if(h){if(m){h.simulateParticipants({participants:{count:m},publish:{audio:!0,useRealTracks:!0}});return}if(o){if(k.current=!0,X.debug("connecting"),!e){X.debug("no token yet");return}if(!n){X.warn("no livekit url provided"),f==null||f(Error("no livekit url provided"));return}h.connect(n,e,s).catch(S=>{X.warn(S),k.current===!0&&(f==null||f(S))})}else X.debug("disconnecting because connect is false"),k.current=!1,h.disconnect()}},[o,e,JSON.stringify(s),h,f,n,m]),g.useEffect(()=>{if(h)return()=>{X.info("disconnecting on onmount"),h.disconnect()}},[h]),{room:h,htmlProps:b}}const SR=g.forwardRef(function(t,e){const{room:n,htmlProps:i}=bR(t);return g.createElement("div",{ref:e,...i},n&&g.createElement(vf.Provider,{value:n},g.createElement(Ky.Provider,{value:t.featureFlags},t.children)))}),CR=t=>{const e=g.useRef(t);return g.useEffect(()=>{e.current=t}),e};function TR(t,e){const n=ER(),i=CR(e);return g.useLayoutEffect(()=>{let r=!1;const s=t.current;if(!s)return;function o(a,c){r||i.current(a,c)}return n==null||n.subscribe(s,o),()=>{r=!0,n==null||n.unsubscribe(s,o)}},[t.current,n,i]),n==null?void 0:n.observer}function wR(){let t=!1,e=[];const n=new Map;if(typeof window>"u")return;const i=new ResizeObserver((r,s)=>{e=e.concat(r),t||window.requestAnimationFrame(()=>{const o=new Set;for(let a=0;a<e.length;a++){if(o.has(e[a].target))continue;o.add(e[a].target);const c=n.get(e[a].target);c==null||c.forEach(l=>l(e[a],s))}e=[],t=!1}),t=!0});return{observer:i,subscribe(r,s){i.observe(r);const o=n.get(r)??[];o.push(s),n.set(r,o)},unsubscribe(r,s){const o=n.get(r)??[];if(o.length===1){i.unobserve(r),n.delete(r);return}const a=o.indexOf(s);a!==-1&&o.splice(a,1),n.set(r,o)}}}let Yp;const ER=()=>Yp||(Yp=wR()),PR=t=>{const[e,n]=g.useState({width:0,height:0});g.useLayoutEffect(()=>{if(t.current){const{width:r,height:s}=t.current.getBoundingClientRect();n({width:r,height:s})}},[t.current]);const i=g.useCallback(r=>n(r.contentRect),[]);return TR(t,i),e};function wt(t,e,n=!0){const[i,r]=g.useState(e);return g.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function RR(t){const e=s=>typeof window<"u"?window.matchMedia(s).matches:!1,[n,i]=g.useState(e(t));function r(){i(e(t))}return g.useEffect(()=>{const s=window.matchMedia(t);return r(),s.addListener?s.addListener(r):s.addEventListener("change",r),()=>{s.removeListener?s.removeListener(r):s.removeEventListener("change",r)}},[t]),n}function _R(t={}){const e=Hs(t.participant),{className:n,connectionQualityObserver:i}=g.useMemo(()=>QP(e),[e]),r=wt(i,e.connectionQuality);return{className:n,quality:r}}function xR(t){const e=Ks(t),n=g.useMemo(()=>AP(e),[e]);return wt(n,e.state)}function IR(t){const e=yf(),n=xR(e);return{buttonProps:g.useMemo(()=>{const{className:i,disconnect:r}=GP(e);return ln(t,{className:i,onClick:()=>r(t.stopTracks??!0),disabled:n===Y.Disconnected})},[e,t,n])}}function OR(t){if(t.publication instanceof Sa){const e=t.publication.track;if(e){const{facingMode:n}=mw(e);return n}}return"undefined"}function MR({trackRef:t,props:e}){const n=Dr(t),i=mf(),{className:r}=g.useMemo(()=>nR(),[]),s=g.useMemo(()=>Fy(n,i==null?void 0:i.pin.state),[n,i==null?void 0:i.pin.state]);return{mergedProps:g.useMemo(()=>ln(e,{className:r,onClick:o=>{var a,c,l,u,d;(a=e.onClick)==null||a.call(e,o),s?(l=i==null?void 0:(c=i.pin).dispatch)==null||l.call(c,{msg:"clear_pin"}):(d=i==null?void 0:(u=i.pin).dispatch)==null||d.call(u,{msg:"set_pin",trackReference:n})}}),[e,r,n,s,i==null?void 0:i.pin]),inFocus:s}}function DR(t,e,n={}){const i=n.gridLayouts??mP,{width:r,height:s}=PR(t),o=jy(i,e,r,s);return g.useEffect(()=>{t.current&&o&&(t.current.style.setProperty("--lk-col-count",o==null?void 0:o.columns.toString()),t.current.style.setProperty("--lk-row-count",o==null?void 0:o.rows.toString()))},[t,o]),{layout:o,containerWidth:r,containerHeight:s}}function Xp(t,e={}){var n,i;const r=typeof t=="string"?e.participant:t.participant,s=Hs(r),o=typeof t=="string"?{participant:s,source:t}:t,[a,c]=g.useState(!!((n=o.publication)!=null&&n.isMuted||(i=s.getTrackPublication(o.source))!=null&&i.isMuted));return g.useEffect(()=>{const l=$y(o).subscribe(c);return()=>l.unsubscribe()},[ze(o)]),a}function NR(t){const e=Hs(t),n=g.useMemo(()=>$P(e),[e]);return wt(n,e.isSpeaking)}function AR(){const t=yf(),e=g.useMemo(()=>qP(t.localParticipant),[t]);return wt(e,t.localParticipant.permissions)}function LR({kind:t,room:e,track:n,requestPermissions:i,onError:r}){const s=oc(),o=g.useMemo(()=>e??s??new Pn,[e,s]),a=g.useMemo(()=>LP(t,r,i),[t,i,r]),c=wt(a,[]),[l,u]=g.useState((o==null?void 0:o.getActiveDevice(t))??"default"),{className:d,activeDeviceObservable:f,setActiveMediaDevice:p}=g.useMemo(()=>KP(t,o),[t,o,n]);return g.useEffect(()=>{const y=f.subscribe(m=>{m&&(X.info("setCurrentDeviceId",m),u(m))});return()=>{y==null||y.unsubscribe()}},[f]),{devices:c,className:d,activeDeviceId:l,setActiveMediaDevice:p}}function UR(t,e,n={}){const i=g.useRef([]),r=g.useRef(-1),s=e!==r.current,o=typeof n.customSortFunction=="function"?n.customSortFunction(t):TP(t);let a=[...o];if(s===!1)try{a=MP(i.current,o,e)}catch(c){X.error("Error while running updatePages(): ",c)}return s?i.current=o:i.current=a,r.current=e,a}function FR(t,e){const[n,i]=g.useState(1),r=Math.max(Math.ceil(e.length/t),1);n>r&&i(r);const s=n*t,o=s-t,a=u=>{i(d=>u==="next"?d===r?d:d+1:d===1?d:d-1)},c=u=>{u>r?i(r):u<1?i(1):i(u)},l=UR(e,t).slice(o,s);return{totalPageCount:r,nextPage:()=>a("next"),prevPage:()=>a("previous"),setPage:c,firstItemIndex:o,lastItemIndex:s,tracks:l,currentPage:n}}function jR({trackRef:t,onParticipantClick:e,disableSpeakingIndicator:n,htmlProps:i}){const r=Dr(t),s=g.useMemo(()=>{const{className:f}=XP();return ln(i,{className:f,onClick:p=>{var y;if((y=i.onClick)==null||y.call(i,p),typeof e=="function"){const m=r.publication??r.participant.getTrackPublication(r.source);e({participant:r.participant,track:m})}}})},[i,e,r.publication,r.source,r.participant]),o=r.participant.getTrackPublication(E.Source.Microphone),a=g.useMemo(()=>({participant:r.participant,source:E.Source.Microphone,publication:o}),[o,r.participant]),c=Xp(r),l=Xp(a),u=NR(r.participant),d=OR(r);return{elementProps:{"data-lk-audio-muted":l,"data-lk-video-muted":c,"data-lk-speaking":n===!0?!1:u,"data-lk-local-participant":r.participant.isLocal,"data-lk-source":r.source,"data-lk-facing-mode":d,...s}}}function BR({room:t,props:e}){const n=Ks(t),{className:i,roomAudioPlaybackAllowedObservable:r,handleStartAudioPlayback:s}=g.useMemo(()=>ZP(),[]),o=g.useMemo(()=>r(n),[n,r]),{canPlayAudio:a}=wt(o,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:g.useMemo(()=>ln(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayAudio:a}}function VR({room:t,props:e}){const n=Ks(t),{className:i,roomVideoPlaybackAllowedObservable:r,handleStartVideoPlayback:s}=g.useMemo(()=>eR(),[]),o=g.useMemo(()=>r(n),[n,r]),{canPlayVideo:a}=wt(o,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:g.useMemo(()=>ln(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayVideo:a}}function zR(t,e={}){const n=g.useRef(null),i=g.useRef(null),r=e.minSwipeDistance??50,s=c=>{i.current=null,n.current=c.targetTouches[0].clientX},o=c=>{i.current=c.targetTouches[0].clientX},a=g.useCallback(()=>{if(!n.current||!i.current)return;const c=n.current-i.current,l=c>r,u=c<-r;l&&e.onLeftSwipe&&e.onLeftSwipe(),u&&e.onRightSwipe&&e.onRightSwipe()},[r,e]);g.useEffect(()=>{const c=t.current;return c&&(c.addEventListener("touchstart",s,{passive:!0}),c.addEventListener("touchmove",o,{passive:!0}),c.addEventListener("touchend",a,{passive:!0})),()=>{c&&(c.removeEventListener("touchstart",s),c.removeEventListener("touchmove",o),c.removeEventListener("touchend",a))}},[t,a])}function $R({props:t}){const{dispatch:e,state:n}=qy().widget,{className:i}=g.useMemo(()=>tR(),[]);return{mergedProps:g.useMemo(()=>ln(t,{className:i,onClick:()=>{e&&e({msg:"toggle_chat"})},"aria-pressed":n!=null&&n.showChat?"true":"false","data-lk-unread-msgs":n?n.unreadMessages<10?n.unreadMessages.toFixed(0):"9+":"0"}),[t,i,e,n])}}function qR(t){var e,n;const i=Dr(t),{className:r,mediaMutedObserver:s}=g.useMemo(()=>JP(i),[ze(i)]);return{isMuted:wt(s,!!((e=i.publication)!=null&&e.isMuted||(n=i.participant.getTrackPublication(i.source))!=null&&n.isMuted)),className:r}}function WR({source:t,onChange:e,initialState:n,captureOptions:i,publishOptions:r,onDeviceError:s,...o}){var a;const c=oc(),l=(a=c==null?void 0:c.localParticipant)==null?void 0:a.getTrackPublication(t),u=g.useRef(!1),{toggle:d,className:f,pendingObserver:p,enabledObserver:y}=g.useMemo(()=>c?WP(t,c,i,r,s):HP(),[c,t,JSON.stringify(i),r]),m=wt(p,!1),T=wt(y,n??!!(l!=null&&l.isEnabled));g.useEffect(()=>{e==null||e(T,u.current),u.current=!1},[T,e]),g.useEffect(()=>{n!==void 0&&(X.debug("forcing initial toggle state",t,n),d(n))},[]);const h=g.useMemo(()=>ln(o,{className:f}),[o,f]),v=g.useCallback(k=>{var b;u.current=!0,d().catch(()=>u.current=!1),(b=o.onClick)==null||b.call(o,k)},[o,d]);return{toggle:d,enabled:T,pending:m,track:l,buttonProps:{...h,"aria-pressed":T,"data-lk-source":t,"data-lk-enabled":T,disabled:m,onClick:v}}}function Jy(t=[E.Source.Camera,E.Source.Microphone,E.Source.ScreenShare,E.Source.ScreenShareAudio,E.Source.Unknown],e={}){const n=Ks(e.room),[i,r]=g.useState([]),[s,o]=g.useState([]),a=g.useMemo(()=>t.map(c=>By(c)?c.source:c),[JSON.stringify(t)]);return g.useEffect(()=>{const c=rR(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{X.debug("setting track bundles",l,u),r(l),o(u)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),g.useMemo(()=>{if(Vy(t)){const c=KR(t,s),l=Array.from(i);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:p,publication:y})=>u.identity===p.identity&&y.source===d))return;X.debug(`Add ${d} placeholder for participant ${u.identity}.`);const f={participant:u,source:d};l.push(f)})}),l}else return i},[i,s,t])}function HR(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function KR(t,e){const n=new Map;if(Vy(t)){const i=t.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(HR(new Set(i),new Set(s)));o.length>0&&n.set(r.identity,o)})}return n}function GR(t={}){const[e,n]=g.useState(hR(t.defaults,t.preventLoad??!1)),i=g.useCallback(c=>{n(l=>({...l,audioEnabled:c}))},[]),r=g.useCallback(c=>{n(l=>({...l,videoEnabled:c}))},[]),s=g.useCallback(c=>{n(l=>({...l,audioDeviceId:c}))},[]),o=g.useCallback(c=>{n(l=>({...l,videoDeviceId:c}))},[]),a=g.useCallback(c=>{n(l=>({...l,username:c}))},[]);return g.useEffect(()=>{fR(e,t.preventSave??!1)},[e,t.preventSave]),{userChoices:e,saveAudioInputEnabled:i,saveVideoInputEnabled:r,saveAudioInputDeviceId:s,saveVideoInputDeviceId:o,saveUsername:a}}function QR(t,e={}){const n=Hs(t),i=Ks(e.room),r=g.useMemo(()=>BP(i,n),[i,n]);return wt(r,n.isLocal?n.isE2EEEnabled:!!(n!=null&&n.isEncrypted))}const JR=g.forwardRef(function(t,e){const{mergedProps:n}=$R({props:t});return g.createElement("button",{ref:e,...n},t.children)}),YR=g.forwardRef(function(t,e){const{buttonProps:n}=IR(t);return g.createElement("button",{ref:e,...n},t.children)}),XR=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},g.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),g.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),ZR=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},g.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),e_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:18,fill:"none",...t},g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h10.5A2.75 2.75 0 0 1 16 2.75v13.594a.75.75 0 0 1-1.234.572l-3.691-3.12a1.25 1.25 0 0 0-.807-.296H2.75A2.75 2.75 0 0 1 0 10.75v-8ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v8c0 .69.56 1.25 1.25 1.25h7.518c.65 0 1.279.23 1.775.65l2.457 2.077V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 4.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Z",clipRule:"evenodd"})),Zp=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),t_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},g.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),n_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M8.961.894C8.875-.298 7.125-.298 7.04.894c-.066.912-1.246 1.228-1.76.472-.67-.99-2.186-.115-1.664.96.399.824-.465 1.688-1.288 1.289-1.076-.522-1.95.994-.961 1.665.756.513.44 1.693-.472 1.759-1.192.086-1.192 1.836 0 1.922.912.066 1.228 1.246.472 1.76-.99.67-.115 2.186.96 1.664.824-.399 1.688.465 1.289 1.288-.522 1.076.994 1.95 1.665.961.513-.756 1.693-.44 1.759.472.086 1.192 1.836 1.192 1.922 0 .066-.912 1.246-1.228 1.76-.472.67.99 2.186.115 1.664-.96-.399-.824.465-1.688 1.288-1.289 1.076.522 1.95-.994.961-1.665-.756-.513-.44-1.693.472-1.759 1.192-.086 1.192-1.836 0-1.922-.912-.066-1.228-1.246-.472-1.76.99-.67.115-2.186-.96-1.664-.824.399-1.688-.465-1.289-1.288.522-1.076-.994-1.95-1.665-.961-.513.756-1.693.44-1.759-.472ZM8 13A5 5 0 1 0 8 3a5 5 0 0 0 0 10Z",clipRule:"evenodd"})),i_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 2.75A2.75 2.75 0 0 1 4.75 0h6.5A2.75 2.75 0 0 1 14 2.75v10.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-.5a.75.75 0 0 1 1.5 0v.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25h-6.5c-.69 0-1.25.56-1.25 1.25v.5a.75.75 0 0 1-1.5 0v-.5Z",clipRule:"evenodd"}),g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.78 7.47a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H1.75a.75.75 0 0 1 0-1.5h4.69l-.97-.97a.75.75 0 0 1 1.06-1.06l2.25 2.25Z",clipRule:"evenodd"})),r_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),s_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},g.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),g.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),o_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},g.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),g.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),a_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...t},g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),c_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...t},g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("g",{opacity:.25},g.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),l_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor",...t},g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("g",{opacity:.25},g.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),g.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),u_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},g.createElement("g",{opacity:.25},g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),g.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),Yy=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),g.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),d_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},g.createElement("g",{fill:"currentColor"},g.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),g.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),f_=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},g.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},g.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),h_=g.forwardRef(function({trackRef:t,...e},n){const i=sc(),{mergedProps:r,inFocus:s}=MR({trackRef:t??i,props:e});return g.createElement(pf.Consumer,null,o=>o!==void 0&&g.createElement("button",{ref:n,...r},e.children?e.children:s?g.createElement(f_,null):g.createElement(t_,null)))}),el=g.forwardRef(function({kind:t,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:i,onDeviceSelectError:r,exactMatch:s,track:o,requestPermissions:a,onError:c,...l},u){const d=oc(),f=g.useRef("default"),p=g.useCallback(w=>{d&&d.emit(_.MediaDevicesError,w),c==null||c(w)},[d,c]),{devices:y,activeDeviceId:m,setActiveMediaDevice:T,className:h}=LR({kind:t,room:d,track:o,requestPermissions:a,onError:p});g.useEffect(()=>{e!==void 0&&T(e)},[T]),g.useEffect(()=>{typeof i=="function"&&i(y)},[i,y]),g.useEffect(()=>{m!==f.current&&(n==null||n(m)),f.current=m},[m]);const v=async w=>{try{await T(w,{exact:s??!0})}catch(P){if(P instanceof Error)r==null||r(P);else throw P}},k=g.useMemo(()=>Fi(l,{className:h},{className:"lk-list"}),[h,l]),b=!!y.find(w=>w.label.toLowerCase().startsWith("default"));function S(w,P,x){return w===P||!b&&x===0&&P==="default"}return g.createElement("ul",{ref:u,...k},y.map((w,P)=>g.createElement("li",{key:w.deviceId,id:w.deviceId,"data-lk-active":S(w.deviceId,m,P),"aria-selected":S(w.deviceId,m,P),role:"option"},g.createElement("button",{className:"lk-button",onClick:()=>v(w.deviceId)},w.label))))}),p_=g.forwardRef(function({label:t,...e},n){const i=yf(),{mergedProps:r,canPlayAudio:s}=BR({room:i,props:e}),{mergedProps:o,canPlayVideo:a}=VR({room:i,props:r}),{style:c,...l}=o;return c.display=s&&a?"none":"block",g.createElement("button",{ref:n,style:c,...l},t??`Start ${s?"Video":"Audio"}`)});function Xy(t,e){switch(t){case E.Source.Microphone:return e?g.createElement(o_,null):g.createElement(s_,null);case E.Source.Camera:return e?g.createElement(ZR,null):g.createElement(XR,null);case E.Source.ScreenShare:return e?g.createElement(d_,null):g.createElement(Yy,null);default:return}}function m_(t){switch(t){case Ut.Excellent:return g.createElement(a_,null);case Ut.Good:return g.createElement(c_,null);case Ut.Poor:return g.createElement(l_,null);default:return g.createElement(u_,null)}}const tl=g.forwardRef(function({showIcon:t,...e},n){const{buttonProps:i,enabled:r}=WR(e),[s,o]=g.useState(!1);return g.useEffect(()=>{o(!0)},[]),s&&g.createElement("button",{ref:n,...i},(t??!0)&&Xy(e.source,r),e.children)}),g_=g.forwardRef(function(t,e){const{className:n,quality:i}=_R(t),r=g.useMemo(()=>({...Fi(t,{className:n}),"data-lk-quality":i}),[i,t,n]);return g.createElement("div",{ref:e,...r},t.children??m_(i))}),em=g.forwardRef(function({participant:t,...e},n){const i=Hs(t),{className:r,infoObserver:s}=g.useMemo(()=>YP(i),[i]),{identity:o,name:a}=wt(s,{name:i.name,identity:i.identity,metadata:i.metadata}),c=g.useMemo(()=>Fi(e,{className:r,"data-lk-participant-name":a}),[e,r,a]);return g.createElement("span",{ref:n,...c},a!==""?a:o,e.children)}),v_=g.forwardRef(function({trackRef:t,show:e="always",...n},i){const{className:r,isMuted:s}=qR(t),o=e==="always"||e==="muted"&&s||e==="unmuted"&&!s,a=g.useMemo(()=>Fi(n,{className:r}),[r,n]);return o?g.createElement("div",{ref:i,...a,"data-lk-muted":s},n.children??Xy(t.source,!s)):null}),y_=t=>g.createElement("svg",{width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),g.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25}));function Zy(t,e={}){const[n,i]=g.useState(Fu(t)),[r,s]=g.useState(n==null?void 0:n.isMuted),[o,a]=g.useState(n==null?void 0:n.isSubscribed),[c,l]=g.useState(n==null?void 0:n.track),[u,d]=g.useState("landscape"),f=g.useRef(),{className:p,trackObserver:y}=g.useMemo(()=>NP(t),[t.participant.sid??t.participant.identity,t.source,ot(t)&&t.publication.trackSid]);return g.useEffect(()=>{const m=y.subscribe(T=>{X.debug("update track",T),i(T),s(T==null?void 0:T.isMuted),a(T==null?void 0:T.isSubscribed),l(T==null?void 0:T.track)});return()=>m==null?void 0:m.unsubscribe()},[y]),g.useEffect(()=>{var m,T;return c&&(f.current&&c.detach(f.current),(m=e.element)!=null&&m.current&&!(t.participant.isLocal&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),f.current=(T=e.element)==null?void 0:T.current,()=>{f.current&&(c==null||c.detach(f.current))}},[c,e.element]),g.useEffect(()=>{var m,T;if(typeof((m=n==null?void 0:n.dimensions)==null?void 0:m.width)=="number"&&typeof((T=n==null?void 0:n.dimensions)==null?void 0:T.height)=="number"){const h=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(h)}},[n]),{publication:n,isMuted:r,isSubscribed:o,track:c,elementProps:Fi(e.props,{className:p,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var nl,tm;function k_(){if(tm)return nl;tm=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof mo=="object"&&mo&&mo.Object===Object&&mo,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype,f=d.toString,p=Math.max,y=Math.min,m=function(){return u.Date.now()};function T(S,w,P){var x,O,I,N,j,V,Z=0,qe=!1,te=!1,De=!0;if(typeof S!="function")throw new TypeError(t);w=b(w)||0,h(P)&&(qe=!!P.leading,te="maxWait"in P,I=te?p(b(P.maxWait)||0,w):I,De="trailing"in P?!!P.trailing:De);function U(de){var Dn=x,Nr=O;return x=O=void 0,Z=de,N=S.apply(Nr,Dn),N}function z(de){return Z=de,j=setTimeout(re,w),qe?U(de):N}function $(de){var Dn=de-V,Nr=de-Z,kf=w-Dn;return te?y(kf,I-Nr):kf}function ne(de){var Dn=de-V,Nr=de-Z;return V===void 0||Dn>=w||Dn<0||te&&Nr>=I}function re(){var de=m();if(ne(de))return Et(de);j=setTimeout(re,$(de))}function Et(de){return j=void 0,De&&x?U(de):(x=O=void 0,N)}function Pt(){j!==void 0&&clearTimeout(j),Z=0,x=V=O=j=void 0}function Mn(){return j===void 0?N:Et(m())}function We(){var de=m(),Dn=ne(de);if(x=arguments,O=this,V=de,Dn){if(j===void 0)return z(V);if(te)return j=setTimeout(re,w),U(V)}return j===void 0&&(j=setTimeout(re,w)),N}return We.cancel=Pt,We.flush=Mn,We}function h(S){var w=typeof S;return!!S&&(w=="object"||w=="function")}function v(S){return!!S&&typeof S=="object"}function k(S){return typeof S=="symbol"||v(S)&&f.call(S)==n}function b(S){if(typeof S=="number")return S;if(k(S))return e;if(h(S)){var w=typeof S.valueOf=="function"?S.valueOf():S;S=h(w)?w+"":w}if(typeof S!="string")return S===0?S:+S;S=S.replace(i,"");var P=s.test(S);return P||o.test(S)?a(S.slice(2),P?2:8):r.test(S)?e:+S}return nl=T,nl}var b_=k_();const nm=yy(b_);function S_(t){const e=g.useRef(t);e.current=t,g.useEffect(()=>()=>{e.current()},[])}function C_(t,e=500,n){const i=g.useRef();S_(()=>{i.current&&i.current.cancel()});const r=g.useMemo(()=>{const s=nm(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!i.current,o.flush=()=>s.flush(),o},[t,e,n]);return g.useEffect(()=>{i.current=nm(t,e,n)},[t,e,n]),r}function T_(t,e,n){const i=(l,u)=>l===u,r=t instanceof Function?t():t,[s,o]=g.useState(r),a=g.useRef(r),c=C_(o,e,n);return i(a.current,r)||(c(r),a.current=r),[s,c]}function w_({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:i=!1,initialIsIntersecting:r=!1,onChange:s}={}){var o;const[a,c]=g.useState(null),[l,u]=g.useState(()=>({isIntersecting:r,entry:void 0})),d=g.useRef();d.current=s;const f=((o=l.entry)==null?void 0:o.isIntersecting)&&i;g.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||f)return;const m=new IntersectionObserver(T=>{const h=Array.isArray(m.thresholds)?m.thresholds:[m.thresholds];T.forEach(v=>{const k=v.isIntersecting&&h.some(b=>v.intersectionRatio>=b);u({isIntersecting:k,entry:v}),d.current&&d.current(k,v)})},{threshold:t,root:e,rootMargin:n});return m.observe(a),()=>{m.disconnect()}},[a,JSON.stringify(t),e,n,f,i]);const p=g.useRef(null);g.useEffect(()=>{var m;!a&&(m=l.entry)!=null&&m.target&&!i&&!f&&p.current!==l.entry.target&&(p.current=l.entry.target,u({isIntersecting:r,entry:void 0}))},[a,l.entry,i,f,r]);const y=[c,!!l.isIntersecting,l.entry];return y.ref=y[0],y.isIntersecting=y[1],y.entry=y[2],y}const E_=g.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:i,manageSubscription:r,...s},o){const a=Dr(i),c=g.useRef(null);g.useImperativeHandle(o,()=>c.current);const l=w_({root:c.current}),[u]=T_(l,3e3);g.useEffect(()=>{r&&a.publication instanceof Ca&&(u==null?void 0:u.isIntersecting)===!1&&(l==null?void 0:l.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,r]),g.useEffect(()=>{r&&a.publication instanceof Ca&&(l==null?void 0:l.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[l,a,r]);const{elementProps:d,publication:f,isSubscribed:p}=Zy(a,{element:c,props:s});g.useEffect(()=>{n==null||n(!!p)},[p,n]);const y=m=>{e==null||e(m),t==null||t({participant:a==null?void 0:a.participant,track:f})};return g.createElement("video",{ref:c,...d,muted:!0,onClick:y})}),ek=g.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},r){const s=Dr(t),o=g.useRef(null);g.useImperativeHandle(r,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:u}=Zy(s,{element:o,props:i});return g.useEffect(()=>{e==null||e(!!c)},[c,e]),g.useEffect(()=>{l===void 0||n===void 0||(l instanceof iy?l.setVolume(n):X.warn("Volume can only be set on remote audio tracks."))},[n,l]),g.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof Ca?u.setEnabled(!i.muted):X.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,l]),g.createElement("audio",{ref:o,...a})});function P_(t){const e=!!Hy();return t.participant&&!e?g.createElement(Wy.Provider,{value:t.participant},t.children):g.createElement(g.Fragment,null,t.children)}function R_(t){const e=!!sc();return t.trackRef&&!e?g.createElement(gf.Provider,{value:t.trackRef},t.children):g.createElement(g.Fragment,null,t.children)}const __=g.forwardRef(function({trackRef:t,children:e,onParticipantClick:n,disableSpeakingIndicator:i,...r},s){var o,a;const c=Dr(t),{elementProps:l}=jR({htmlProps:r,disableSpeakingIndicator:i,onParticipantClick:n,trackRef:c}),u=QR(c.participant),d=mf(),f=(o=pR())==null?void 0:o.autoSubscription,p=g.useCallback(y=>{c.source&&!y&&d&&d.pin.dispatch&&Fy(c,d.pin.state)&&d.pin.dispatch({msg:"clear_pin"})},[c,d]);return g.createElement("div",{ref:s,style:{position:"relative"},...l},g.createElement(R_,{trackRef:c},g.createElement(P_,{participant:c.participant},e??g.createElement(g.Fragment,null,ot(c)&&(((a=c.publication)==null?void 0:a.kind)==="video"||c.source===E.Source.Camera||c.source===E.Source.ScreenShare)?g.createElement(E_,{trackRef:c,onSubscriptionStatusChanged:p,manageSubscription:f}):ot(c)&&g.createElement(ek,{trackRef:c,onSubscriptionStatusChanged:p}),g.createElement("div",{className:"lk-participant-placeholder"},g.createElement(y_,null)),g.createElement("div",{className:"lk-participant-metadata"},g.createElement("div",{className:"lk-participant-metadata-item"},c.source===E.Source.Camera?g.createElement(g.Fragment,null,u&&g.createElement(r_,{style:{marginRight:"0.25rem"}}),g.createElement(v_,{trackRef:{participant:c.participant,source:E.Source.Microphone},show:"muted"}),g.createElement(em,null)):g.createElement(g.Fragment,null,g.createElement(Yy,{style:{marginRight:"0.25rem"}}),g.createElement(em,null,"'s screen"))),g.createElement(g_,{className:"lk-participant-metadata-item"}))),g.createElement(h_,{trackRef:c}))))});function x_({tracks:t,...e}){return g.createElement(g.Fragment,null,t.map(n=>g.createElement(gf.Provider,{value:n,key:ze(n)},vR(e.children))))}function I_({totalPageCount:t,nextPage:e,prevPage:n,currentPage:i,pagesContainer:r}){const[s,o]=g.useState(!1);return g.useEffect(()=>{let a;return r&&(a=sR(r.current,2e3).subscribe(o)),()=>{a&&a.unsubscribe()}},[r]),g.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":s},g.createElement("button",{className:"lk-button",onClick:n},g.createElement(Zp,null)),g.createElement("span",{className:"lk-pagination-count"},`${i} of ${t}`),g.createElement("button",{className:"lk-button",onClick:e},g.createElement(Zp,null)))}const O_=g.forwardRef(function({totalPageCount:t,currentPage:e},n){const i=new Array(t).fill("").map((r,s)=>s+1===e?g.createElement("span",{"data-lk-active":!0,key:s}):g.createElement("span",{key:s}));return g.createElement("div",{ref:n,className:"lk-pagination-indicator"},i)});function M_({tracks:t,...e}){const n=g.createRef(),i=g.useMemo(()=>Fi(e,{className:"lk-grid-layout"}),[e]),{layout:r}=DR(n,t.length),s=FR(r.maxTiles,t);return zR(n,{onLeftSwipe:s.nextPage,onRightSwipe:s.prevPage}),g.createElement("div",{ref:n,"data-lk-pagination":s.totalPageCount>1,...i},g.createElement(x_,{tracks:s.tracks},e.children),t.length>r.maxTiles&&g.createElement(g.Fragment,null,g.createElement(O_,{totalPageCount:s.totalPageCount,currentPage:s.currentPage}),g.createElement(I_,{pagesContainer:n,...s})))}function D_({volume:t,muted:e}){const n=Jy([E.Source.Microphone,E.Source.ScreenShareAudio,E.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(i=>!i.participant.isLocal&&i.publication.kind===E.Kind.Audio);return g.createElement("div",{style:{display:"none"}},n.map(i=>g.createElement(ek,{key:ze(i),trackRef:i,volume:t,muted:e})))}function im({kind:t,initialSelection:e,onActiveDeviceChange:n,tracks:i,requestPermissions:r=!1,...s}){const[o,a]=g.useState(!1),[c,l]=g.useState([]),[u,d]=g.useState(!0),[f,p]=g.useState(r),y=(v,k)=>{X.debug("handle device change"),a(!1),n==null||n(v,k)},m=g.useRef(null),T=g.useRef(null);g.useLayoutEffect(()=>{o&&p(!0)},[o]),g.useLayoutEffect(()=>{let v;return m.current&&T.current&&(c||u)&&(v=uP(m.current,T.current,(k,b)=>{T.current&&Object.assign(T.current.style,{left:`${k}px`,top:`${b}px`})})),d(!1),()=>{v==null||v()}},[m,T,c,u]);const h=g.useCallback(v=>{T.current&&v.target!==m.current&&o&&dP(T.current,v)&&a(!1)},[o,T,m]);return g.useEffect(()=>(document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}),[h]),g.createElement(g.Fragment,null,g.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":o,...s,onClick:()=>a(!o),ref:m},s.children),!s.disabled&&g.createElement("div",{className:"lk-device-menu",ref:T,style:{visibility:o?"visible":"hidden"}},t?g.createElement(el,{initialSelection:e,onActiveDeviceChange:v=>y(t,v),onDeviceListChange:l,kind:t,track:i==null?void 0:i[t],requestPermissions:f}):g.createElement(g.Fragment,null,g.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),g.createElement(el,{kind:"audioinput",onActiveDeviceChange:v=>y("audioinput",v),onDeviceListChange:l,track:i==null?void 0:i.audioinput,requestPermissions:f}),g.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),g.createElement(el,{kind:"videoinput",onActiveDeviceChange:v=>y("videoinput",v),onDeviceListChange:l,track:i==null?void 0:i.videoinput,requestPermissions:f}))))}function N_({props:t}){const{dispatch:e,state:n}=qy().widget,i="lk-button lk-settings-toggle";return{mergedProps:g.useMemo(()=>ln(t,{className:i,onClick:()=>{e&&e({msg:"toggle_settings"})},"aria-pressed":n!=null&&n.showSettings?"true":"false"}),[t,i,e,n])}}const A_=g.forwardRef(function(t,e){const{mergedProps:n}=N_({props:t});return g.createElement("button",{ref:e,...n},t.children)}),L_=t=>{switch(t){case E.Source.Camera:return 1;case E.Source.Microphone:return 2;case E.Source.ScreenShare:return 3;default:return 0}};function U_({variation:t,controls:e,saveUserChoices:n=!0,onDeviceError:i,...r}){var s;const[o,a]=g.useState(!1),c=mf();g.useEffect(()=>{var O,I;((O=c==null?void 0:c.widget.state)==null?void 0:O.showChat)!==void 0&&a((I=c==null?void 0:c.widget.state)==null?void 0:I.showChat)},[(s=c==null?void 0:c.widget.state)==null?void 0:s.showChat]);const l=RR(`(max-width: ${o?1e3:760}px)`)?"minimal":"verbose";t??(t=l);const u={leave:!0,...e},d=AR();if(!d)u.camera=!1,u.chat=!1,u.microphone=!1,u.screenShare=!1;else{const O=I=>d.canPublish&&(d.canPublishSources.length===0||d.canPublishSources.includes(L_(I)));u.camera??(u.camera=O(E.Source.Camera)),u.microphone??(u.microphone=O(E.Source.Microphone)),u.screenShare??(u.screenShare=O(E.Source.ScreenShare)),u.chat??(u.chat=d.canPublishData&&(e==null?void 0:e.chat))}const f=g.useMemo(()=>t==="minimal"||t==="verbose",[t]),p=g.useMemo(()=>t==="textOnly"||t==="verbose",[t]),y=vP(),[m,T]=g.useState(!1),h=g.useCallback(O=>{T(O)},[T]),v=Fi({className:"lk-control-bar"},r),{saveAudioInputEnabled:k,saveVideoInputEnabled:b,saveAudioInputDeviceId:S,saveVideoInputDeviceId:w}=GR({preventSave:!n}),P=g.useCallback((O,I)=>I?k(O):null,[k]),x=g.useCallback((O,I)=>I?b(O):null,[b]);return g.createElement("div",{...v},u.microphone&&g.createElement("div",{className:"lk-button-group"},g.createElement(tl,{source:E.Source.Microphone,showIcon:f,onChange:P,onDeviceError:O=>i==null?void 0:i({source:E.Source.Microphone,error:O})},p&&"Microphone"),g.createElement("div",{className:"lk-button-group-menu"},g.createElement(im,{kind:"audioinput",onActiveDeviceChange:(O,I)=>S(I??"default")}))),u.camera&&g.createElement("div",{className:"lk-button-group"},g.createElement(tl,{source:E.Source.Camera,showIcon:f,onChange:x,onDeviceError:O=>i==null?void 0:i({source:E.Source.Camera,error:O})},p&&"Camera"),g.createElement("div",{className:"lk-button-group-menu"},g.createElement(im,{kind:"videoinput",onActiveDeviceChange:(O,I)=>w(I??"default")}))),u.screenShare&&y&&g.createElement(tl,{source:E.Source.ScreenShare,captureOptions:{audio:!0,selfBrowserSurface:"include"},showIcon:f,onChange:h,onDeviceError:O=>i==null?void 0:i({source:E.Source.ScreenShare,error:O})},p&&(m?"Stop screen share":"Share screen")),u.chat&&g.createElement(JR,null,f&&g.createElement(e_,null),p&&"Chat"),u.settings&&g.createElement(A_,null,f&&g.createElement(n_,null),p&&"Settings"),u.leave&&g.createElement(YR,null,f&&g.createElement(i_,null),p&&"Leave"),g.createElement(p_,null))}const F_="ws://localhost:8080/match",j_="http://localhost:8080";function B_(){const t=Jy([{source:"camera",withPlaceholder:!0},{source:"microphone",withPlaceholder:!1}],{onlySubscribed:!0});return q.jsx(M_,{tracks:t,children:t.map(e=>q.jsx(__,{trackRef:e},e.participant.identity+e.source))})}function V_(){const[t,e]=g.useState(null),[n,i]=g.useState(null),[r,s]=g.useState(!1),[o,a]=g.useState(0),[c,l]=g.useState(["random"]),[u,d]=g.useState("en"),[f,p]=g.useState("dev"),[y,m]=g.useState([]),[T,h]=g.useState("coding,anime,football"),[v,k]=g.useState(!0),[b,S]=g.useState(""),w=g.useRef(null),[P,x]=g.useState(!1);g.useEffect(()=>{const V=new WebSocket(F_);w.current=V,V.onopen=()=>x(!0),V.onclose=()=>x(!1),V.onmessage=qe=>{const te=JSON.parse(qe.data);te.type==="queued"&&s(!0),te.type==="matched"&&(e(te.room),i(te.token),s(!1)),te.type==="cooldown"&&a(te.seconds||0),te.type==="left"&&(e(null),i(null)),te.type==="error"&&alert("Error: "+te.error)};const Z=setInterval(()=>{V.readyState===WebSocket.OPEN&&V.send(JSON.stringify({type:"poll"}))},1e3);return()=>{clearInterval(Z),V.close()}},[]),g.useEffect(()=>{l(T.split(",").map(V=>V.trim()).filter(Boolean).slice(0,5))},[T]);const O=()=>{var V;(V=w.current)==null||V.send(JSON.stringify({type:"find",tags:c,lang:u,countryBias:v,recaptchaToken:f}))},I=()=>{var V;(V=w.current)==null||V.send(JSON.stringify({type:"next"}))},N=()=>{var V;(V=w.current)==null||V.send(JSON.stringify({type:"leave"}))},j=async()=>{const V=prompt("Report reason:",b||"abuse");if(V)try{await fetch(j_+"/api/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:V,peerId:"unknown",room:t||""})}),alert("Reported. Our team will review.")}catch{alert("Failed to report.")}};return q.jsxs("div",{className:"max-w-6xl mx-auto p-4 space-y-4",children:[q.jsxs("header",{className:"flex items-center justify-between",children:[q.jsx("h1",{className:"text-xl font-semibold",children:"Stranger Video Chat"}),q.jsxs("div",{className:"flex items-center gap-2",children:[q.jsx("span",{className:"badge",children:P?"Connected":"Offline"}),q.jsx("button",{className:"btn-secondary",onClick:()=>window.open("/docs/tos.html","_blank"),children:"ToS"}),q.jsx("button",{className:"btn-secondary",onClick:()=>window.open("/docs/privacy.html","_blank"),children:"Privacy"})]})]}),q.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[q.jsx("div",{className:"md:col-span-2 card",children:n?q.jsxs(SR,{video:!0,audio:!0,token:n,serverUrl:void 0,connect:!0,"data-lk-theme":"default",style:{height:520},onDisconnected:()=>{i(null),e(null)},children:[q.jsx(B_,{}),q.jsx(D_,{}),q.jsx(U_,{variation:"minimal",controls:{screenShare:!1,leave:!0}}),q.jsxs("div",{className:"mt-2 flex gap-2",children:[q.jsx("button",{className:"btn-secondary",onClick:I,children:"Next"}),q.jsx("button",{className:"btn-secondary",onClick:()=>i(null),children:"Disconnect"}),q.jsx("button",{className:"btn-secondary",onClick:j,children:"Report"})]})]}):q.jsxs("div",{className:"space-y-3",children:[q.jsxs("p",{children:["Click ",q.jsx("b",{children:"Start"})," to join the queue and get matched with a stranger."]}),q.jsxs("div",{className:"flex gap-2",children:[q.jsx("button",{className:"btn",onClick:O,disabled:o>0,children:"Start"}),q.jsx("button",{className:"btn-secondary",onClick:I,disabled:o>0,children:"Next"}),q.jsx("button",{className:"btn-secondary",onClick:N,children:"Leave"}),o>0&&q.jsxs("span",{className:"badge",children:["Cooldown: ",o,"s"]})]}),r&&q.jsx("small",{children:"Waiting for a partner"})]})}),q.jsxs("aside",{className:"card space-y-3",children:[q.jsx("h2",{className:"font-semibold",children:"Filters"}),q.jsxs("div",{className:"space-y-2",children:[q.jsx("label",{className:"block text-sm",children:"Interests (comma separated)"}),q.jsx("input",{className:"input",value:T,onChange:V=>h(V.target.value),placeholder:"anime,football,coding"}),q.jsx("label",{className:"block text-sm",children:"Language"}),q.jsxs("select",{className:"input",value:u,onChange:V=>d(V.target.value),children:[q.jsx("option",{value:"en",children:"English"}),q.jsx("option",{value:"hi",children:"Hindi"}),q.jsx("option",{value:"es",children:"Spanish"}),q.jsx("option",{value:"fr",children:"French"}),q.jsx("option",{value:"ar",children:"Arabic"})]})]})]})]})]})}const z_=document.getElementById("root"),$_=gv(z_);$_.render(q.jsx(V_,{}));
